(window.webpackJsonp=window.webpackJsonp||[]).push([["order-view-controller"],{"+AwB":function(t,e,i){"use strict";var r=i("rRE7"),s=i("PIcZ"),o=i("SUh3"),n=i("H9Zw"),u=i("z6YP");e.startWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return function(e){var i=t[t.length-1];u.isScheduler(i)?t.pop():i=null;var a=t.length;return 1===a?n.concat(new s.ScalarObservable(t[0],i),e):a>1?n.concat(new r.ArrayObservable(t,i),e):n.concat(new o.EmptyObservable(i),e)}}},"+EyI":function(t,e,i){"use strict";var r=i("NVK1");e.map=function(t,e){return r.map(t,e)(this)}},"/Trf":function(t,e,i){"use strict";e.isPromise=function(t){return t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}},"0PrS":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("rfFC");e.filter=function(t,e){return function(i){return i.lift(new o(t,e))}};var o=function(){function t(t,e){this.predicate=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new n(t,this.predicate,this.thisArg))},t}(),n=function(t){function e(e,i,r){t.call(this,e),this.predicate=i,this.thisArg=r,this.count=0}return r(e,t),e.prototype._next=function(t){var e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(i){return void this.destination.error(i)}e&&this.destination.next(t)},e}(s.Subscriber)},"10Uv":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(e,i){t.call(this,e,i),this.scheduler=e,this.work=i}return r(e,t),e.prototype.schedule=function(e,i){return void 0===i&&(i=0),i>0?t.prototype.schedule.call(this,e,i):(this.delay=i,this.state=e,this.scheduler.flush(this),this)},e.prototype.execute=function(e,i){return i>0||this.closed?t.prototype.execute.call(this,e,i):this._execute(e,i)},e.prototype.requestAsyncId=function(e,i,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?t.prototype.requestAsyncId.call(this,e,i,r):e.flush(this)},e}(i("1Re5").AsyncAction);e.QueueAction=s},"1Re5":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("tSeh"),o=function(t){function e(e,i){t.call(this,e,i),this.scheduler=e,this.pending=!1,this.work=i}return r(e,t),e.prototype.schedule=function(t,e){if(void 0===e&&(e=0),this.closed)return this;this.state=t,this.pending=!0;var i=this.id,r=this.scheduler;return null!=i&&(this.id=this.recycleAsyncId(r,i,e)),this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this},e.prototype.requestAsyncId=function(t,e,i){return void 0===i&&(i=0),s.root.setInterval(t.flush.bind(t,this),i)},e.prototype.recycleAsyncId=function(t,e,i){if(void 0===i&&(i=0),
null!==i&&this.delay===i&&!1===this.pending)return e;s.root.clearInterval(e)},e.prototype.execute=function(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var i=this._execute(t,e);if(i)return i;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},e.prototype._execute=function(t,e){var i=!1,r=void 0;try{this.work(t)}catch(s){i=!0,r=!!s&&s||new Error(s)}if(i)return this.unsubscribe(),r},e.prototype._unsubscribe=function(){var t=this.id,e=this.scheduler,i=e.actions,r=i.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&i.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null},e}(i("C7Jb").Action);e.AsyncAction=o},"1ouX":function(t,e,i){"use strict";var r=i("10Uv"),s=i("9zIo");e.queue=new s.QueueScheduler(r.QueueAction)},"22vd":function(t,e,i){"use strict";e.identity=function(t){return t}},"35Wn":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(){t.apply(this,arguments)}return r(e,t),e.prototype.notifyNext=function(t,e,i,r,s){this.destination.next(e)},e.prototype.notifyError=function(t,e){this.destination.error(t)},e.prototype.notifyComplete=function(t){this.destination.complete()},e}(i("rfFC").Subscriber);e.OuterSubscriber=s},"3bpA":function(t,e,i){"use strict";i.r(e);var r=i("mrSG"),s=i("YFKU"),o=i("Kxc7"),n=i("Vdly"),u=i("PT1i"),a=i("en3B"),l=i("NbG7"),c=(i("xDhC"),i("G7k4"),i("MSNS"),i("mPU7"),i("fjAU"),i("4c1C")),h=i("nDsj"),d=i("Eyy1"),p=i("ogJP"),b=i("e3/o"),f=i("aIyQ"),_=i.n(f),v=i("hY0g"),y=i.n(v),P=window.t("Long"),m=window.t("Short"),g=function(){function t(t,e,i,r,s,n,u,a,l,c,h){var d=this;this.description="",this.isTradable=!0,this._pinButtonClicked=new _.a,this._backButtonClicked=new _.a,this._cancelButtonClicked=new _.a,this._closeButtonClicked=new _.a,this._onStatusChanged=function(){d.hasBackButton.setValue(d._hasBackButton()),d.hasCloseButton.setValue(o.enabled("order_panel_close_button")),d.hasCancelButton.setValue(d._hasCancelButton()),d.description=d._text(),d.title=d._title()},this._onQuotes=function(t){d.hasDelayedWarning.setValue(Boolean(t.isDelayed))},this._data=c,this._symbol=t,this._formatter=h,this._brokerName=e,this.status=r,this._mode=i,this.type=s,this._existingOrder=n,this.isTradable=u,this.ticketCanBePanel=l,this.hasBackButton=new y.a(this._hasBackButton()),this.hasCloseButton=new y.a(o.enabled("order_panel_close_button")),this.hasCancelButton=new y.a(!1),this.hasDelayedWarning=new y.a(!1),this.title=this._title(),this.description=this._text(),this.status.subscribe(this._onStatusChanged),this._mode.subscribe(this._onStatusChanged),a&&(this._quotesSubscription=a.subscribe(this._onQuotes))}return t.prototype.unsubscribe=function(){this._mode.unsubscribe(this._onStatusChanged),this.status.unsubscribe(this._onStatusChanged),
this._quotesSubscription&&this._quotesSubscription.unsubscribe()},t.prototype.showCancelButton=function(){this.hasCancelButton.setValue(!0)},t.prototype.hideCancelButton=function(){this.hasCancelButton.setValue(!1)},t.prototype.back=function(){this._backButtonClicked.fire()},t.prototype.pin=function(){this._pinButtonClicked.fire()},t.prototype.cancel=function(){this._cancelButtonClicked.fire()},t.prototype.close=function(){this._closeButtonClicked.fire()},t.prototype.pinButtonClicked=function(){return this._pinButtonClicked},t.prototype.backButtonClicked=function(){return this._backButtonClicked},t.prototype.cancelButtonClicked=function(){return this._cancelButtonClicked},t.prototype.closeButtonClicked=function(){return this._closeButtonClicked},t.prototype._hasBackButton=function(){return!(this._mode.value()!==a.g.Panel||!this._existingOrder&&2!==this.type&&this.status.value()!==a.h.Preview)},t.prototype._hasCancelButton=function(){return this._mode.value()===a.g.Panel&&this.status.value()===a.h.Active&&!this._existingOrder&&2!==this.type},t.prototype._title=function(){return this.status.value()===a.h.Preview?window.t("Order confirmation"):this._symbol},t.prototype._text=function(){if(this.status.value()===a.h.Preview)return"";if(this._existingOrder&&this._data&&this._formatter){if(2===this.type){var t=this._data.side,e=this._data.qty,i=this._formatter.format(this._data.price||this._data.avgPrice||this._data.limitPrice);return", "+(1===t?P:m)+" "+e+" @ "+i}return", "+window.t("order")+" "+this._data.id}return this._brokerName?", "+this._brokerName:""},t}(),w=i("0rc0"),S=function(){function t(t,e,i,r,s,o){this.quotes=new y.a({ask:" ",bid:" "}),this.numericQuotes=new y.a,this.baseCurrency=null,this.onControlFocused=new _.a,this.id=Object(b.randomHashN)(6),this._waitQuotesTimeout=null,this._priceFormatter=e,this._spreadFormatter=i,this._quotes=t,this.baseCurrency=o,this.side=new y.a(r),this.status=s,this._subcsription=Object(w.t)(this.side),this.$value=this._subcsription.subject}return t.prototype.subscribe=function(){var t=this;return this._waitQuotesTimeout=setTimeout((function(){return t.quotes.setValue({})}),5e3),this._quotes.subscribe((function(e){t.quotes.setValue(t._generateText(e)),t.numericQuotes.setValue(e),t._waitQuotesTimeout&&(clearTimeout(t._waitQuotesTimeout),t._waitQuotesTimeout=null)}))},t.prototype.unsubscribe=function(){this._subcsription.unsubscribe(),this._waitQuotesTimeout&&(clearTimeout(this._waitQuotesTimeout),this._waitQuotesTimeout=null)},t.prototype._generateText=function(t){var e={},i=Object(w.l)(t),r=Object(w.m)(t);return e.ask=this._priceFormatter.format(i),e.bid=this._priceFormatter.format(r),e.spread=Object(p.isNumber)(t.spread)?this._spreadFormatter.format(t.spread):this._priceFormatter.format(i-r),e},t}(),O=(i("JwtW"),i("4XzM"),
i("ivNn")),k=i("QfUd"),C=i("VVyh"),M=i("4qhP"),V=window.t("Order price is not appropriate for this order type/direction."),j=window.t("Order price is too close to the market price. It can lead to placing wrong order type due to specifics of the order placement in {brokerTitle}");function T(t,e){return Math.abs(t-e)>t/2}function I(t,e,i,r,s,o,n,u,a,l){var c=t<0||t>100*e||function(t,e,i,r,s,o){return 1===i?1===r?t>e&&T(e,t):t<e&&T(e,t):!!(3===i&&!o||4===i&&s)&&(1===r?t<e:t>e)}(t,e,i,r,s,u);return o&&!l||!1!==Object(w.s)(t,a)?{res:c,severity:"error",msg:c?V:void 0}:{res:!0,msg:window.t("Order price should be a multiple of {minTick}").format({minTick:n.format(a)})}}var B=function(){function t(t,e,i,r,s,o,n,u,l,d,p,f,v,P){var m=this;this.id=Object(b.randomHashN)(6),this.price=new y.a(null),this.displayPrice=new y.a(""),this.relativePrice=new k.a(null,w.g),this.priceError=new y.a,this.quotes=new k.a({ask:0,bid:0,last:0},w.g),this.side=new y.a,this.step=new y.a,this.error=new k.a({res:!1},w.g),this.onControlFocused=new _.a,this.$value=new h.BehaviorSubject(null),this._controlError=new h.BehaviorSubject(!1),this._syncPrice=null,this._symbolType="",this._priceRules=[],this.setControlError=function(t){m._controlError.next(t)},this._isPriceRules=function(t){return"limitPriceDistance"===t.id||"stopPriceDistance"===t.id},this._updateFocusIfNeeded=function(){1!==m.focusedControl.value()||!m.isRelativePriceControlHidden&&m._settings.value().showRelativePriceControl||m.focusedControl.setValue(0)},this.side.setValue(e.getValue()||1),this._instrumentInfo=i,this.status=r,this.orderType=n,this._isLimitPrice=u,this._settings=l,this._settings.subscribe(this._updateFocusIfNeeded),this.isRelativePriceControlHidden=this._roundToStepRequired(),this._setStep(),this.formatter=o,this.orderWidgetStat=p,this.supportStopOrdersInBothDirections=!0===P;var g=v||this.isRelativePriceControlHidden||!this._settings.value().showRelativePriceControl;this.focusedControl=new y.a(g?0:1),this.modifiedAbsolutePriceControlStat=null!==p?function(){return p.setPriceControlModifiedProperty(a.j.Absolute)}:function(){},this.modifiedRelativePriceControlStat=null!==p?function(){return p.setPriceControlModifiedProperty(a.j.Relative)}:function(){},this.displayPrice.setValue(this.formatter.format(0)),void 0!==s&&(this.forceAbsolutePriceUpdate(s,!0),this.$value.next(this.price.value())),this._symbolType=i.type||"",this._quotes=t,this._side=e,this._priceSubscription=Object(w.t)(this.price),this._orderTypeSubscription=Object(w.t)(this.orderType),this._orderTypeSubj=this._orderTypeSubscription.subject,this._resultSubscription=c.Observable.combineLatest(this._priceSubscription.subject,this._quotes,this._side,this._orderTypeSubscription.subject,this._controlError).subscribe((function(t){var e=t[0],i=t[1],r=t[2],s=t[3],o=t[4],n=Object(w.q)(r,i),u="forex"===m._symbolType,l=null!==e&&null!==s&&2!==s?I(e,n,s,r,!m._isLimitPrice,u,m.formatter,m.supportStopOrdersInBothDirections,m.step.value(),m._roundToStepRequired()):{res:!1},c=null!==e?m._checkPriceWarning(e,i):{res:!1
},h=m.status.value()!==a.h.Wait,d=l.res||o||c.res,p=l.res||o?"error":"warning",b=o?void 0:l.res?l.msg:c.msg;m.error.setValue({res:!!h&&d,severity:p,msg:h?b:void 0}),m.$value.next(l.res||o?null:e)})),this._pipSize=i.pipSize,this._priceRules=(f||[]).filter(this._isPriceRules),this._brokerTitle=d}return t.prototype.onAbsolutePriceSelected=function(t){var e,i;(e=this.formatter.parse?this.formatter.parse(t):{res:!1,error:"Formatter does not support parse"}).res?(this.price.setValue(e.value),this.displayPrice.setValue(t)):this.displayPrice.setValue(t),i=this._isLimitPrice&&4===this.orderType.value()&&null!==this._syncPrice?this._syncPrice:this._getQuotesBySide(this.side.value());var r={base:this._getBase(this.side.value(),this.orderType.value()),offset:this.calcOffset(e.res?e.value:0,i,this.step.value())};this.relativePrice.setValue(r)},t.prototype.onRelativePriceSelected=function(t){if(!this.isRelativePriceControlHidden&&this._settings.value().showRelativePriceControl){var e;if(this.relativePrice.setValue(t),null===t)e=0;else if("ask"===t.base)e=this.quotes.value().ask+this.step.value()*t.offset;else if("bid"===t.base)e=this.quotes.value().bid+this.step.value()*t.offset;else{e=(this._isLimitPrice&&4===this.orderType.value()&&null!==this._syncPrice?this._syncPrice:this._getQuotesBySide(this.side.value()))+this.step.value()*t.offset}this._checkOutOfRange(this.quotes.value(),e)&&(e=this._getQuotesBySide(this.side.value()),this.relativePrice.setValue({base:this._getBase(this.side.value(),this.orderType.value()),offset:0}));var i=this.formatter.format(Object(O.fixComputationError)(e));this.price.setValue(Object(C.d)(i,this.formatter,e)),this.displayPrice.setValue(i)}},t.prototype.subscribe=function(){var t=this;return c.Observable.combineLatest(this._side,this._quotes,this._orderTypeSubj).subscribe((function(e){var i=e[0],r=e[1],s=e[2];t.orderType.setValue(s),t.isRelativePriceControlHidden=t._roundToStepRequired(),t._setStep(),(t._isLimitPrice&&4!==s||!1===t._isLimitPrice||t.isRelativePriceControlHidden)&&(t._updateAbsolutePriceOnQuotes(i,r),t._updateRelativePriceOnQuotes(i,r,s)),t.quotes.setValue({ask:Object(w.l)(r),bid:Object(w.m)(r),last:Object(w.p)(r)}),t.side.setValue(i),t.orderType.setValue(s)}))},t.prototype.unsubscribe=function(){this._priceSubscription.unsubscribe(),this._orderTypeSubscription.unsubscribe(),this._resultSubscription.unsubscribe(),this._settings.unsubscribe(this._updateFocusIfNeeded)},t.prototype.forcePricesUpdate=function(t){this.focusedControl.setValue(this._settings.value().showRelativePriceControl&&!this.isRelativePriceControlHidden?1:0),this.forceAbsolutePriceUpdate(t),this.forceRelativePriceUpdate()},t.prototype.forceAbsolutePriceUpdate=function(t,e){if(void 0===e&&(e=!1),null!==t){var i=this._roundToStepRequired()||e,r=this._getPriceType();t=i?Object(M.x)(t,this.step.value(),r,this.side.value()):t,this.price.setValue(t),this.displayPrice.setValue(this.formatter.format(t))}},t.prototype.forceRelativePriceUpdate=function(){
var t=this._getOffsetFromAbsolutePrice(this.price.value(),this.side.value(),this.quotes.value()),e={base:this._getBase(this.side.value(),this.orderType.value()),offset:t};this.onRelativePriceSelected(e)},t.prototype.forceStopLimitRelativePriceUpdate=function(){var t={base:"stop",offset:this.side.value()};this.onRelativePriceSelected(t)},t.prototype.syncWithPrice=function(t){var e=null!==t?t:0;this._syncPrice=e;var i=this.price.value(),r=null!==i?i:0,s=this.calcOffset(r,e,this.step.value());if(0===this.focusedControl.value()){var o={base:"stop",offset:s};this.relativePrice.setValue(o)}else{var n=this.relativePrice.value(),u=e+(null!==n?n.offset:0)*this.step.value();this.forceAbsolutePriceUpdate(u)}},t.prototype.calcOffset=function(t,e,i){return Math.round((t-e)/i)},t.prototype._checkOutOfRange=function(t,e){var i=null!==e&&e>=0,r=null!==e&&e<=100*Object(w.q)(this.side.value(),t);return!i||!r},t.prototype._checkPriceWarning=function(t,e){var i=this,r=this._priceRules.find((function(r){return i._isDistanceRuleViolated(t,e,r)}));return r?{res:!0,severity:r.severity,msg:j.format({brokerTitle:this._brokerTitle})}:{res:!1,msg:void 0}},t.prototype._isDistanceRuleViolated=function(t,e,i){if("limitPriceDistance"===i.id&&!this._isLimitPrice||"stopPriceDistance"===i.id&&this._isLimitPrice)return!1;var r=this._side.getValue(),s=1===r,o=Object(w.q)(r,e),n=null;return s&&"buyDirectionPips"in i.options&&(n=i.options.buyDirectionPips),!s&&"sellDirectionPips"in i.options&&(n=i.options.sellDirectionPips),null!==n&&Math.abs(o-t)<n*this._pipSize},t.prototype._getBase=function(t,e){return 4===e&&!0===this._isLimitPrice?"stop":1===t?"ask":"bid"},t.prototype._getQuotesBySide=function(t){return 1===t?this.quotes.value().ask:this.quotes.value().bid},t.prototype._getOffsetFromAbsolutePrice=function(t,e,i){var r=1===e?Object(w.l)(i):Object(w.m)(i);return this.calcOffset(null!==t?t:r,r,this.step.value())},t.prototype._getOffsetFromRelativePrice=function(){var t=this.relativePrice.value();return null!==t?t.offset:0},t.prototype._updateAbsolutePriceOnQuotes=function(t,e){var i=Object(w.q)(t,e);if(null===this.price.value())this.forceAbsolutePriceUpdate(i);else if(1===this.focusedControl.value()){var r=this._getOffsetFromRelativePrice();this.forceAbsolutePriceUpdate(Object(O.fixComputationError)(i+r*this.step.value()))}},t.prototype._updateRelativePriceOnQuotes=function(t,e,i){if(!this.isRelativePriceControlHidden&&this._settings.value().showRelativePriceControl&&(null===this.relativePrice.value()||0===this.focusedControl.value()||this.side.value()!==t||this.orderType.value()!==i)){var r=void 0;r=this.side.value()===t?4===i&&null===this.relativePrice.value()?t:this._getOffsetFromAbsolutePrice(this.price.value(),t,e):1===this.focusedControl.value()?0:4===i?t:-this._getOffsetFromRelativePrice();var s={base:this._getBase(t,i),offset:r};this.relativePrice.setValue(s)}},t.prototype._getPriceType=function(){var t=this.orderType.value();return 1===t||4===t&&this._isLimitPrice?1:2},t.prototype._setStep=function(){var t=this._getPriceType()
;1===t&&void 0!==this._instrumentInfo.limitPriceStep?this.step.setValue(this._instrumentInfo.limitPriceStep):2===t&&void 0!==this._instrumentInfo.stopPriceStep?this.step.setValue(this._instrumentInfo.stopPriceStep):this.step.setValue(this._instrumentInfo.minTick||this._instrumentInfo.pipSize)},t.prototype._roundToStepRequired=function(){var t=this._getPriceType(),e=this._instrumentInfo.minTick||this._instrumentInfo.pipSize;return 2===t&&void 0!==this._instrumentInfo.stopPriceStep?this._instrumentInfo.stopPriceStep!==e:1===t&&void 0!==this._instrumentInfo.limitPriceStep&&this._instrumentInfo.limitPriceStep!==e},t}(),x=(i("HbRj"),i("m6W+")),L=i("kcTO"),F=i("jjUP"),N=function(){function t(t,e,i,r,s,o,n,u,l,d){var p=this;this.formatter=new x.a,this.riskInCurrencyFormatter=new L.PriceFormatter(100),this.riskInPercentFormatter=new L.PriceFormatter(100),this.isRiskAvailable=new y.a(!1),this.focusedControl=new y.a(null),this.riskStep=.01,this.error=new k.a({res:!1},w.g),this.onControlFocused=new _.a,this.$value=new h.BehaviorSubject(null),this._focusSubscription=Object(w.t)(this.focusedControl),this._focusSubj=this._focusSubscription.subject,this._controlError=new h.BehaviorSubject({res:!1}),this.setControlError=function(t){p._controlError.next({res:t})},this._updateFocusIfNeeded=function(t){var e=p.focusedControl.value(),i=1===e&&!t.showCurrencyRiskInQty,r=2===e&&!t.showPercentRiskInQty;(i||r)&&p.focusedControl.setValue(0)},this.qty=s.qty,this._lotSize=s.lotSize,this.quantity={value:new y.a(null!==n?n:this.qty.default),onModifiedCallback:function(){return null!==d?d.setQtyControlModifiedProperty(a.l.Units):function(){}},calculatorUsedStat:function(){return null!==d?d.setCalculatorUsedProperty():function(){}}},this._quantitySubscription=Object(w.t)(this.quantity.value),this._quantitySubj=this._quantitySubscription.subject,this.currency=o||"",this.riskInCurrency={value:new y.a(null),onModifiedCallback:function(){return null!==d?d.setQtyControlModifiedProperty(a.l.RiskInCurrency):function(){}},calculatorUsedStat:function(){return null!==d?d.setCalculatorUsedProperty():function(){}}},this.riskInPercent={value:new y.a(null),onModifiedCallback:function(){return null!==d?d.setQtyControlModifiedProperty(a.l.RiskInPercent):function(){}},calculatorUsedStat:function(){return null!==d?d.setCalculatorUsedProperty():function(){}}},this._riskInCurrencySubscription=Object(w.t)(this.riskInCurrency.value),this._riskInPercentSubscription=Object(w.t)(this.riskInPercent.value),this._riskInCurrencySubj=this._riskInCurrencySubscription.subject,this._riskInPercentSubj=this._riskInPercentSubscription.subject,this.status=u,this._equity=i,this._pipValue=r,this._stopLossAvailable=t,this._stopLossPips=e,this._stopLossSubscription=this._stopLossAvailable.subscribe((function(t){p.isRiskAvailable.setValue(t),t||p.focusedControl.setValue(0)})),this._valuesSubscription=c.Observable.combineLatest(this._createQuantityObservable(),this._createRiskInCurrencyObservable(),this._createRiskInPercentObservable(),this._focusSubj).subscribe((function(t){
var e=t[0],i=t[1],r=t[2],s=t[3];p.quantity.value.value()===e&&p.riskInCurrency.value.value()===i&&p.riskInPercent.value.value()===r&&p.focusedControl.value()===s||p._setValuesForUnfocusedControls(s,e,i,r)})),this._resultSubscription=c.Observable.combineLatest(this._quantitySubj,this._controlError,this._focusSubj).subscribe((function(t){var e=t[0],i=t[1],r=t[2],s=Object(F.c)(p.qty,e,!0),o=i.res?i.msg:s.msg;p.error.setValue({res:s.res||i.res,msg:o}),p.$value.next(s.res||i.res||null===r?null:e)})),this.focusedControl.setValue(0),this._settings=l,this._settings.subscribe(this._updateFocusIfNeeded)}return t.prototype.unsubscribe=function(){this._stopLossSubscription.unsubscribe(),this._valuesSubscription.unsubscribe(),this._resultSubscription.unsubscribe(),this._focusSubscription.unsubscribe(),this._quantitySubscription.unsubscribe(),this._riskInCurrencySubscription.unsubscribe(),this._riskInPercentSubscription.unsubscribe(),this._settings.unsubscribe(this._updateFocusIfNeeded)},t.prototype._setValuesForUnfocusedControls=function(t,e,i,r){0!==t&&this.quantity.value.setValue(e),1!==t&&this.riskInCurrency.value.setValue(i),2!==t&&this.riskInPercent.value.setValue(r)},t.prototype._createQuantityObservable=function(){var t=this;return c.Observable.combineLatest([this._focusSubj,this._pipValue,this._quantitySubj,this._riskInCurrencySubj,this._riskInPercentSubj,this._stopLossPips,this._equity],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=i[0],o=i[1],n=i[2],u=i[3],a=i[4],l=i[5];switch(e){case 0:return o;case 1:return Object(F.e)(n,a,s,t.qty.step,t._lotSize);case 2:return Object(F.f)(u,l,a,s,t.qty.step,t._lotSize);default:return o}}))},t.prototype._createRiskInCurrencyObservable=function(){var t=this;return c.Observable.combineLatest([this._focusSubj,this._pipValue,this._quantitySubj,this._riskInCurrencySubj,this._riskInPercentSubj,this._stopLossPips,this._equity],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=i[0],o=i[1],n=i[2],u=i[3],a=i[4],l=i[5];switch(e){case 0:return Object(F.a)(o,a,s,t._lotSize);case 1:return n;case 2:var c=Object(F.f)(u,l,a,s,t.qty.step,t._lotSize);return Object(F.a)(c,a,s,t._lotSize);default:return Object(F.a)(o,a,s)}}))},t.prototype._createRiskInPercentObservable=function(){var t=this;return c.Observable.combineLatest([this._focusSubj,this._pipValue,this._quantitySubj,this._riskInCurrencySubj,this._riskInPercentSubj,this._stopLossPips,this._equity],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=i[0],o=i[1],n=i[2],u=i[3],a=i[4],l=i[5];switch(e){case 0:return Object(F.b)(o,a,s,l,t._lotSize);case 1:var c=Object(F.e)(n,a,s,t.qty.step,t._lotSize);return Object(F.b)(c,a,s,l,t._lotSize);case 2:return u;default:return Object(F.b)(o,a,s,l,t._lotSize)}}))},t}(),q=i("cUJV"),E=function(){function t(t,e,i,r,s,o,n,u){var l=this;this.focusedControl=new y.a(3),this.error=new k.a({res:!1},w.g),this.onControlFocused=new _.a,this.baseCurrencyCryptoBalance=new y.a(null),this.quoteCurrencyCryptoBalance=new y.a(null),
this.$value=new h.BehaviorSubject(null),this._focusSubscription=Object(w.t)(this.focusedControl),this._controlError=new h.BehaviorSubject({res:!1}),this._focusSubj=this._focusSubscription.subject,this.setControlError=function(t){l._controlError.next({res:t})},this.info=t,this.status=o,this.formatter=new q.a,this.quantity={value:new y.a(null!==s?s:t.qty.default||t.qty.step),onModifiedCallback:null!==u?function(){return u.setQtyControlModifiedProperty(a.l.BaseCurrency)}:function(){}},this.quoteCurrencyQuantity={value:new y.a(null!==s?s:t.qty.default||t.qty.step),onModifiedCallback:null!==u?function(){return u.setQtyControlModifiedProperty(a.l.QuoteCurrency)}:function(){}},this.side=n,this._quoteCurrencyQuantitySubscription=Object(w.t)(this.quoteCurrencyQuantity.value),this._baseCurrencyQuantitySubscription=Object(w.t)(this.quantity.value),this._baseCurrencyQuantitySubj=this._baseCurrencyQuantitySubscription.subject,this._quoteCurrencyQuantitySubj=this._quoteCurrencyQuantitySubscription.subject,this._sideSubscription=Object(w.t)(this.side),this._sideSubj=this._sideSubscription.subject;var d=[this._baseCurrencyQuantitySubj,this._quoteCurrencyQuantitySubj,this._controlError,this._focusSubj,this._sideSubj];i&&r&&(d.push(i),d.push(r)),this._subscriptions=[c.Observable.combineLatest(this._focusSubj,e,this._baseCurrencyQuantitySubj,this._quoteCurrencyQuantitySubj).subscribe((function(e){var i=e[0],r=e[1],s=e[2],o=e[3];if(4===i){if(null!==o){var n=Object(O.fixComputationError)(o/r);l.quantity.value.setValue(Object(O.fixComputationError)(Math.floor(n/t.qty.step)*t.qty.step))}}else null!==s&&l.quoteCurrencyQuantity.value.setValue(Object(O.fixComputationError)(s*r))})),c.Observable.combineLatest(d,(function(e,i,r,s,o){for(var n=[],u=5;u<arguments.length;u++)n[u-5]=arguments[u];var a=n[0],c=n[1],h=Object(F.c)(t.qty,e),d=-1===o?l._checkBalanceError(e,a):l._checkBalanceError(i,c);l.error.setValue({res:h.res||d.res||r.res,msg:h.msg||d.msg||r.msg}),l.$value.next(h.res||d.res||r.res||null===s?null:e)})).subscribe()],i&&this._subscriptions.push(i.subscribe((function(t){l.baseCurrencyCryptoBalance.setValue(t)}))),r&&this._subscriptions.push(r.subscribe((function(t){l.quoteCurrencyCryptoBalance.setValue(t)})))}return t.prototype.unsubscribe=function(){this._subscriptions.forEach((function(t){return t&&t.unsubscribe()}))},t.prototype._checkBalanceError=function(t,e){return null!==t&&e&&t>e.available?{res:!0,msg:F.d.balance}:{res:!1}},t}();i("gxrE");function R(t,e,i,r){return Object(O.fixComputationError)((t-e)/(r*i))}function A(t,e,i,r){return e?Math.floor(Object(O.fixComputationError)(t/(i*e*(r||1)))):0}function D(t,e,i,r,s){return e?Math.floor(Object(O.fixComputationError)(t*i/(r*e*(s||1)*100))):0}function $(t,e,i,r){return Object(O.fixComputationError)(i*t*r+e)}function W(t,e,i,r){return t*i*e*(r||1)}function Q(t,e,i,r,s){return i?t*r*e*(s||1)*100/i:0}var z={orderStopLoss:{long:window.t("Stop loss order must be below entry price."),short:window.t("Stop loss order must be higher entry price.")},orderTakeProfit:{
long:window.t("Take profit order must be above entry price."),short:window.t("Take profit order must be lower entry price.")},positionStopLoss:{long:function(t){return window.t("Stop loss must be below current __value__.",{value:t})},short:function(t){return window.t("Stop loss must be above current __value__.",{value:t})}},positionTakeProfit:{long:function(t){return window.t("Take profit must be above current __value__.",{value:t})},short:function(t){return window.t("Take profit must be below current __value__.",{value:t})}}},U={ask:window.t("ask"),bid:window.t("bid"),multiplyOfMinTick:window.t("Bracket price should be a multiple of {minTick}")};function H(t,e,i){return Object(w.s)(t,e)?{res:!1}:{res:!0,msg:U.multiplyOfMinTick.format({minTick:i.format(e)})}}var Y=function(){function t(t,e,i,r,s,o,n,u,l,d,p,b,f,v,P,m,g,S,O,C){var M=this;this.focusedControl=new y.a(null),this.error=new k.a({res:!1},w.g),this.onControlFocused=new _.a,this.slTypes=[a.a.StopLoss,a.a.TrailingStop],this.$value=new h.BehaviorSubject(null),this.roundToStopLimitPriceStepRequired=!1,this._errorSubj=new h.BehaviorSubject({res:!1}),this._controlError=new h.BehaviorSubject({res:!1}),this._enabledSubj=new h.BehaviorSubject(!1),this._focusSubscription=Object(w.t)(this.focusedControl),this.setControlError=function(t){M._controlError.next({res:t,msg:void 0})},this._updateFocusIfNeeded=function(t){var e=M.focusedControl.value(),i=M._supportCryptoBrackets?"showCryptoBracketsInPercent":"showBracketsInPercent",r=M._supportCryptoBrackets?"showCryptoBracketsInCurrency":"showBracketsInCurrency";(3===e&&!t[i]||2===e&&!t[r])&&M.focusedControl.setValue(0)},this.bracketType=new y.a(i);var V,j,T=null!==t;this.enabled=new y.a(e),T&&this.focusedControl.setValue(1),this._supportCryptoBrackets=!0===C,T?(V=null,j=t):(V=null!==P?P:this._getDefaultPips(i),j=null),this.pips={value:new y.a(V),displayProps:{step:1,formatter:new L.PriceFormatter(n.pipSize!==n.minTick?10:1)},onModifiedCallback:null!==g?function(){return g.setBracketControlModifiedProperty(i,a.c.Pips)}:function(){}},this._priceStep=n.minTick||n.pipSize,i===a.a.StopLoss&&void 0!==n.stopPriceStep&&n.stopPriceStep!==this._priceStep?(this._priceStep=n.stopPriceStep,this.roundToStopLimitPriceStepRequired=!0):i===a.a.TakeProfit&&void 0!==n.limitPriceStep&&n.limitPriceStep!==this._priceStep&&(this._priceStep=n.limitPriceStep,this.roundToStopLimitPriceStepRequired=!0),this.price={value:new y.a(j),displayProps:{step:this._priceStep,formatter:r},onModifiedCallback:null!==g?function(){return g.setBracketControlModifiedProperty(i,a.c.Price)}:function(){}},this.riskInCurrency={value:new y.a(null),displayProps:{step:.01,formatter:new L.PriceFormatter(100)},onModifiedCallback:null!==g?function(){return g.setBracketControlModifiedProperty(i,a.c.Money)}:function(){}},this.riskInPercent={value:new y.a(null),displayProps:{step:.01,formatter:new L.PriceFormatter(100)},onModifiedCallback:null!==g?function(){return g.setBracketControlModifiedProperty(i,a.c.Percent)}:function(){}};var I=1!==v||S===a.h.Editing
;this._inputDisabled=!O&&I&&i===a.a.TrailingStop&&Boolean(P),this._labelDisabled=!O&&I&&e,this.typeSwitcherDisabled={inputDisabled:this._inputDisabled,labelDisabled:this._labelDisabled},this._pipsSubscription=Object(w.t)(this.pips.value),this._priceSubscription=Object(w.t)(this.price.value),this._riskInCurrencySubscription=Object(w.t)(this.riskInCurrency.value),this._riskInPercentSubscription=Object(w.t)(this.riskInPercent.value),this._enabledSubscription=Object(w.t)(this.enabled),this._bracketTypeSubscription=Object(w.t)(this.bracketType),this.currency=f.length>0?f:window.t("Money"),this._equity=s,this._pipValue=u,this._pipSize=n.pipSize,this._lotSize=n.lotSize,this._side=l,this._sideSign=this._side.map((function(t){return(i!==a.a.TakeProfit?-1:1)*t})),this._quotes=o,this._amount=d,this._parent=v,this._type=i,this._focus=this._focusSubscription.subject,this._pipsSubj=this._pipsSubscription.subject,this._priceSubj=this._priceSubscription.subject,this._riskInCurrencySubj=this._riskInCurrencySubscription.subject,this._riskInPercentSubj=this._riskInPercentSubscription.subject,this._enabledSubj=this._enabledSubscription.subject,this._bracketTypeSubj=this._bracketTypeSubscription.subject,this._orderPrice=c.Observable.combineLatest(p,b,this._bracketTypeSubj,o,this._side,(function(t,e,i,r,s){return i!==a.a.TrailingStop||2!==e&&1===v?t:1===s?Object(w.m)(r):Object(w.l)(r)})),this._valuesSubscription=c.Observable.combineLatest([this._enabledSubj,this._side,this._focus,this._quotes,this._createPipsObservable(),this._createPriceObservable(),this._createRiskInCurrencyObservable(),this._createRiskInPercentObservable()],(function(t,e,i,s){for(var o=[],n=4;n<arguments.length;n++)o[n-4]=arguments[n];var u=o[0],a=o[1],l=o[2],c=o[3];if((t||null===M.riskInCurrency.value.value())&&(M.focusedControl.value()!==i||M.pips.value.value()!==u||M.price.value.value()!==a||M.riskInCurrency.value.value()!==l||M.riskInPercent.value.value()!==c)){M._setValuesForUnfocusedControls(i,u,a,l,c);var h={res:!1};h=2===M._parent?M._checkPositionError(e,u,a,s):M._checkOrderError(e,u,a),M.roundToStopLimitPriceStepRequired&&!h.res&&1===M.focusedControl.value()&&(h=H(a,M._priceStep,r)),M._errorSubj.next(h)}})).subscribe(),this._resultSubscription=c.Observable.combineLatest(this._pipsSubj,this._errorSubj,this._controlError,this._focus,this._enabledSubj).subscribe((function(t){var e=t[0],i=t[1],r=t[2],s=t[3],o=t[4],n=r.res?r.msg:i.msg;M.error.setValue({res:i.res||r.res,msg:n}),M.$value.next(i.res||r.res||null===s||!o?null:e)})),this._settings=m,this._settings.subscribe(this._updateFocusIfNeeded)}return t.prototype.unsubscribe=function(){this._focusSubscription.unsubscribe(),this._pipsSubscription.unsubscribe(),this._priceSubscription.unsubscribe(),this._riskInCurrencySubscription.unsubscribe(),this._riskInPercentSubscription.unsubscribe(),this._valuesSubscription.unsubscribe(),this._resultSubscription.unsubscribe(),this._bracketTypeSubscription.unsubscribe(),this._settings.unsubscribe(this._updateFocusIfNeeded)},t.prototype.readyToSubmit=function(){
return this.enabled.value()&&null!==this.$value.getValue()&&null!==this.price.value.value()||!this.enabled.value()},t.prototype._getDefaultPips=function(t){return t===a.a.TakeProfit?a.b.TakeProfit:a.b.StopLoss},t.prototype._setValuesForUnfocusedControls=function(t,e,i,r,s){0!==t&&this.pips.value.setValue(e),1!==t&&this.price.value.setValue(i),2!==t&&this.riskInCurrency.value.setValue(r),3!==t&&this.riskInPercent.value.setValue(s),null===this.focusedControl.value()&&this.focusedControl.setValue(0)},t.prototype._checkOrderError=function(t,e,i){if(e<=0||i<=0){var r=this._type===a.a.TakeProfit?z.orderTakeProfit:z.orderStopLoss;return{res:!0,msg:1===t?r.long:r.short}}return{res:!1}},t.prototype._checkPositionError=function(t,e,i,r){var s=(this._type===a.a.TakeProfit?-1:1)*t,o=-1===t?Object(w.l)(r):Object(w.m)(r),n=-1===t?U.ask:U.bid,u=this._type===a.a.TakeProfit?z.positionTakeProfit:z.positionStopLoss;return o&&Math.sign(i-o)===s?{res:!0,msg:-1===t?u.short(n):u.long(n)}:{res:!1}},t.prototype._createPipsObservable=function(){var t=this;return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=i[0],o=i[1],n=i[2],u=i[3],a=i[4],l=i[5],c=i[6],h=i[7],d=i[8];switch(e){case 0:return l;case 1:return R(c,a,s,t._pipSize);case 2:return A(h,n,o,t._lotSize);case 3:return D(d,n,u,o,t._lotSize);default:return l}}))},t.prototype._createPriceObservable=function(){var t=this;return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s,o=i[0],n=i[1],u=i[2],l=i[3],c=i[4],h=i[5],d=i[6],p=i[7],b=i[8],f=t._type===a.a.TakeProfit?1:2;switch(e){case 0:s=$(h,c,o,t._pipSize);break;case 1:return d;case 2:s=$(A(p,u,n,t._lotSize),c,o,t._pipSize);break;case 3:s=$(D(b,u,l,n,t._lotSize),c,o,t._pipSize);break;default:s=$(h,c,o,t._pipSize)}return t.roundToStopLimitPriceStepRequired?Object(M.x)(s,t._priceStep,f,o):s}))},t.prototype._createRiskInCurrencyObservable=function(){var t=this;return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=i[0],o=i[1],n=i[2],u=i[3],a=i[4],l=i[5],c=i[6],h=i[7],d=i[8];switch(e){case 0:return W(l,n,o,t._lotSize);case 1:return W(R(c,a,s,t._pipSize),n,o,t._lotSize);case 2:return h;case 3:return W(D(d,n,u,o,t._lotSize),n,o,t._lotSize);default:return W(l,n,o,t._lotSize)}}))},t.prototype._createRiskInPercentObservable=function(){var t=this
;return c.Observable.combineLatest([this._focus,this._sideSign,this._pipValue,this._amount,this._equity,this._orderPrice,this._pipsSubj,this._priceSubj,this._riskInCurrencySubj,this._riskInPercentSubj],(function(e){for(var i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var s=i[0],o=i[1],n=i[2],u=i[3],a=i[4],l=i[5],c=i[6],h=i[7],d=i[8];switch(e){case 0:return Q(l,n,u,o,t._lotSize);case 1:return Q(R(c,a,s,t._pipSize),n,u,o,t._lotSize);case 2:return Q(A(h,n,o,t._lotSize),n,u,o,t._lotSize);case 3:return d;default:return Q(l,n,u,o,t._lotSize)}}))},t}(),K=i("MiOS"),G=function(){function t(t,e,i,r,s){var o=this;this.onControlFocused=new _.a,this.duration=new k.a(t,w.g),this.durations=e,this.orderType=i,this._durationForMarketOrders=s,this._durationSubscription=Object(w.t)(this.duration),this._orderTypeSubscription=Object(w.t)(this.orderType),this.$value=new h.BehaviorSubject(this._getOrderDurationByOrderType(t,i.value())),this._subscription=c.Observable.combineLatest(this._durationSubscription.subject,this._orderTypeSubscription.subject).subscribe((function(t){var e=t[0],i=t[1];o.$value.next(o._getOrderDurationByOrderType(e,i))})),this.onModifiedCallback=null!==r?function(){return r.setDurationControlModifiedProperty()}:function(){}}return t.prototype.unsubscribe=function(){this._subscription.unsubscribe(),this._durationSubscription.unsubscribe(),this._orderTypeSubscription.unsubscribe()},t.prototype.getValue=function(){var t=this.$value.getValue();if(null===t)return null;var e=this.durations.find((function(e){return t.type===e.value}));if(void 0===e)return null;var i={type:t.type};return(e.hasDatePicker||e.hasTimePicker)&&(i.datetime=t.datetime),i},t.prototype._getOrderDurationByOrderType=function(t,e){if(2===e&&!this._durationForMarketOrders)return null;var i=Object(K.a)(e,this.durations);if(0===i.length)return null;var r=i.some((function(e){return t.type===e.value})),s=i.find((function(t){return Boolean(t.default)}))||i[0],o=Object(K.e)(s);return r?t:o},t}(),J=window.t("Modify"),X=window.t("Modify order"),Z=function(){return function(t,e,i,r){var s=this;if(this.value=new y.a(""),this.unsubscribe=function(){s._orderSubscription&&s._orderSubscription.unsubscribe()},i||2===t)this.value.setValue(1===t?X:J);else{var o=Object(d.ensureDefined)(r);this._orderTypeSubsctiption=Object(w.t)(o.orderType),this._orderTypeSubj=this._orderTypeSubsctiption.subject,this._statusSubscription=Object(w.t)(e),this._statusSubj=this._statusSubscription.subject,this._orderSubscription=c.Observable.combineLatest([this._orderTypeSubj,this._statusSubj,o.orderPlacingStatus,o.side,o.quantity,o.stopPrice,o.limitPrice],(function(t,e,i,r){for(var n=[],u=4;u<arguments.length;u++)n[u-4]=arguments[u];var l=n[0],c=n[1],h=n[2];if(e===a.h.Preview)return s.value.setValue(window.t("Send"));if(e===a.h.Wait)return i===a.i.Placed?s.value.setValue(window.t("Order sent")):s.value.setValue(window.t("Click any field to activate order placement"))
;var d=null!==c?o.formatter.format(c):"",p=null!==h?o.formatter.format(h):"",b=null!==l?o.quantityFormatter.format(l):"",f=1===r?w.r.buy:w.r.sell;switch(t){case 2:return s.value.setValue(f.market(b,o.symbol));case 3:return s.value.setValue(f.stop(b,o.symbol,d));case 1:return s.value.setValue(f.limit(b,o.symbol,p));case 4:return s.value.setValue(f.stopLimit(b,o.symbol,d,p))}})).subscribe()}}}(),tt={title:window.t("Order Info"),pipValue:window.t("Pip Value"),tradeValue:window.t("Trade Value"),total:window.t("Total"),leverage:window.t("Leverage"),lotSize:window.t("Lot Size"),reward:window.t("Reward"),risk:window.t("Risk")},et=function(){function t(t,e,i,r,s,o,n,u,a,l,c){this._availableMargin=new y.a(0),this._usedMargin=new y.a(0),this._textOutputs=new k.a([],w.g),this._tpRiskInCurrencySubscription=null,this._tpRiskInPercentSubscription=null,this._slRiskInCurrencySubscription=null,this._slRiskInPercentSubscription=null,this._riskFormatter=new L.PriceFormatter(100),this._marginAvailable$=t,this._qty$=e,this._pipValue$=r,this._side$=o,this._type=u.type,this._minTick=u.minTick,this._currency=i,this._marginRate=u.marginRate,this._hasMarginMeter=c&&void 0!==this._marginRate,this._price$=s,this._showTotalInsteadOfTradeValue=n,this._leverage=u.leverage,this._lotSize=u.lotSize,this._symbolPipSize=u.pipSize,this._pipValueForCurrentQuantity=0,this._tradeValue=0,a&&l&&(this._tpRiskInCurrencySubscription=Object(w.t)(a.riskInCurrency),this._tpRiskInPercentSubscription=Object(w.t)(a.riskInPercent),this._slRiskInCurrencySubscription=Object(w.t)(l.riskInCurrency),this._slRiskInPercentSubscription=Object(w.t)(l.riskInPercent))}return t.prototype.subscribe=function(){var t=this,e=[this._price$,this._pipValue$,this._side$,this._qty$],i=[c.Observable.combineLatest(e,(function(e,i,r,s){for(var o=[],n=4;n<arguments.length;n++)o[n-4]=arguments[n];var u=o[0],a=o[1],l=o[2],c=o[3],h=o[4],d=o[5];t._pipValueForCurrentQuantity=Object(w.b)(s,i,t._lotSize),t._tradeValue="crypto"===t._type?(null!==s?s:0)*e:Object(w.c)(s,e,i,t._symbolPipSize,t._lotSize),t._usedMargin.setValue(Object(w.d)(t._tradeValue,t._marginRate));var p=[],b=Object(w.i)(t._leverage,t._marginRate);if(null!==b&&p.push({title:tt.leverage,value:b}),"number"==typeof t._lotSize&&Number.isFinite(t._lotSize)&&p.push({title:tt.lotSize,value:""+t._lotSize}),"crypto"!==t._type&&Number.isFinite(t._pipValueForCurrentQuantity)&&p.push({title:tt.pipValue,value:t._currency+" "+Object(w.j)(t._pipValueForCurrentQuantity)}),Number.isFinite(t._tradeValue)){var f="crypto"===t._type?t._tradeValue.toFixed(Object(w.n)(t._minTick)):Object(w.j)(t._tradeValue);p.push({title:t._showTotalInsteadOfTradeValue?tt.total:tt.tradeValue,value:t._currency+" "+f})}u&&null!==a&&null!==l&&p.push({title:tt.reward,value:t._riskFormatter.format(l)+"% ("+t._currency+" "+t._riskFormatter.format(a)+")"}),c&&null!==h&&null!==d&&p.push({title:tt.risk,value:t._riskFormatter.format(d)+"% ("+t._currency+" "+t._riskFormatter.format(h)+")"}),t._textOutputs.setValue(p)})).subscribe()]
;return this._hasMarginMeter&&i.push(Object(d.ensureNotNull)(this._marginAvailable$).subscribe((function(e){return t._updateAvailableMargin(e)}))),i},t.prototype.title=function(){return tt.title},t.prototype.textOutputs=function(){return this._textOutputs},t.prototype.hasMarginMeter=function(){return this._hasMarginMeter},t.prototype.availableMargin=function(){return this._availableMargin},t.prototype.usedMargin=function(){return this._usedMargin},t.prototype.pipValue=function(){throw new Error("not supported")},t.prototype.tradeValue=function(){throw new Error("not supported")},t.prototype.tpRiskInCurrency=function(){throw new Error("not supported")},t.prototype.tpRiskInPercent=function(){throw new Error("not supported")},t.prototype.slRiskInCurrency=function(){throw new Error("not supported")},t.prototype.slRiskInPercent=function(){throw new Error("not supported")},t.prototype._updateAvailableMargin=function(t){this._availableMargin.setValue(t)},t}(),it=i("jofe"),rt=i("txPx"),st=Object(rt.getLogger)("PromiseWithDefault");function ot(t,e,i){return t.catch((function(t){return st.logError(t),i&&i(),e}))}var nt={symbol:window.t("Symbol"),ask:window.t("Ask"),bid:window.t("Bid"),orderType:window.t("Type"),side:window.t("Side"),quantity:window.t("Quantity"),price:window.t("Price"),stopPrice:window.t("Stop price"),limitPrice:window.t("Limit price"),currency:window.t("Currency"),stopLoss:window.t("Stop Loss"),takeProfit:window.t("Take Profit"),buy:window.t("Buy"),sell:window.t("Sell"),warning:window.t("Estimated money impact is for main order only")},ut=function(){function t(t,e,i,r,s,o,n,u){this.warning=void 0,this._textQuotesOutputs=new k.a([],w.g),this._textOrderOutputs=[],this._textInfoOutputs=[],this.order=t,this.confirmId=e.confirmId,this.onCancelClick=r,this.onPlaceClick=s,this._quotes$=i,this._currency=u,this._formatter=o,this._quantityFormatter=n,this._textInfoOutputs=e.info,this._fillQuotesInfo(),this._fillOrderInfo(),(t.takeProfit||t.stopLoss)&&(this.warning=nt.warning)}return t.prototype.subscribe=function(){var t=this;return this._quotes$.subscribe((function(e){return t._fillQuotesInfo(e)}))},t.prototype.textQuotesOutputs=function(){return this._textQuotesOutputs},t.prototype.textOrderOutputs=function(){return this._textOrderOutputs},t.prototype.textInfoOutputs=function(){return this._textInfoOutputs},t.prototype._fillQuotesInfo=function(t){var e=[];e.push({title:nt.symbol,value:this.order.symbol}),e.push({title:nt.ask,value:t?this._formatter.format(t.ask):""}),e.push({title:nt.bid,value:t?this._formatter.format(t.bid):""}),this._textQuotesOutputs.setValue(e)},t.prototype._fillOrderInfo=function(){this._textOrderOutputs.push({title:nt.orderType,value:this.order.type?a.m[this.order.type]:""}),this._textOrderOutputs.push({title:nt.side,value:1===this.order.side?nt.buy:nt.sell}),this._textOrderOutputs.push({title:nt.quantity,value:this._quantityFormatter.format(this.order.qty)}),3!==this.order.type&&1!==this.order.type||this._textOrderOutputs.push({title:nt.price,
value:this._formatter.format(3===this.order.type?this.order.stopPrice:this.order.limitPrice)}),4===this.order.type&&(this._textOrderOutputs.push({title:nt.stopPrice,value:this._formatter.format(this.order.stopPrice)}),this._textOrderOutputs.push({title:nt.limitPrice,value:this._formatter.format(this.order.limitPrice)})),this.order.stopLoss&&this._textOrderOutputs.push({title:nt.stopLoss,value:String(this.order.stopLoss)}),this.order.takeProfit&&this._textOrderOutputs.push({title:nt.takeProfit,value:String(this.order.takeProfit)}),this._currency.length>0&&this._textOrderOutputs.push({title:nt.currency,value:this._currency})},t}(),at=Object(rt.getLogger)("Trading.OrderViewModel");var lt=function(){function t(t,e,i,r,o,n,u,l,p,f,v,P,m,g,S){var O=this;if(void 0===v&&(v=null),this.orderType=new y.a(null),this.orderInfoModel=null,this.orderPreviewModel=null,this.customFieldModels=new y.a([]),this.onDoneButtonClicked=Object(it.createDeferredPromise)(),this.status=new y.a(a.h.Active),this.rewardRisk=new y.a(""),this.disabled=new y.a(!1),this.loading=new y.a(!1),this.needSignIn=!1,this.noBroker=!1,this.symbolHasLotSize=!1,this.id=Object(b.randomHashN)(6),this.existingOrder=!1,this._prevOrderType=new y.a(null),this._onModeChanged=new _.a,this._onInputStateChanged=new _.a,this._onCloseButtonClicked=new _.a,this._onBackButtonClicked=new _.a,this._subscriptions=[],this._stopLossPips=new h.BehaviorSubject(25),this._stopLossAvailable=new h.BehaviorSubject(!1),this._orderWidgetStat=null,this._existingPlacedOrder=null,this._marginAvailable$=null,this._baseCurrencyCryptoBalance$=null,this._quoteCurrencyCryptoBalance$=null,this._orderPlacingStatus=new h.BehaviorSubject(a.i.Creating),this._destroyed=!1,this._setSolutionAccount=null,this.doneButtonClick=function(){if(!O.loading.value()){O.loading.setValue(!0),O._initialInputState.quantity=O._currentInputState.quantity;var t=O.sideModel.numericQuotes.value(),e=(1===O.sideModel.side.value()?t.ask:t.bid)||0,i={symbol:O.symbol,type:Object(d.ensureNotNull)(O.orderType.value()),side:O.sideModel.$value.getValue(),qty:0,seenPrice:e};if(i.qty=Object(d.ensureNotNull)(O.quantityModel.$value.getValue()),4===O.orderType.value()?(i.stopPrice=Object(d.ensureNotNull)(O.stopPriceModel.$value.getValue()),i.limitPrice=Object(d.ensureNotNull)(O.limitPriceModel.$value.getValue())):3===O.orderType.value()?i.stopPrice=Object(d.ensureNotNull)(O.stopPriceModel.$value.getValue()):1===O.orderType.value()&&(i.limitPrice=Object(d.ensureNotNull)(O.limitPriceModel.$value.getValue())),O.durationModel){var r=O.durationModel.getValue();null!==r&&(i.duration=r)}if(O.stopLossModel&&(delete i.stopLoss,delete i.trailingStopPips,O.stopLossModel.bracketType.value()===a.a.StopLoss&&(i.stopLoss=O.stopLossModel.enabled.value()?Object(d.ensureNotNull)(O.stopLossModel.$value.getValue()&&O.stopLossModel.price.value.value()):void 0,i.trailingStopPips=void 0),O.stopLossModel.bracketType.value()===a.a.TrailingStop&&(i.trailingStopPips=O.stopLossModel.enabled.value()?Object(d.ensureNotNull)(O.stopLossModel.$value.getValue()):void 0,
i.stopLoss=void 0!==i.trailingStopPips?void 0:i.stopLoss)),O.takeProfitModel&&(i.takeProfit=O.takeProfitModel.enabled.value()?Object(d.ensureNotNull)(O.takeProfitModel.$value.getValue()&&O.takeProfitModel.price.value.value()):void 0),Array.isArray(O.customFieldModels.value())&&(i.customFields=O._getCustomFields()),(O.existingOrder?O.supportModifyOrderPreview:O.supportPlaceOrderPreview)&&O._settings.value().showOrderPreview){if(null===O.orderPreviewModel)return void O._adapter.previewOrder(i).then((function(t){O.orderPreviewModel=new ut(i,t,O._quotes$,O._back,O.doneButtonClick,O.formatter,O.quantityModel.formatter,Object(d.ensureDefined)(O.currency)),O._subscriptions.push(O.orderPreviewModel.subscribe()),O.loading.setValue(!1),O.status.setValue(a.h.Preview)})).catch((function(t){O.loading.setValue(!1),O._showErrorNotification(Object(s.t)("Order preview"),"object"==typeof t?t.message:t)}));i=O.orderPreviewModel.order}O._doneHandler(i,null!==O.orderPreviewModel?O.orderPreviewModel.confirmId:void 0).then((function(t){O.loading.setValue(!1),null!==O.orderPreviewModel&&O._suggestedQty.setValue(O.symbol,O.orderPreviewModel.order.qty),t&&(O.mode.value()===a.g.Popup?O.headerModel.close():O._backToDefaultOrderPanel(),O.existingOrder||O._orderPlacingStatus.next(a.i.Placed),O.onDoneButtonClicked.resolve(!0)),t||null===O.orderPreviewModel||O._back(),O.orderPreviewModel=null}))}},this.activateOrderPanel=function(){O.status.setValue(O.existingOrder?a.h.Editing:a.h.Active),O.orderType.unsubscribe(O.activateOrderPanel),O.sideModel&&O.sideModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),O.limitPriceModel&&O.limitPriceModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),O.stopPriceModel&&O.stopPriceModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),O.quantityModel&&O.quantityModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),O.takeProfitModel&&O.takeProfitModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),O.stopLossModel&&O.stopLossModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),O.durationModel&&O.durationModel.onControlFocused.unsubscribe(O,O.activateOrderPanel),Array.isArray(O.customFieldModels.value())&&O.customFieldModels.value().length>0&&O.customFieldModels.value().forEach((function(t){t.onControlFocused.unsubscribe(O,O.activateOrderPanel)})),O._orderPlacingStatus.next(a.i.Creating)},this._noQuotesCallback=function(){O._trackEvent("Order Ticket","No Quotes")},this._updateMode=function(){O.mode.value()===a.g.Popup&&O.status.value()!==a.h.Preview&&O.activateOrderPanel(),O.toggleCancelButton()},this._syncOrderPricesAndFocuses=function(){1===O.orderType.value()&&4===O._prevOrderType.value()&&(O.limitPriceModel.forceAbsolutePriceUpdate(O.stopPriceModel.price.value()),O.limitPriceModel.forceRelativePriceUpdate()),1===O.orderType.value()&&3===O._prevOrderType.value()&&(O.limitPriceModel.forceAbsolutePriceUpdate(O.stopPriceModel.price.value()),O.limitPriceModel.focusedControl.setValue(O.stopPriceModel.focusedControl.value()),O.limitPriceModel.forceRelativePriceUpdate()),
3===O.orderType.value()&&1===O._prevOrderType.value()&&(O.stopPriceModel.forceAbsolutePriceUpdate(O.limitPriceModel.price.value()),O.stopPriceModel.focusedControl.setValue(O.limitPriceModel.focusedControl.value()),O.stopPriceModel.forceRelativePriceUpdate()),4===O.orderType.value()&&(1===O._prevOrderType.value()&&(O.stopPriceModel.forceAbsolutePriceUpdate(O.limitPriceModel.price.value()),O.stopPriceModel.forceRelativePriceUpdate()),3===O._prevOrderType.value()&&O.limitPriceModel.forceAbsolutePriceUpdate(O.stopPriceModel.price.value()),O._syncStopLimitPrices(),O.limitPriceModel.forceStopLimitRelativePriceUpdate()),O._prevOrderType.setValue(O.orderType.value())},this._syncStopLimitPrices=function(){4===O.orderType.value()&&O.limitPriceModel.syncWithPrice(O.stopPriceModel.price.value())},this._back=function(){O.orderPreviewModel=null,O.onDoneButtonClicked.resolve(!1),O._onBackButtonClicked.fire()},this._toggleTradingWidget=l,this._onNeedSelectBroker=p,this._showErrorNotification=P,this._trackEvent=f,this._orderWidgetStat=v,this._suggestedQty=m,this.mode=r,this._settings=o,function(t){return t.hasOwnProperty("id")}(e)&&(this.existingOrder=!0,this._existingPlacedOrder=e),this.status=new y.a(this.existingOrder?a.h.Editing:a.h.Active),this.symbol=e.symbol,this._orderStatusSubscription=Object(w.t)(this.status),this._loadingSubscription=Object(w.t)(this.loading),this._status=this._orderStatusSubscription.subject,this._loading=this._loadingSubscription.subject,this._panelCanBeShown=u,null!==t)if(this._adapter=t,n.tradable){this._handler=i,this._orderTemplate=Object.assign({},e),this.existingOrder=e.hasOwnProperty("id"),this.status.setValue(this.existingOrder?a.h.Editing:a.h.Active);var k=Boolean(e.takeProfit||e.stopLoss),C=t.metainfo().configFlags;this.supportEditAmount=C.supportEditAmount,this.showQuantityInsteadOfAmount=C.showQuantityInsteadOfAmount,this.supportMarketOrders=C.supportMarketOrders,this.supportLimitOrders=C.supportLimitOrders,this.supportStopOrders=C.supportStopOrders,this.supportStopLimitOrders=C.supportStopLimitOrders,this.supportBrackets=C.supportOrderBrackets&&!(e.hasOwnProperty("parentId")&&e.parentId)&&(!this.existingOrder||this.existingOrder&&(k||C.supportAddBracketsToExistingOrder)),this.supportTrailingStop=this.supportBrackets&&C.supportTrailingStop,this.supportModifyTrailingStop=this.supportBrackets&&C.supportModifyTrailingStop,this.supportMarketBrackets=C.supportMarketBrackets,this.supportModifyDuration=C.supportModifyDuration,this.supportPlaceOrderPreview=C.supportPlaceOrderPreview,this.supportModifyOrderPreview=C.supportModifyOrderPreview,this.supportCryptoExchangeOrderTicket=C.supportCryptoExchangeOrderTicket,this.durationForMarketOrders=C.durationForMarketOrders,this.supportBalances=C.supportBalances,this.supportCryptoBrackets=C.supportCryptoBrackets,this.supportStopOrdersInBothDirections=C.supportStopOrdersInBothDirections,
this.orderType.setValue(e.hasOwnProperty("type")&&e.type||this.supportMarketOrders&&2||this.supportLimitOrders&&1||this.supportStopOrders&&3||this.supportStopLimitOrders&&4||null),this._prevOrderType.setValue(this.orderType.value()),this._orderTypeSubscription=Object(w.t)(this.orderType),this._orderType=this._orderTypeSubscription.subject,this._suggestedQty=m,this._suggestedQty.changed.subscribe(this,this._suggestedQtyChangedHandler),this.onReady=Promise.all([t.symbolInfo(e.symbol),ot(t.accountMetainfo(),{id:t.currentAccount(),name:t.metainfo().title}),ot(t.quotesSnapshot(e.symbol),{},this._noQuotesCallback),ot(t.formatter(e.symbol,!1),new L.PriceFormatter),ot(t.spreadFormatter(e.symbol),new L.PriceFormatter),ot(m.value(e.symbol),1e3)]).then((function(i){var r=i[0],s=i[1],o=i[2],u=i[3],a=i[4],l=i[5];O._symbolInfo=r,O._destroyed||(O.displaySymbolName=r.brokerSymbol||"brokerSymbol"in e&&e.brokerSymbol||O.symbol,O.currency=Object(w.o)(r,s),O.formatter=u,O.symbolHasLotSize=r.hasOwnProperty("lotSize"),O._initialInputState=O._getInitialInputState(t,e,l,g),O._currentInputState=Object.assign({},O._initialInputState),O.customFieldModels.setValue(Object(w.h)(O.existingOrder,O.status,t.getOrderDialogOptions(e.symbol),Object.assign(O._currentInputState.customFields||{},e.customFields))),O._currentInputState.quantity=O._orderTemplate.qty||l,O._quotes$=c.Observable.fromEventPattern((function(i){return t.subscribeRealtime(e.symbol,i)}),(function(i){return t.unsubscribeRealtime(e.symbol,i)}),(function(t,e){return Object(w.a)(e,r.minTick)})).publishReplay(1).refCount(),O._equity$=c.Observable.fromEventPattern((function(e){return t.subscribeEquity(e)}),(function(e){return t.unsubscribeEquity(e)}),(function(t,e){return e})).startWith(NaN).publishReplay(1).refCount(),O._marginAvailable$=C.supportMargin?c.Observable.fromEventPattern((function(e){return t.subscribeMarginAvailable(e)}),(function(e){return t.unsubscribeMarginAvailable(e)}),(function(t,e){return e})).publish():null,O._baseCurrencyCryptoBalance$=C.supportBalances?c.Observable.fromEventPattern((function(e){return t.subscribeCryptoBalance(r.baseCurrency||"",e)}),(function(e){return t.unsubscribeCryptoBalance(r.baseCurrency||"",e)}),(function(t,e){return e})).startWith({symbol:r.baseCurrency||"",total:0,available:0}).publish():null,O._quoteCurrencyCryptoBalance$=C.supportBalances?c.Observable.fromEventPattern((function(e){return t.subscribeCryptoBalance(r.quoteCurrency||"",e)}),(function(e){return t.unsubscribeCryptoBalance(r.quoteCurrency||"",e)}),(function(t,e){return e})).startWith({symbol:r.quoteCurrency||"",total:0,available:0}).publish():null,O._pipValues$=c.Observable.fromEventPattern((function(i){return t.subscribePipValue(e.symbol,i)}),(function(i){return t.unsubscribePipValue(e.symbol,i)}),(function(t,e){return e})).startWith({buyPipValue:r.pipValue,sellPipValue:r.pipValue}).publish(),0===O._orderTemplate.limitPrice&&!1===O.existingOrder&&(O._orderTemplate.limitPrice=1===O._orderTemplate.side?Object(w.l)(o):Object(w.m)(o)),
0===O._orderTemplate.stopPrice&&!1===O.existingOrder&&(O._orderTemplate.stopPrice=1===O._orderTemplate.side?Object(w.m)(o):Object(w.l)(o)),O._createModels(e,r,a,n.tradable,S),O._subscribe(),O._onInputStateChanged.fire(O._getCurrentInputState()))})).catch((function(t){throw at.logError("Failed to create order model: "+t),t}))}else this.onReady=this._prepareTradableSolution(n);else this.onReady=Promise.resolve()}return t.prototype.destroy=function(){var t=this;this._destroyed=!0,this._subscriptions.forEach((function(t){return t&&t.unsubscribe()})),this._orderStatusSubscription.unsubscribe(),this._loadingSubscription.unsubscribe(),this._orderTypeSubscription&&this._orderTypeSubscription.unsubscribe(),this._suggestedQty&&this._suggestedQty.changed.unsubscribe(this,this._suggestedQtyChangedHandler),this.headerModel&&(this.headerModel.unsubscribe(),this.headerModel.pinButtonClicked().unsubscribe(this,this._toggleMode),this.headerModel.cancelButtonClicked().unsubscribe(this,this._cancel),this.headerModel.closeButtonClicked().unsubscribe(this,this._closeWidget),this.headerModel.backButtonClicked().unsubscribe(this,this._back)),this.sideModel&&(this.sideModel.unsubscribe(),this.sideModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.limitPriceModel&&(this.limitPriceModel.unsubscribe(),this.limitPriceModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.stopPriceModel&&(this.stopPriceModel.price.unsubscribe(this._syncStopLimitPrices),this.stopPriceModel.unsubscribe(),this.stopPriceModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.quantityModel&&(this.quantityModel.unsubscribe(),this.quantityModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.takeProfitModel&&(this.takeProfitModel.unsubscribe(),this.takeProfitModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.stopLossModel&&(this.stopLossModel.unsubscribe(),this.stopLossModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),this.durationModel&&(this.durationModel.unsubscribe(),this.durationModel.onControlFocused.unsubscribe(this,this.activateOrderPanel)),Array.isArray(this.customFieldModels.value())&&this.customFieldModels.value().length>0&&this.customFieldModels.value().forEach((function(e){e.onControlFocused.unsubscribe(t,t.activateOrderPanel),e.subscription&&e.subscription.unsubscribe()})),this.buttonModel&&this.buttonModel.unsubscribe(),this._customFieldsSubscription&&this._customFieldsSubscription.unsubscribe(),this._adapter&&this._adapter.orderUpdate.unsubscribe(this,this._orderUpdate),this.orderType.unsubscribe(this._syncOrderPricesAndFocuses),this.orderType.unsubscribe(this.activateOrderPanel),this.mode.unsubscribe(this._updateMode)},t.prototype.onModeChanged=function(){return this._onModeChanged},t.prototype.onInputStateChanged=function(){return this._onInputStateChanged},t.prototype.onCloseButtonClicked=function(){return this._onCloseButtonClicked},t.prototype.onBackButtonClicked=function(){return this._onBackButtonClicked},t.prototype.side=function(){var t
;return null===(t=this.sideModel)||void 0===t?void 0:t.side.value()},t.prototype.setSolutionAccount=function(){null!==this._setSolutionAccount&&this._setSolutionAccount()},t.prototype.selectBroker=function(){var t=this;this._toggleTradingWidget().then((function(){return t._onNeedSelectBroker.fire()}))},t.prototype.orderWidgetStat=function(){return this._orderWidgetStat},t.prototype.resetOrderPanel=function(){this._cancel()},t.prototype.deactivateOrderPanel=function(){var t=this;this.status.value()!==a.h.Wait&&(this.status.setValue(a.h.Wait),this.orderType.subscribe(this.activateOrderPanel),this.sideModel&&this.sideModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.limitPriceModel&&this.limitPriceModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.stopPriceModel&&this.stopPriceModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.quantityModel&&this.quantityModel.onControlFocused.subscribe(this,this.activateOrderPanel),this.takeProfitModel&&(this.takeProfitModel.enabled.setValue(!1),this.takeProfitModel.onControlFocused.subscribe(this,this.activateOrderPanel)),this.stopLossModel&&(this.stopLossModel.enabled.setValue(!1),this.stopLossModel.onControlFocused.subscribe(this,this.activateOrderPanel)),this.durationModel&&this.durationModel.onControlFocused.subscribe(this,this.activateOrderPanel),Array.isArray(this.customFieldModels.value())&&this.customFieldModels.value().length>0&&this.customFieldModels.value().forEach((function(e){e.onControlFocused.subscribe(t,t.activateOrderPanel)})),this._setDisabledIfNeeded(this._status.getValue(),this._loading.getValue(),this.sideModel?this.sideModel.$value.getValue():null,this.limitPriceModel?this.limitPriceModel.$value.getValue():null,this.stopPriceModel?this.stopPriceModel.$value.getValue():null,this.quantityModel?this.quantityModel.$value.getValue():null,this.takeProfitModel?this.takeProfitModel.$value.getValue():null,this.stopLossModel?this.stopLossModel.$value.getValue():null))},t.prototype.toggleCancelButton=function(){this.mode.value()===a.g.Panel&&this.status.value()===a.h.Active?this.headerModel.showCancelButton():this.headerModel.hideCancelButton()},t.prototype._createSimpleDialog=function(t){this.orderType.setValue(null),this.status.setValue(a.h.Wait),this.headerModel=new g(this.symbol,t?t.metainfo().title:"",this.mode,this.status,1,!1,!1,this._quotes$,this._panelCanBeShown),this.headerModel.closeButtonClicked().subscribe(this,this._closeWidget)},t.prototype._createModels=function(t,e,i,r,s){var o=this;this.sideModel=new S(this._quotes$,this.formatter,i,this._orderTemplate.side||1,this.status,this.supportCryptoExchangeOrderTicket&&"crypto"===e.type&&e.baseCurrency||null),this._pipValue$=c.Observable.combineLatest(this._pipValues$,this.sideModel.$value,(function(t,e){return 1===e?t.buyPipValue:t.sellPipValue}));var n=this._adapter.metainfo(),u=n.orderRules,a=n.title
;this.limitPriceModel=new B(this._quotes$,this.sideModel.$value,e,this.status,this._orderTemplate.limitPrice,this.formatter,this.orderType,!0,this._settings,a,this._orderWidgetStat,u,s),this.stopPriceModel=new B(this._quotes$,this.sideModel.$value,e,this.status,this._orderTemplate.stopPrice,this.formatter,this.orderType,!1,this._settings,a,this._orderWidgetStat,u,s,this.supportStopOrdersInBothDirections),this._syncStopLimitPrices(),this._price$=c.Observable.combineLatest(this._orderType,this.sideModel.$value,this._quotes$,this.stopPriceModel.$value,this.limitPriceModel.$value,(function(t,e,i,r,s){var n=1===e?Object(w.l)(i):Object(w.m)(i),u=(i.trade?i.trade:n)||0;switch(o._initialInputState.limitPrice=n,o._initialInputState.stopPrice=n,t){case 1:case 4:return(null===s?o.limitPriceModel.price.value():s)||u;case 3:return(null===r?o.stopPriceModel.price.value():r)||u;default:return n}})),this.supportCryptoExchangeOrderTicket?this.quantityModel=new E(e,this._price$,this._baseCurrencyCryptoBalance$,this._quoteCurrencyCryptoBalance$,this._currentInputState.quantity,this.status,this.sideModel.side,this._orderWidgetStat):this.quantityModel=new N(this._stopLossAvailable,this._stopLossPips,this._equity$,this._pipValue$,e,Object(d.ensureDefined)(this.currency),this._currentInputState.quantity,this.status,this._settings,this._orderWidgetStat),(this.supportBrackets||this.supportCryptoBrackets)&&this._createBracketsModels(t,e,Object(d.ensureDefined)(this.currency)),this.headerModel=new g(this.displaySymbolName,this._adapter.metainfo().title,this.mode,this.status,1,this.existingOrder,r,this._quotes$,this._panelCanBeShown,t,this.formatter);var l=Object(w.v)(this._adapter.getOrderDialogOptions(t.symbol));this.supportCryptoExchangeOrderTicket||(this.orderInfoModel=new et(this._marginAvailable$,this.quantityModel.$value,Object(d.ensureDefined)(this.currency),this._pipValue$,this._price$,this.sideModel.$value,l,e,this.supportBrackets&&this.takeProfitModel?{enabled:this.takeProfitModel.enabled,riskInCurrency:this.takeProfitModel.riskInCurrency.value,riskInPercent:this.takeProfitModel.riskInPercent.value}:null,this.supportBrackets&&this.stopLossModel?{enabled:this.stopLossModel.enabled,riskInCurrency:this.stopLossModel.riskInCurrency.value,riskInPercent:this.stopLossModel.riskInPercent.value}:null,this._adapter.metainfo().configFlags.supportMargin||!1));var h=e.allowedDurations,p=this._adapter.metainfo().durations;if(void 0!==p&&p.length>0){var b=Object(K.e)(p[0]),f=!0,_=void 0;if(void 0!==h&&p.filter((function(t){return h.includes(t.value)})),void 0!==this._orderTemplate.duration)f=function(t,e){return-1!==e.findIndex((function(e){return t===e.value}))}(this._orderTemplate.duration.type,p),b=Object.assign({},this._orderTemplate.duration);else if(void 0===(_=p.find((function(t){return o._currentInputState.duration&&t.value===o._currentInputState.duration.type})))){var v=Object(K.a)(this.orderType.value(),p);v.length>0&&(_=v.find((function(t){return Boolean(t.default)}))||v[0],b=Object(K.e)(_))}else b=Object(K.e)(_)
;f&&(this.durationModel=new G(b,p,this.orderType,this._orderWidgetStat,this.durationForMarketOrders))}},t.prototype._createBracketsModels=function(t,e,i){var r=this;this.takeProfitModel=new Y(t.takeProfit||null,Boolean(t.takeProfit),a.a.TakeProfit,this.formatter,this._equity$,this._quotes$,e,this._pipValue$,this.sideModel.$value,this.quantityModel.$value,this._price$,this._orderType,i,1,this._currentInputState.takeProfitPips,this._settings,this._orderWidgetStat,this.status.value(),this.supportModifyTrailingStop,this.supportCryptoBrackets);var s=Boolean(t.trailingStopPips);this.stopLossModel=new Y(s?null:t.stopLoss||null,Boolean(s?t.trailingStopPips:t.stopLoss),s?a.a.TrailingStop:a.a.StopLoss,this.formatter,this._equity$,this._quotes$,e,this._pipValue$,this.sideModel.$value,this.quantityModel.$value,this._price$,this._orderType,i,1,(s?t.trailingStopPips:this._currentInputState.stopLossPips)||null,this._settings,this._orderWidgetStat,this.status.value(),this.supportModifyTrailingStop,this.supportCryptoBrackets),this.supportCryptoExchangeOrderTicket||(this.stopLossModel.focusedControl.subscribe((function(t){2!==t&&3!==t||r.quantityModel.focusedControl.setValue(0)})),this.quantityModel.focusedControl.subscribe((function(t){!r.stopLossModel||1===r.stopLossModel.focusedControl.value()||1!==t&&2!==t||r.stopLossModel.focusedControl.setValue(0)}))),this._rewardRiskSubscription=c.Observable.combineLatest(this.takeProfitModel.$value,this.stopLossModel.$value).subscribe((function(t){var e=t[0],i=t[1];r.rewardRisk.setValue(Object(w.k)(e,i))})),this.stopLossModel.$value.subscribe((function(t){r.stopLossModel&&(r._stopLossAvailable.next(r.stopLossModel.enabled.value()),null!==t&&r._stopLossPips.next(t))}))},t.prototype._subscribe=function(){var t,e,i=this;this.mode.subscribe(this._updateMode),this.headerModel.pinButtonClicked().subscribe(this,this._toggleMode),this.headerModel.cancelButtonClicked().subscribe(this,this._cancel),this.headerModel.closeButtonClicked().subscribe(this,this._closeWidget),this.headerModel.backButtonClicked().subscribe(this,this._back),this.buttonModel=new Z(1,this.status,this.existingOrder,{orderType:this.orderType,side:this.sideModel.$value,quantity:this.quantityModel.$value,symbol:this.displaySymbolName,stopPrice:this.stopPriceModel.$value,limitPrice:this.limitPriceModel.$value,formatter:this.formatter,quantityFormatter:this.quantityModel.formatter,orderPlacingStatus:this._orderPlacingStatus});var r=[this._status,this.sideModel.$value,this._loading,this.limitPriceModel.$value,this.stopPriceModel.$value,this.quantityModel.$value];if(this.takeProfitModel&&r.push(this.takeProfitModel.$value),this.stopLossModel&&r.push(this.stopLossModel.$value),this._buttonDataSubscription=c.Observable.combineLatest(r,(function(t,e,r){for(var s=[],o=3;o<arguments.length;o++)s[o-3]=arguments[o];var n=s[0],u=s[1],a=s[2],l=s[3],c=s[4];i._setDisabledIfNeeded(t,r,e,n,u,a,l,c),i._compareInputStates(e,n,u,a,l,c)})).subscribe(),this.customFieldModels){var s=[];this._getSavableCustomFieldModels().forEach((function(t){
var e=Object(w.t)(t.selectedItem);s.push(e.subject),t.subscription=e})),s.length&&(this._customFieldsSubscription=c.Observable.combineLatest(s,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Object(p.deepEquals)(i._getCustomFields(i._getSavableCustomFieldModels()),i._currentInputState.customFields)[0]||i._onInputStateChanged.fire(i._getCurrentInputState())})).subscribe())}this._subscriptions=[this.sideModel.subscribe(),this.limitPriceModel.subscribe(),this.stopPriceModel.subscribe(),this._price$.subscribe()],null!==this.orderInfoModel&&(t=this._subscriptions).push.apply(t,this.orderInfoModel.subscribe()),(e=this._subscriptions).push.apply(e,[this._buttonDataSubscription,this._pipValues$.connect()]),null!==this._marginAvailable$&&this._subscriptions.push(this._marginAvailable$.connect()),this.supportBrackets&&this._subscriptions.push(this._rewardRiskSubscription),null!==this._baseCurrencyCryptoBalance$&&this._subscriptions.push(this._baseCurrencyCryptoBalance$.connect()),null!==this._quoteCurrencyCryptoBalance$&&this._subscriptions.push(this._quoteCurrencyCryptoBalance$.connect()),this.orderType.subscribe(this._syncOrderPricesAndFocuses),this._adapter.orderUpdate.subscribe(this,this._orderUpdate),this.stopPriceModel.price.subscribe(this._syncStopLimitPrices)},t.prototype._backToDefaultOrderPanel=function(){this.mode.value()===a.g.Panel&&!0===this.existingOrder?this._back():this.mode.value()===a.g.Panel&&!1===this.existingOrder&&this._cancel()},t.prototype._orderUpdate=function(t){this.existingOrder&&t.id===this._orderTemplate.id&&6!==t.status&&this._back()},t.prototype._doneHandler=function(t,e){return Object(r.b)(this,void 0,void 0,(function(){var i;return Object(r.d)(this,(function(r){switch(r.label){case 0:return this._suggestedQty.setValue(t.symbol,t.qty),[4,this._getAndSendStatistics(t)];case 1:return r.sent(),null!==this._orderWidgetStat&&this._orderWidgetStat.clear(),i=this._handler,this._isHandlerPlacedOrder(i)?[2,i(Object.assign({},this._existingPlacedOrder,t),e)]:[2,i(t,e)]}}))}))},t.prototype._isHandlerPlacedOrder=function(t){return this.existingOrder},t.prototype._getAndSendStatistics=function(t){var e;return Object(r.b)(this,void 0,void 0,(function(){function i(t,e){return e[null!==t?t:0]}var s,o,n,u,a,l,c,h,d,p,b,f,_,v,y,P,m;return Object(r.d)(this,(function(r){switch(r.label){case 0:return s=this.stopLossModel&&this.stopLossModel.enabled.value(),o=this.takeProfitModel&&this.takeProfitModel.enabled.value(),n=s&&this.supportTrailingStop,u=1===t.side?"Buy":"Sell",a=["Limit","Market","Stop","StopLimit"],l=["Price","Pips"],c=["Units","RiskInCurrency","RiskInPercent","BaseCurrencyQuantity","QuoteCurrencyQuantity"],h=this.quantityModel.focusedControl.value(),d=["Pips","Price","RiskInCurrency","RiskInPercent"],p=a[t.type-1],b=this.durationModel?this.durationModel.getValue():null,f=4===t.type,_=3===t.type||f,v=1===t.type||f,y=Object.assign({},this._settings.value()),
P=this.limitPriceModel&&!this.limitPriceModel.isRelativePriceControlHidden||this.stopPriceModel&&!this.stopPriceModel.isRelativePriceControlHidden,m=Boolean(this.supportBrackets),y.showRelativePriceControl=y.showRelativePriceControl&&P,y.showCurrencyRiskInQty=y.showCurrencyRiskInQty&&m,y.showPercentRiskInQty=y.showPercentRiskInQty&&m,y.showBracketsInCurrency=y.showBracketsInCurrency&&m,y.showBracketsInPercent=y.showBracketsInPercent&&m,y.showOrderPreview=y.showOrderPreview&&Boolean(this.supportPlaceOrderPreview||this.supportModifyOrderPreview),null===this._orderWidgetStat?[3,2]:(this._orderWidgetStat.setStaticSnowplowEventDataProperty({accountType:this._adapter.currentAccountType(),brokerId:this._adapter.metainfo().id,orderTicketMode:this.mode.value(),side:u,orderType:p,symbolType:void 0!==this._symbolInfo.type?this._symbolInfo.type:null,operation:this.existingOrder?"Modify":"Place",stopLoss:s?this._currentInputState.stopLossPips:null,takeProfit:o?this._currentInputState.takeProfitPips:null,trailingStop:n?this._currentInputState.stopLossPips:null,guaranteedStop:null,focusedTPField:o&&this.takeProfitModel?i(this.takeProfitModel.focusedControl.value(),d):null,focusedSLField:s&&void 0!==this.stopLossModel?i(this.stopLossModel.focusedControl.value(),d):null,focusedQtyField:null!==(e=c[null!==h?h:0])&&void 0!==e?e:null,focusedLimitPriceField:v||f&&this.limitPriceModel?i(this.limitPriceModel.focusedControl.value(),l):null,focusedStopPriceField:_&&this.stopPriceModel?l[this.stopPriceModel.focusedControl.value()]:null,duration:null!==b?b.type:null,isDefaultDuration:null!==b?b.type===this._getDefaultDuration().value:null,showBracketsInCurrency:y.showBracketsInCurrency,showBracketsInPercent:y.showBracketsInPercent,showCurrencyRiskInQty:y.showCurrencyRiskInQty,showOrderPreview:y.showOrderPreview,showPercentRiskInQty:y.showPercentRiskInQty,showRelativePriceControl:y.showRelativePriceControl}),[4,this._orderWidgetStat.trackStat()]);case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t.prototype._getInitialInputState=function(t,e,i,r){var s,o,n,u,l=t.metainfo().durations,c=null!==(s=null==r?void 0:r.customFields)&&void 0!==s?s:{};Array.isArray(l)&&0!==l.length&&(u=Object.assign({},null!==(o=e.duration)&&void 0!==o?o:void 0!==r?r.duration:{type:l[0].value}));return u&&["GTD","GTT","GDP","DTT","GoodTillDate"].includes(u.type)&&void 0===u.datetime&&(u.datetime=Date.now()+864e5),{symbol:this.symbol,side:e.side||1,limitPrice:e.limitPrice||e.price||e.stopPrice||0,stopPrice:e.stopPrice||e.price||e.limitPrice||0,quantity:e.qty||i,takeProfitPips:void 0!==r?r.takeProfitPips:a.b.TakeProfit,stopLossPips:void 0!==r?r.stopLossPips:a.b.StopLoss,customFields:null!==(n=e.customFields)&&void 0!==n?n:c,duration:u||null}},t.prototype._compareInputStates=function(t,e,i,r,s,o){0===this._initialInputState.limitPrice&&null!==e&&(this._initialInputState.limitPrice=e),0===this._initialInputState.stopPrice&&null!==i&&(this._initialInputState.stopPrice=i);var n=this.orderType.value(),u=null===e;if(null!==e){
var a=this.formatter.format(e),l=null!==this._currentInputState.limitPrice?this.formatter.format(this._currentInputState.limitPrice):null;u=3!==n&&a!==l}var c=null!==i;if(null!==i){var h=this.formatter.format(i),d=null!==this._currentInputState.stopPrice?this.formatter.format(this._currentInputState.stopPrice):null;c=(3===n||4===n)&&h!==d}var p=null!==r&&this._currentInputState.quantity!==r,b=null!==s&&this._currentInputState.takeProfitPips!==s,f=null!==o&&this._currentInputState.stopLossPips!==o,_=u||c||p||b||f;(this._currentInputState.symbol!==this.symbol||null!==t&&this._currentInputState.side!==t||_)&&this._onInputStateChanged.fire(this._getCurrentInputStateWithoutCustomFields())},t.prototype._getSavableCustomFieldModels=function(){return this.customFieldModels.value().filter((function(t){return t.saveToSettings&&"ComboBox"===t.type})).map((function(t){return t.selectedItem.value()===t.items[0].value&&t.selectedItem.setValue(""),t}))},t.prototype._getCustomFields=function(t){t||(t=this.customFieldModels.value());var e={};return t.forEach((function(t){"TextWithCheckBox"===t.type?e[t.id]={text:t.text.value().replace(/&quote;/g,'"'),checked:t.checked.value()}:e[t.id]=t.selectedItem.value()||t.items[0].value})),e},t.prototype._getCurrentInputState=function(){var t;return{symbol:this.symbol,side:this.sideModel.$value.getValue(),limitPrice:this.limitPriceModel.$value.getValue(),stopPrice:this.stopPriceModel.$value.getValue(),quantity:this.quantityModel.$value.getValue(),takeProfitPips:this.takeProfitModel?this.takeProfitModel.pips.value.value():null,stopLossPips:this.stopLossModel?this.stopLossModel.pips.value.value():null,duration:(null===(t=this.durationModel)||void 0===t?void 0:t.$value.getValue())||null,customFields:this._getCustomFields(this._getSavableCustomFieldModels())}},t.prototype._getCurrentInputStateWithoutCustomFields=function(){return Object(r.a)(Object(r.a)({},this._getCurrentInputState()),{customFields:null})},t.prototype._setDisabledIfNeeded=function(t,e,i,r,s,o,n,u){this.disabled.setValue(this.mode.value()===a.g.Panel&&t===a.h.Wait||e||null===i||Object(w.f)(this.orderType.value(),r,s)||null===o||Boolean(this.takeProfitModel&&!this.takeProfitModel.readyToSubmit())||Boolean(this.stopLossModel&&!this.stopLossModel.readyToSubmit()))},t.prototype._suggestedQtyChangedHandler=function(t){var e=this;t===this.symbol&&this.quantityModel&&this._suggestedQty.value(t).then((function(t){e.quantityModel.quantity.value.value()!==t&&(e.quantityModel.focusedControl.setValue(e.supportCryptoExchangeOrderTicket?3:0),e._currentInputState.quantity=t,e.quantityModel.quantity.value.setValue(t))}))},t.prototype._toggleMode=function(){this.mode.setValue(this.mode.value()===a.g.Panel?a.g.Popup:a.g.Panel),this._updateMode(),this._onModeChanged.fire(this.mode.value())},t.prototype._closeWidget=function(){this.orderPreviewModel=null,this.onDoneButtonClicked.resolve(!1),this._onCloseButtonClicked.fire()},t.prototype._cancel=function(){this.orderPreviewModel=null,this.onDoneButtonClicked.resolve(!1),this.deactivateOrderPanel(),
this._currentInputState=Object.assign({},this._initialInputState),this.limitPriceModel&&this.limitPriceModel.forcePricesUpdate(this._initialInputState.limitPrice),this.stopPriceModel&&this.stopPriceModel.forcePricesUpdate(this._initialInputState.stopPrice),this.quantityModel&&this.quantityModel.quantity.value.setValue(this._initialInputState.quantity),this.takeProfitModel&&this.takeProfitModel.enabled.setValue(!1),this.stopLossModel&&this.stopLossModel.enabled.setValue(!1),this.durationModel&&this._initialInputState.duration&&this.durationModel.duration.setValue(this._initialInputState.duration),this._orderPlacingStatus.next(a.i.Creating),this.existingOrder&&this._back()},t.prototype._getDefaultDuration=function(){var t=Object(d.ensureDefined)(this._adapter.metainfo().durations);return t.find((function(t){return Boolean(t.default)}))||t[0]},t.prototype._prepareTradableSolution=function(t){return Object(r.b)(this,void 0,void 0,(function(){var e,i,o,n,a,l=this;return Object(r.d)(this,(function(r){switch(r.label){case 0:return void 0===t.solutions?[3,4]:(e=void 0,i=void 0,"changeSymbol"in t.solutions?(o=t.solutions.changeSymbol,e=Object(s.t)("Switch the symbol"),i=function(){return u.linking.symbol.setValue(o)},[3,3]):[3,1]);case 1:return n=t.solutions.changeAccount,[4,this._adapter.accountsMetainfo()];case 2:a=r.sent().filter((function(t){return t.id===n}))[0].name,e=Object(s.t)("Switch to {accountName}").format({accountName:a}),i=function(){return l._adapter.setCurrentAccount(n)},r.label=3;case 3:this.tradableSolution={title:e,apply:i},r.label=4;case 4:return this._createSimpleDialog(this._adapter),this.notTradableText=t.reason,[2]}}))}))},t}(),ct={title:window.t("Position Info"),pipValue:window.t("Pip Value"),tradeValue:window.t("Trade Value"),total:window.t("Total"),leverage:window.t("Leverage"),lotSize:window.t("Lot Size")},ht=function(){function t(t,e,i,r,s){this._baseTextOutputs=[],this._textOutputs=new k.a([],w.g),this._riskFormatter=new L.PriceFormatter(100),this._currency=e,this._showTotalInsteadOfTradeValue=r,this._type=s.type,this._minTick=s.minTick,this._leverage=s.leverage,this._marginRate=s.marginRate,this._lotSize=s.lotSize,this._pipValue=Object(w.b)(t,s.pipValue,this._lotSize),this._tradeValue="crypto"===this._type?(null!==t?t:0)*i:Object(w.c)(t,i,s.pipValue,s.pipSize,this._lotSize);var o=Object(w.i)(this._leverage,this._marginRate);if(null!==o&&this._baseTextOutputs.push({title:ct.leverage,value:o}),"number"==typeof this._lotSize&&Number.isFinite(this._lotSize)&&this._baseTextOutputs.push({title:ct.lotSize,value:""+this._lotSize}),"crypto"!==this._type&&Number.isFinite(this._pipValue)&&this._baseTextOutputs.push({title:ct.pipValue,value:this._currency+" "+Object(w.j)(this._pipValue)}),Number.isFinite(this._tradeValue)){var n="crypto"===this._type?this._tradeValue.toFixed(Object(w.n)(this._minTick)):Object(w.j)(this._tradeValue);this._baseTextOutputs.push({title:this._showTotalInsteadOfTradeValue?ct.total:ct.tradeValue,value:this._currency+" "+n})}this._textOutputs.setValue(this._baseTextOutputs)}
return t.prototype.title=function(){return ct.title},t.prototype.textOutputs=function(){return this._textOutputs},t.prototype.pipValue=function(){throw new Error("not supported")},t.prototype.tradeValue=function(){throw new Error("not supported")},t.prototype.tpRiskInCurrency=function(){throw new Error("not supported")},t.prototype.tpRiskInPercent=function(){throw new Error("not supported")},t.prototype.slRiskInCurrency=function(){throw new Error("not supported")},t.prototype.slRiskInPercent=function(){throw new Error("not supported")},t}(),dt={bracketsWarning:window.t("You already have at least one working order that can affect this position")},pt=function(){function t(t,e,i,r,s,o,n,u,l){var h=this;this.positionInfoModel=null,this.customFieldModels=new y.a([]),this.onDoneButtonClicked=Object(it.createDeferredPromise)(),this.rewardRisk=new y.a(""),this.disabled=new y.a(!1),this.loading=new y.a(!1),this.status=new y.a(a.h.Active),this.id=Object(b.randomHashN)(6),this.warning=new y.a(void 0),this._onModeChanged=new _.a,this._onBackButtonClicked=new _.a,this._onCloseButtonClicked=new _.a,this._loadingSubscription=Object(w.t)(this.loading),this._loading=this._loadingSubscription.subject,this.mode=s,this._position=e,this._settings=o,this._adapter=t,this.position=e,this.symbol=e.symbol,this.brackets=i,this._handler=r,this._panelCanBeShown=n;var d=this._adapter.metainfo().configFlags;this.supportTrailingStop=d.supportTrailingStop,this.supportModifyTrailingStop=d.supportModifyTrailingStop,this.supportPositions=d.supportPositions,this.supportTrades=d.supportTrades,this.supportOnlyPairPositionBrackets=d.supportOnlyPairPositionBrackets,this._adapter.orders().then((function(t){var i=t.filter((function(t){return 2===t.parentType&&t.parentId===e.id})),r=i.length?i[0].customFields:void 0,s=h._adapter.getPositionDialogOptions();h.customFieldModels.setValue(Object(w.h)(Boolean(i.length),h.status,s,r)),h.supportOnlyPairPositionBrackets&&h._updateWarning()})),this._trackEvent=l,this.onReady=Promise.all([t.symbolInfo(e.symbol),ot(t.accountMetainfo(),{id:t.metainfo().id,name:t.metainfo().title}),ot(t.formatter(e.symbol,!1),new L.PriceFormatter)]).then((function(r){var s=r[0],o=r[1],n=r[2];h.currency=Object(w.o)(s,o),h.brokerSymbol=s.brokerSymbol||e.brokerSymbol||h.symbol,h._quotes$=c.Observable.fromEventPattern((function(t){return u.subscribeRealtime(e.symbol,t)}),(function(t){return u.unsubscribeRealtime(e.symbol,t)}),(function(t,e){return e})).publish(),h._equity$=c.Observable.fromEventPattern((function(e){return t.subscribeEquity(e)}),(function(e){return t.unsubscribeEquity(e)}),(function(t,e){return e})).publish(),h._pipValues$=c.Observable.fromEventPattern((function(i){return t.subscribePipValue(e.symbol,i)}),(function(i){return t.unsubscribePipValue(e.symbol,i)}),(function(t,e){return e})).startWith({buyPipValue:s.pipValue,sellPipValue:s.pipValue}).publish(),h._pipValue$=h._pipValues$.map((function(t){return 1===e.side?t.buyPipValue:t.sellPipValue})),h._createModels(i,s,o,h.mode,n),h._subscribe()}))}
return t.prototype.destroy=function(){this._subscriptions&&this._subscriptions.forEach((function(t){return t.unsubscribe()})),this.headerModel&&(this.headerModel.unsubscribe(),this.headerModel.pinButtonClicked().unsubscribe(this,this._toggleMode),this.headerModel.backButtonClicked().unsubscribe(this,this._back),this.headerModel.closeButtonClicked().unsubscribe(this,this._closeWidget)),this.takeProfitModel&&this.takeProfitModel.unsubscribe(),this.stopLossModel&&this.stopLossModel.unsubscribe(),this.buttonModel&&this.buttonModel.unsubscribe(),this.supportPositions&&this._adapter.positionUpdate.unsubscribe(this,this._positionOrTradeUpdate),this.supportTrades&&this._adapter.tradeUpdate.unsubscribe(this,this._positionOrTradeUpdate),this.supportOnlyPairPositionBrackets&&(this._adapter.orderUpdate.unsubscribe(this,this._updateWarning),this._slEnabled&&this._slEnabled.destroy(),this._tpEnabled&&this._tpEnabled.destroy())},t.prototype.side=function(){return this._position.side},t.prototype.doneButtonClick=function(){var t=this;this.loading.setValue(!0),this._doneHandler().then((function(e){e&&(t.mode.value()===a.g.Popup?t.headerModel.close():t._back(),t._trackEvent("Position Ticket","Modify Position",t.mode.value()===a.g.Panel?"Panel":"Popup"),t.onDoneButtonClicked.resolve(!0)),t.loading.setValue(!1)}))},t.prototype.onModeChanged=function(){return this._onModeChanged},t.prototype.onBackButtonClicked=function(){return this._onBackButtonClicked},t.prototype.onCloseButtonClicked=function(){return this._onCloseButtonClicked},t.prototype._createModels=function(t,e,i,r,s){var o=Object(w.o)(e,i)||"$",n=new h.BehaviorSubject(this._position.side||-1);this.headerModel=new g(this.brokerSymbol," ",r,this.status,2,!0,!0,this._quotes$,this._panelCanBeShown,this._position,this._position.priceFormatter?this._position.priceFormatter:s),this.takeProfitModel=new Y(t.takeProfit||this._position.takeProfit||null,Boolean(t.takeProfit||this._position.takeProfit),a.a.TakeProfit,s,this._equity$,this._quotes$,e,this._pipValue$,n,new h.BehaviorSubject(this._position.qty),new h.BehaviorSubject(this._position.avgPrice),new h.BehaviorSubject(null),o,2,null,this._settings,null,this.status.value(),this.supportModifyTrailingStop);var u=t.trailingStopPips||this._position.trailingStopPips,l=t.stopLoss||this._position.stopLoss,c=Boolean(u);this.stopLossModel=new Y(c?null:l||null,Boolean(c?u:l),c?a.a.TrailingStop:a.a.StopLoss,s,this._equity$,this._quotes$,e,this._pipValue$,n,new h.BehaviorSubject(this._position.qty),new h.BehaviorSubject(this._position.avgPrice),new h.BehaviorSubject(null),o,2,u||null,this._settings,null,this.status.value(),this.supportModifyTrailingStop);var d=Object(w.v)(this._adapter.getOrderDialogOptions(this._position.symbol));this.supportOnlyPairPositionBrackets||(this.positionInfoModel=new ht(this._position.qty,Object(w.o)(e,i),this._position.avgPrice,d,e)),this.buttonModel=new Z(2,this.status,!0)},t.prototype._updateWarning=function(){var t=this;this._adapter.orders().then((function(e){var i=e.find((function(e){
return e.symbol===t._position.symbol&&e.side!==t._position.side&&(6===e.status&&void 0===e.parentId||3===e.status)}));t.warning.setValue(i?dt.bracketsWarning:void 0)}))},t.prototype._subscribe=function(){var t=this;this.headerModel.pinButtonClicked().subscribe(this,this._toggleMode),this.headerModel.backButtonClicked().subscribe(this,this._back),this.headerModel.closeButtonClicked().subscribe(this,this._closeWidget),this._buttonDataSubscription=c.Observable.combineLatest(this.takeProfitModel.$value,this.stopLossModel.$value,this._loading).subscribe((function(e){var i=e[0],r=e[1],s=e[2];t.disabled.setValue(s||t.takeProfitModel.enabled.value()&&null===i||t.stopLossModel.enabled.value()&&null===r)})),this._rewardRiskSubscription=c.Observable.combineLatest(this.takeProfitModel.$value,this.stopLossModel.$value).subscribe((function(e){var i=e[0],r=e[1];t.rewardRisk.setValue(Object(w.k)(i,r))})),this._subscriptions=[this._rewardRiskSubscription,this._buttonDataSubscription,this._equity$.connect(),this._quotes$.connect(),this._pipValues$.connect()],this.supportPositions&&this._adapter.positionUpdate.subscribe(this,this._positionOrTradeUpdate),this.supportTrades&&this._adapter.tradeUpdate.subscribe(this,this._positionOrTradeUpdate),this.supportOnlyPairPositionBrackets&&(this._adapter.orderUpdate.subscribe(this,this._updateWarning),this._slEnabled=this.stopLossModel.enabled.spawn(),this._slEnabled.subscribe((function(e){t.takeProfitModel.enabled.setValue(e)})),this._tpEnabled=this.takeProfitModel.enabled.spawn(),this._tpEnabled.subscribe((function(e){t.stopLossModel.enabled.setValue(e)})))},t.prototype._doneHandler=function(){var t=null!==this.stopLossModel.$value.getValue()?this.stopLossModel.price.value.value():null,e=this.stopLossModel.$value.getValue(),i=null!==this.takeProfitModel.$value.getValue()?this.takeProfitModel.price.value.value():null,r={};if(null!==e&&null!==t&&(this.stopLossModel.bracketType.value()===a.a.StopLoss&&(r.stopLoss=t),this.stopLossModel.bracketType.value()===a.a.TrailingStop&&(r.trailingStopPips=e)),null!==i&&(r.takeProfit=i),Array.isArray(this.customFieldModels.value())){var s={};return this.customFieldModels.value().forEach((function(t){"TextWithCheckBox"===t.type?s[t.id]={text:t.text.value().replace(/&quote;/g,'"'),checked:t.checked.value()}:s[t.id]=t.selectedItem.value()})),this._getAndSendStatistics(),this._handler(this.position.id,r,s)}return this._getAndSendStatistics(),this._handler(this.position.id,r)},t.prototype._getAndSendStatistics=function(){var t=this,e=this.stopLossModel.enabled.value(),i=this.stopLossModel.focusedControl.value(),r=this.takeProfitModel.enabled.value(),s=this.takeProfitModel.focusedControl.value(),o=this.stopLossModel&&this.stopLossModel.bracketType.value(),n=["Pips","Price","RiskInCurrency","RiskInPercent"],u=[" Disabled"," Active"],a={SL:{active:u[+e],mode:null!==i?n[i]:n[1]},TP:{active:u[+r],mode:null!==s?n[s]:n[1]}};this.supportTrailingStop&&(a.SLType={active:u[+e],mode:["StopLoss","TakeProfit","TrailingStop"][o]});var l=this._settings.value()
;Object.keys(l).filter((function(t){return["showBracketsInCurrency","showBracketsInPercent"].includes(t)})).forEach((function(e){t._trackEvent("Order Ticket",e,l[e]?"on":"off")})),Object.keys(a).forEach((function(e){a[e].active&&t._trackEvent("Position Ticket",e,a[e].mode)}))},t.prototype._positionOrTradeUpdate=function(t){t.id!==this.position.id||0!==t.qty&&this.position.side===t.side||this._back()},t.prototype._toggleMode=function(){this.mode.setValue(this.mode.value()===a.g.Panel?a.g.Popup:a.g.Panel),this._onModeChanged.fire(this.mode.value())},t.prototype._closeWidget=function(){this.onDoneButtonClicked.resolve(!1),this._onCloseButtonClicked.fire()},t.prototype._back=function(){this.onDoneButtonClicked.resolve(!1),this._onBackButtonClicked.fire()},t}(),bt=i("8wgr"),ft=function(){function t(t){this._brokerId="",this._settingsAdapter=t}return t.prototype.setBrokerId=function(t){this._brokerId=t},t.prototype.getInputStateFromStorage=function(t){if(null!==t){var e,i=t.broker&&t.broker.getOrderDialogOptions(t.symbol);return i&&i.customFields&&(e=this.customFields(t.symbol,i.customFields.map((function(t){return t.id})))),{symbol:t.symbol,side:t.side,limitPrice:null,stopPrice:null,quantity:null,takeProfitPips:this.takeProfitPips(t.symbol),stopLossPips:this.stopLossPips(t.symbol),duration:null,customFields:e||null}}},t.prototype.saveSettings=function(t){this._settingsAdapter.setValue(this._makeKey(bt.a.ORDER_PANEL_SETTINGS,this._brokerId),JSON.stringify(t))},t.prototype.getSettings=function(){var t=this._settingsAdapter.getValue(this._makeKey(bt.a.ORDER_PANEL_SETTINGS,this._brokerId));try{return JSON.parse(t)}catch(e){return null}},t.prototype.setWidgetMode=function(t){this._settingsAdapter.setValue(bt.a.ORDER_WIDGET_MODE,t)},t.prototype.widgetMode=function(){var t=this._settingsAdapter.getValue(bt.a.ORDER_WIDGET_MODE);return t||null},t.prototype.setTakeProfitPips=function(t,e){var i=this._makeKey(bt.a.TAKE_PROFIT,this._brokerId,t);e===a.b.TakeProfit?this._settingsAdapter.remove(i):this._settingsAdapter.setValue(i,e)},t.prototype.takeProfitPips=function(t){var e=this._makeKey(bt.a.TAKE_PROFIT,this._brokerId,t),i=Number(this._settingsAdapter.getValue(e));return Object(p.isNumber)(i)?i:null},t.prototype.setStopLossPips=function(t,e){var i=this._makeKey(bt.a.STOP_LOSS,this._brokerId,t);e===a.b.StopLoss?this._settingsAdapter.remove(i):this._settingsAdapter.setValue(i,e)},t.prototype.stopLossPips=function(t){var e=this._makeKey(bt.a.STOP_LOSS,this._brokerId,t),i=Number(this._settingsAdapter.getValue(e));return Object(p.isNumber)(i)?i:null},t.prototype.setDuration=function(t,e){var i=this._makeKey(bt.a.ORDER_DURATION,this._brokerId,t);null===e?this._settingsAdapter.remove(i):this._settingsAdapter.setValue(i,e)},t.prototype.duration=function(t){var e=this._makeKey(bt.a.ORDER_DURATION,this._brokerId,t),i=this._settingsAdapter.getValue(e);return"string"==typeof i&&i.length>0?{type:i}:null},t.prototype.setCustomFields=function(t,e){for(var i=0,r=Object.entries(e);i<r.length;i++){
var s=r[i],o=s[0],n=s[1],u=this._makeKey("trading."+o+".",this._brokerId,t);"string"==typeof n&&n.length>0?this._settingsAdapter.setValue(u,n):this._settingsAdapter.remove(u)}},t.prototype.customFields=function(t,e){var i=this,r={};return e.forEach((function(e){var s=i._makeKey("trading."+e+".",i._brokerId,t),o=i._settingsAdapter.getValue(s);"string"==typeof o&&o.length>0&&(r[e]=o)})),r},t.prototype._makeKey=function(t,e,i){return t+e+("string"==typeof i?"."+i:"")},t}(),_t=i("5XxY"),vt=i("vOQ2");function yt(){return Promise.all([i.e("react"),i.e(1),i.e(3),i.e(4),i.e(5),i.e(7),i.e(13),i.e(14),i.e(17),i.e(19),i.e(20),i.e(22),i.e(23),i.e(27),i.e(31),i.e(33),i.e(36),i.e(48),i.e(49),i.e(56),i.e(63),i.e(77),i.e(90),i.e(102),i.e(112),i.e(0),i.e(2),i.e(6),i.e(8),i.e(18),i.e(21),i.e(26),i.e(51),i.e(54),i.e(70),i.e(80),i.e(78),i.e("order-widget")]).then(i.bind(null,"IkHa"))}function Pt(){return Promise.all([i.e("react"),i.e(1),i.e(3),i.e(4),i.e(5),i.e(7),i.e(14),i.e(17),i.e(19),i.e(20),i.e(22),i.e(23),i.e(27),i.e(31),i.e(36),i.e(48),i.e(56),i.e(77),i.e(126),i.e(0),i.e(2),i.e(6),i.e(8),i.e(18),i.e(21),i.e(26),i.e(51),i.e(70),i.e("position-widget")]).then(i.bind(null,"CWem"))}i.d(e,"OrderViewController",(function(){return mt}));var mt=function(){function t(t,e){var i=this;if(this._state=null,this._mode=new y.a(a.g.Panel),this._orderViewModel=null,this._positionViewModel=null,this._settings=new y.a(l.c),this._statusChangeIndex=0,this._saveSettingsBinded=this._saveSettings.bind(this),this._orderWidgetStat=null,this._updateContent=function(t){t!==vt.d.OrderPanel&&(i._positionViewModel&&(i._unmountPositionPanel(),i._unsubscribePositionViewModel()),null!==i._orderViewModel&&i._orderViewModel.existingOrder&&i._orderViewModel.onDoneButtonClicked.reject(),i._unmountOrderPanel())},this._onOrderWidgetModeChanged=function(t){null!==i._state&&null!==i._state.broker&&null!==i._orderViewModel&&(i._state.symbol!==i._orderViewModel.symbol?i.showOrderView(i._state.broker,i._orderStub):i._showOrderView()),t===a.g.Panel?i._closePositionDialog():i._closeTradingPanel()},this._onOrderWidgetInputStateChanged=function(t){if(null!==i._state){if(null!==t.takeProfitPips&&i._orderViewDataStorage.setTakeProfitPips(i._state.symbol,t.takeProfitPips),null!==t.stopLossPips&&i._orderViewDataStorage.setStopLossPips(i._state.symbol,t.stopLossPips),t.duration){var e=i._state.broker&&i._state.broker.metainfo().durations,r=e&&(e.find((function(t){return t.default}))||e[0]),s=r&&r.name===t.duration.type?null:t.duration.type;i._orderViewDataStorage.setDuration(i._state.symbol,s)}t.customFields&&i._orderViewDataStorage.setCustomFields(i._state.symbol,t.customFields)}},this._onOrderWidgetCloseButtonClicked=function(){i._mode.value()===a.g.Panel&&i._closeTradingPanel()},this._onOrderWidgetBackButtonClicked=function(){null!==i._state&&null!==i._state.broker&&(i._orderViewModel&&i._orderViewModel.status.value()===a.h.Preview?(i._showOrderView(),i._activateOrderPanel()):(i._orderStub=i._createOrderStub(),i.showOrderView(i._state.broker,i._orderStub,void 0,void 0,(function(){
i._mode.value()===a.g.Popup?(i._closeOrderDialog(),i._closePositionDialog()):i._deactivateOrderPanel()}))))},this._onPositionWidgetModeChanged=function(t){null!==i._positionViewModel&&i._showPositionOrTradeView(),t===a.g.Panel?i._closeOrderDialog():i._closeTradingPanel()},this._onPositionWidgetBackButtonClicked=function(){null!==i._state&&null!==i._state.broker&&(i._mode.value()===a.g.Panel?(i._unmountPositionPanel(),i._showOrderView(void 0,(function(){return i._resetOrderPanel()}))):i._closePositionDialog())},this._onPositionWidgetCloseButtonClicked=function(){i._mode.value()===a.g.Panel?(i._unsubscribePositionViewModel(),i._recreateOrderViewModel().then((function(){i._closePositionPanel(),i._resetOrderPanel()})),i._closeTradingPanel()):i._closePositionDialog()},this._tradingCommands=t,this._trackEvent=t.trackEvent,this._realtimeProvider=t.realtimeProvider,this._resizerBridge=t.resizerBridge,this._orderViewDataStorage=new ft(n),this._tradingPanelContainer=e.container,this._isTradingPanelAvailable=e.isAvailable,this._isTradingPanelOpened=e.isOpened,this._tradingPanelActivePage=e.activePage,this._closeTradingPanel=e.close,this._openTradingPanelPage=e.openPage,e.isAvailable.value())if(o.enabled("order_panel")){var r=this._orderViewDataStorage.widgetMode();this._mode.setValue(null!==r?r:a.g.Panel)}else this._mode.setValue(a.g.Popup);else this._mode.setValue(a.g.Popup);e.isAvailable.subscribe((function(t){t||i._mode.value()!==a.g.Panel||(e.close(),i._mode.setValue(a.g.Popup))})),this._realtimeProvider.onStatusChanged.subscribe(null,(function(){return i._onStatusChanged()})),u.linking.proSymbol.subscribe((function(){i._mode.value()===a.g.Popup&&i._closeOrderDialog(),i._onStatusChanged()})),window.loginStateChange&&window.loginStateChange.subscribe(this,this._onStatusChanged),this._settings.subscribe(this._saveSettingsBinded),this._onStatusChanged(),this._orderViewDataStorage.setWidgetMode(this._mode.value()),e.activePage.subscribe(this._updateContent),this.stateChanging=this._createStateChanging()}return t.prototype.openPanel=function(){var t=this;return this._closeOrderDialog(),this._closePositionDialog(),this._mode.setValue(a.g.Panel),null!==this._positionViewModel?(this._positionViewModel.onDoneButtonClicked.reject(),this._recreateOrderViewModel().then((function(){t._openOrderPanel(),t._resetOrderPanel(),t._unsubscribePositionViewModel()}))):null!==this._orderViewModel&&this._orderViewModel.existingOrder?(this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel(),this._recreateOrderViewModel().then((function(){t._openOrderPanel(),t._resetOrderPanel()}))):(this._openOrderPanel(),this._resetOrderPanel(),Promise.resolve())},t.prototype.closePanel=function(){null!==this._positionViewModel?(this._positionViewModel.onDoneButtonClicked.reject(),this._closePositionPanel(),this._unsubscribePositionViewModel()):(null!==this._orderViewModel&&this._orderViewModel.existingOrder&&(this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel(),this._recreateOrderViewModel()),
this._closeOrderPanel())},t.prototype.showOrderView=function(t,e,i,s,o){return Object(r.b)(this,void 0,void 0,(function(){var n,u,l,c,h,p,b=this;return Object(r.d)(this,(function(r){switch(r.label){case 0:return[4,t.isTradable(e.symbol)];case 1:return(n=r.sent()).tradable||this._mode.value()!==a.g.Popup?(null!==this._orderViewModel&&(this._orderViewModel.existingOrder&&this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel()),l=e.hasOwnProperty("id"),c=l?t.modifyOrder:t.placeOrder,this._orderStub=Object.assign(this._createOrderStub(),e),s&&this._mode.setValue(a.g.Popup),(h=this._orderViewDataStorage.getInputStateFromStorage(this._state))&&Object.assign(h,{stopLossPips:e.stopLoss||h.stopLossPips,takeProfitPips:e.takeProfit||h.takeProfitPips}),p=new lt(t,e,c.bind(t),this._mode,this._settings,n,this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty,h,!0),this._orderViewModel=p,[2,Object(d.ensureNotNull)(this._orderViewModel).onReady.then((function(){return b._orderViewModel!==p?Promise.resolve(!1):(null!==b._positionViewModel&&b._unsubscribePositionViewModel(),b._subscribeOrderViewModel(),b._showOrderView(i,o,s))}))]):(u="<p>"+n.reason+"</p>",_t.a.show(window.t("Non-tradable symbol"),u),[2,Promise.resolve(!1)])}}))}))},t.prototype.showPositionView=function(t,e,i,r){return this._createAndShowPositionOrTradeView(t,e,i,t.editPositionBrackets.bind(t),r)},t.prototype.showTradeView=function(t,e,i,r){return this._createAndShowPositionOrTradeView(t,e,i,t.editTradeBrackets.bind(t),r)},t.prototype.mode=function(){return this._mode},t.prototype.status=function(){return Object(d.ensureNotNull)(this._orderViewModel).status.value()},t.prototype.orderViewDataStorage=function(){return this._orderViewDataStorage},t.prototype._createAndShowPositionOrTradeView=function(t,e,i,r,s){var o=this;null!==this._positionViewModel&&(this._unmountPositionPanel(),this._unsubscribePositionViewModel()),null!==this._orderViewModel&&this._orderViewModel.existingOrder&&(this._orderViewModel.onDoneButtonClicked.reject(),this._recreateOrderViewModel());var n=new pt(t,e,i,r.bind(t),this._mode,this._settings,this._isTradingPanelAvailable.value(),this._tradingCommands.realtimeProvider,this._tradingCommands.trackEvent);return this._positionViewModel=n,Object(d.ensureNotNull)(this._positionViewModel).onReady.then((function(){return o._positionViewModel!==n?Promise.resolve(!1):(o._subscribePositionViewModel(),o._showPositionOrTradeView(s))}))},t.prototype._showPositionOrTradeView=function(t){var e=this;return null===this._positionViewModel?Promise.resolve(!1):Object(d.ensureNotNull)(this._positionViewModel).onReady.then((function(){return e._mode.value()===a.g.Panel?e._openPositionPanel(t):e._showPositionDialog(t),e._orderViewDataStorage.setWidgetMode(e._mode.value()),
Object(d.ensureNotNull)(e._positionViewModel).onDoneButtonClicked.promise.then((function(t){return t}))}))},t.prototype._showOrderView=function(t,e,i){var r=this;return null===this._orderViewModel?Promise.resolve(!1):Object(d.ensureNotNull)(this._orderViewModel).onReady.then((function(){return r._mode.value()===a.g.Panel?r._openOrderPanel(t):r._showOrderDialog(t),r._orderViewDataStorage.setWidgetMode(r._mode.value()),"function"==typeof e&&e(),Object(d.ensureNotNull)(r._orderViewModel).onDoneButtonClicked.promise.then((function(t){return t}))}))},t.prototype._onStatusChanged=function(){var t;return Object(r.b)(this,void 0,void 0,(function(){var e,i,s,o,n,l,c,h;return Object(r.d)(this,(function(r){switch(r.label){case 0:return e=++this._statusChangeIndex,i=u.linking.proSymbol.value()||u.linking.symbol.value(),s=this._realtimeProvider.activeBroker(),o=this._state,n=null,(l=s?s.metainfo().configFlags:null)&&(n=(l.supportLimitOrders?1:l.supportMarketOrders&&2)||l.supportStopOrders&&3||l.supportStopLimitOrders&&4||null),this._orderViewDataStorage.setBrokerId(s?s.metainfo().id:""),this._state={broker:s,symbol:i,side:(null===(t=this._orderViewModel)||void 0===t?void 0:t.side())||1,orderType:null!==this._orderViewModel&&this._orderViewModel.orderType?this._orderViewModel.orderType.value():n,accountId:null!==s?s.currentAccount():null},this._orderStub=this._createOrderStub(),null!==this._orderViewModel&&(this._orderViewModel.existingOrder&&this._orderViewModel.onDoneButtonClicked.reject(),this._unsubscribeOrderViewModel()),null!==this._positionViewModel&&(this._positionViewModel.onDoneButtonClicked.reject(),this._unsubscribePositionViewModel()),!o||o.broker===this._state.broker&&o.accountId===this._state.accountId?[3,2]:[4,Promise.all([this._closeOrderDialog(),this._closePositionDialog(),this._unmountPositionPanel()])];case 1:if(r.sent(),e!==this._statusChangeIndex)return[2];r.label=2;case 2:return null!==s?[3,4]:(h=new lt(s,this._orderStub,(function(){return Promise.resolve(!0)}),this._mode,this._settings,{tradable:!1},this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty),this._orderViewModel=h,[4,Object(d.ensureNotNull)(this._orderViewModel).onReady]);case 3:return r.sent(),e!==this._statusChangeIndex||this._orderViewModel!==h?[2]:(this._subscribeOrderViewModel(),this._deactivateOrderPanel(),this._isTradingPanelOpened.value()&&this._mode.value()===a.g.Panel&&null===this._positionViewModel&&this._tradingPanelActivePage.value()===vt.d.OrderPanel&&this._showOrderView(),[3,7]);case 4:return this._initializeSettings(),[4,s.isTradable(i)];case 5:return c=r.sent(),
e!==this._statusChangeIndex?[2]:(h=new lt(s,this._orderStub,s.placeOrder.bind(s),this._mode,this._settings,c,this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty,this._orderViewDataStorage.getInputStateFromStorage(this._state)),this._orderViewModel=h,[4,Object(d.ensureNotNull)(this._orderViewModel).onReady]);case 6:if(r.sent(),this._orderViewModel!==h)return[2];this._resetOrderPanel(),this._deactivateOrderPanel(),this._subscribeOrderViewModel(),this._isTradingPanelOpened.value()&&this._mode.value()===a.g.Panel&&null===this._positionViewModel&&this._tradingPanelActivePage.value()===vt.d.OrderPanel&&this._showOrderView(),r.label=7;case 7:return[2]}}))}))},t.prototype._initializeSettings=function(){this._settings.unsubscribe(this._saveSettingsBinded);var t=!0===Object(d.ensureNotNull)(this._realtimeProvider.activeBroker()).metainfo().configFlags.supportCryptoBrackets,e=this._orderViewDataStorage.getSettings()||l.c;t&&(e=Object.assign({},l.b,e)),this._settings.setValue(e),this._settings.subscribe(this._saveSettingsBinded)},t.prototype._saveSettings=function(t){this._orderViewDataStorage.saveSettings(t)},t.prototype._createOrderStub=function(){var t=Object(d.ensureNotNull)(this._state),e={limitPrice:0,stopPrice:0,qty:0,side:t.side,symbol:t.symbol,type:null!==t.orderType?t.orderType:1,takeProfit:void 0,stopLoss:void 0},i=this._orderViewDataStorage.duration(t.symbol);return null!==i&&(e.duration=i),e},t.prototype._activateOrderPanel=function(){null!==this._orderViewModel&&this._orderViewModel.activateOrderPanel()},t.prototype._deactivateOrderPanel=function(){null!==this._orderViewModel&&this._orderViewModel.deactivateOrderPanel()},t.prototype._resetOrderPanel=function(){null!==this._orderViewModel&&this._orderViewModel.resetOrderPanel()},t.prototype._recreateOrderViewModel=function(){return Object(r.b)(this,void 0,void 0,(function(){var t,e;return Object(r.d)(this,(function(i){switch(i.label){case 0:return null===this._state||null===this._state.broker?[3,2]:(this._orderStub=this._createOrderStub(),this._orderViewDataStorage.setBrokerId(this._state.broker.metainfo().id),[4,this._state.broker.isTradable(this._state.symbol)]);case 1:return t=i.sent(),e=new lt(this._state.broker,this._orderStub,this._state.broker.placeOrder.bind(this._state.broker),this._mode,this._settings,t,this._isTradingPanelAvailable.value(),this._tradingCommands.toggleTradingWidget,this._tradingCommands.onNeedSelectBroker,this._tradingCommands.trackEvent,this._orderWidgetStat,this._tradingCommands.showErrorNotification,this._tradingCommands.suggestedQty,this._orderViewDataStorage.getInputStateFromStorage(this._state)),this._orderViewModel=e,this._subscribeOrderViewModel(),[2,e.onReady];case 2:return[2]}}))}))},t.prototype._openOrderPanel=function(t){var e=this;return this._mountOrderPanel(t).then((function(){return e._openTradingPanelPage(vt.d.OrderPanel)
}))},t.prototype._mountOrderPanel=function(t){var e=this;return yt().then((function(i){null!==e._orderViewModel&&i.mountOrderPanel(e._orderViewModel,e._settings,e._tradingPanelContainer,Object(d.ensureNotNull)(e._resizerBridge).width,t,e._trackEvent)}))},t.prototype._closeOrderPanel=function(){var t=this;return this._unmountOrderPanel().then((function(){return t._closeTradingPanel()}))},t.prototype._unmountOrderPanel=function(){var t=this;return yt().then((function(e){e.unmountOrderPanel(Object(d.ensureNotNull)(t._tradingPanelContainer))}))},t.prototype._showOrderDialog=function(t){var e=this;yt().then((function(i){null!==e._orderViewModel&&i.showOrderDialog(e._orderViewModel,e._settings,t,e._trackEvent)}))},t.prototype._closeOrderDialog=function(){return yt().then((function(t){t.closeOrderDialog()}))},t.prototype._subscribeOrderViewModel=function(){Object(d.ensureNotNull)(this._orderViewModel).onModeChanged().subscribe(this,this._onOrderWidgetModeChanged),Object(d.ensureNotNull)(this._orderViewModel).onInputStateChanged().subscribe(this,this._onOrderWidgetInputStateChanged),Object(d.ensureNotNull)(this._orderViewModel).onCloseButtonClicked().subscribe(this,this._onOrderWidgetCloseButtonClicked),Object(d.ensureNotNull)(this._orderViewModel).onBackButtonClicked().subscribe(this,this._onOrderWidgetBackButtonClicked)},t.prototype._unsubscribeOrderViewModel=function(){Object(d.ensureNotNull)(this._orderViewModel).onModeChanged().unsubscribe(this,this._onOrderWidgetModeChanged),Object(d.ensureNotNull)(this._orderViewModel).onInputStateChanged().unsubscribe(this,this._onOrderWidgetInputStateChanged),Object(d.ensureNotNull)(this._orderViewModel).onCloseButtonClicked().unsubscribe(this,this._onOrderWidgetCloseButtonClicked),Object(d.ensureNotNull)(this._orderViewModel).onBackButtonClicked().unsubscribe(this,this._onOrderWidgetBackButtonClicked),Object(d.ensureNotNull)(this._orderViewModel).destroy(),this._orderViewModel=null},t.prototype._openPositionPanel=function(t){var e=this;return this._mountPositionPanel(t).then((function(){return e._openTradingPanelPage(vt.d.OrderPanel)}))},t.prototype._mountPositionPanel=function(t){var e=this;return Pt().then((function(i){if(null!==e._positionViewModel)return i.mountPositionPanel(e._positionViewModel,e._settings,e._tradingPanelContainer,t)}))},t.prototype._closePositionPanel=function(){var t=this;return this._unmountPositionPanel().then((function(){return t._closeTradingPanel()}))},t.prototype._unmountPositionPanel=function(){var t=this;return Pt().then((function(e){null!==t._positionViewModel&&e.unmountPositionPanel(t._positionViewModel,t._tradingPanelContainer)}))},t.prototype._showPositionDialog=function(t){var e=this;Pt().then((function(i){null!==e._positionViewModel&&i.showPositionDialog(e._positionViewModel,e._settings,t)}))},t.prototype._closePositionDialog=function(){return Pt().then((function(t){t.closePositionDialog()}))},t.prototype._subscribePositionViewModel=function(){
Object(d.ensureNotNull)(this._positionViewModel).onModeChanged().subscribe(this,this._onPositionWidgetModeChanged),Object(d.ensureNotNull)(this._positionViewModel).onBackButtonClicked().subscribe(this,this._onPositionWidgetBackButtonClicked),Object(d.ensureNotNull)(this._positionViewModel).onCloseButtonClicked().subscribe(this,this._onPositionWidgetCloseButtonClicked)},t.prototype._unsubscribePositionViewModel=function(){Object(d.ensureNotNull)(this._positionViewModel).onModeChanged().unsubscribe(this,this._onPositionWidgetModeChanged),Object(d.ensureNotNull)(this._positionViewModel).onBackButtonClicked().unsubscribe(this,this._onPositionWidgetBackButtonClicked),Object(d.ensureNotNull)(this._positionViewModel).onCloseButtonClicked().unsubscribe(this,this._onPositionWidgetCloseButtonClicked),Object(d.ensureNotNull)(this._positionViewModel).onDoneButtonClicked.resolve(!1),Object(d.ensureNotNull)(this._positionViewModel).destroy(),this._positionViewModel=null},t.prototype._createStateChanging=function(){var t=this,e=new y.a(!1);this.stateChanging=e;var i=this._onStatusChanged,r=0;return this._onStatusChanged=function(){return e.setValue(!0),r++,i.call(t).then((function(){r--,e.setValue(0!==r)})).catch((function(t){throw r--,e.setValue(0!==r),t}))},e},t}()},"3oOo":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("8yf6"),o=i("4c1C"),n=i("rfFC"),u=i("NTzu"),a=i("wHNh"),l=function(t){function e(e,i){t.call(this),this.source=e,this.subjectFactory=i,this._refCount=0,this._isComplete=!1}return r(e,t),e.prototype._subscribe=function(t){return this.getSubject().subscribe(t)},e.prototype.getSubject=function(){var t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject},e.prototype.connect=function(){var t=this._connection;return t||(this._isComplete=!1,(t=this._connection=new u.Subscription).add(this.source.subscribe(new h(this.getSubject(),this))),t.closed?(this._connection=null,t=u.Subscription.EMPTY):this._connection=t),t},e.prototype.refCount=function(){return a.refCount()(this)},e}(o.Observable);e.ConnectableObservable=l;var c=l.prototype;e.connectableObservableDescriptor={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:c._subscribe},_isComplete:{value:c._isComplete,writable:!0},getSubject:{value:c.getSubject},connect:{value:c.connect},refCount:{value:c.refCount}};var h=function(t){function e(e,i){t.call(this,e),this.connectable=i}return r(e,t),e.prototype._error=function(e){this._unsubscribe(),t.prototype._error.call(this,e)},e.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),t.prototype._complete.call(this)},e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}},e
}(s.SubjectSubscriber),d=(function(){function t(t){this.connectable=t}t.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var r=new d(t,i),s=e.subscribe(r);return r.closed||(r.connection=i.connect()),s}}(),function(t){function e(e,i){t.call(this,e),this.connectable=i}return r(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var i=this.connection,r=t._connection;this.connection=null,!r||i&&r!==i||r.unsubscribe()}}else this.connection=null},e}(n.Subscriber))},"4XzM":function(t,e,i){"use strict";var r=i("4c1C"),s=i("+EyI");r.Observable.prototype.map=s.map},"5NPC":function(t,e,i){"use strict";var r=i("8yf6"),s=i("xE8I");e.publish=function(t){return t?s.multicast((function(){return new r.Subject}),t):s.multicast(new r.Subject)}},"9A11":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("rfFC"),o=i("ty+v");e.first=function(t,e,i){return function(r){return r.lift(new n(t,e,i,r))}};var n=function(){function t(t,e,i,r){this.predicate=t,this.resultSelector=e,this.defaultValue=i,this.source=r}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.predicate,this.resultSelector,this.defaultValue,this.source))},t}(),u=function(t){function e(e,i,r,s,o){t.call(this,e),this.predicate=i,this.resultSelector=r,this.defaultValue=s,this.source=o,this.index=0,this.hasCompleted=!1,this._emitted=!1}return r(e,t),e.prototype._next=function(t){var e=this.index++;this.predicate?this._tryPredicate(t,e):this._emit(t,e)},e.prototype._tryPredicate=function(t,e){var i;try{i=this.predicate(t,e,this.source)}catch(r){return void this.destination.error(r)}i&&this._emit(t,e)},e.prototype._emit=function(t,e){this.resultSelector?this._tryResultSelector(t,e):this._emitFinal(t)},e.prototype._tryResultSelector=function(t,e){var i;try{i=this.resultSelector(t,e)}catch(r){return void this.destination.error(r)}this._emitFinal(i)},e.prototype._emitFinal=function(t){var e=this.destination;this._emitted||(this._emitted=!0,e.next(t),e.complete(),this.hasCompleted=!0)},e.prototype._complete=function(){var t=this.destination;this.hasCompleted||void 0===this.defaultValue?this.hasCompleted||t.error(new o.EmptyError):(t.next(this.defaultValue),t.complete())},e}(s.Subscriber)},"9zIo":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(){t.apply(this,arguments)}return r(e,t),e}(i("xA5P").AsyncScheduler);e.QueueScheduler=s},C7Jb:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,
new r)},s=function(t){function e(e,i){t.call(this)}return r(e,t),e.prototype.schedule=function(t,e){return void 0===e&&(e=0),this},e}(i("NTzu").Subscription);e.Action=s},DVyt:function(t,e,i){"use strict";var r=i("HDK4"),s=i("xE8I");e.publishReplay=function(t,e,i,o){i&&"function"!=typeof i&&(o=i);var n="function"==typeof i?i:void 0,u=new r.ReplaySubject(t,e,o);return function(t){return s.multicast((function(){return u}),n)(t)}}},G4OQ:function(t,e,i){"use strict";var r=i("rRE7");e.of=r.ArrayObservable.of},G7k4:function(t,e,i){"use strict";var r=i("4c1C"),s=i("gjxa");r.Observable.prototype.publish=s.publish},H9Zw:function(t,e,i){"use strict";var r=i("z6YP"),s=i("G4OQ"),o=i("IrFB"),n=i("Rcwy");e.concat=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return 1===t.length||2===t.length&&r.isScheduler(t[1])?o.from(t[0]):n.concatAll()(s.of.apply(void 0,t))}},HDK4:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("8yf6"),o=i("1ouX"),n=i("NTzu"),u=i("Ndu5"),a=i("VpWK"),l=i("8Zmw"),c=function(t){function e(e,i,r){void 0===e&&(e=Number.POSITIVE_INFINITY),void 0===i&&(i=Number.POSITIVE_INFINITY),t.call(this),this.scheduler=r,this._events=[],this._bufferSize=e<1?1:e,this._windowTime=i<1?1:i}return r(e,t),e.prototype.next=function(e){var i=this._getNow();this._events.push(new h(i,e)),this._trimBufferThenGetEvents(),t.prototype.next.call(this,e)},e.prototype._subscribe=function(t){var e,i=this._trimBufferThenGetEvents(),r=this.scheduler;if(this.closed)throw new a.ObjectUnsubscribedError;this.hasError||this.isStopped?e=n.Subscription.EMPTY:(this.observers.push(t),e=new l.SubjectSubscription(this,t)),r&&t.add(t=new u.ObserveOnSubscriber(t,r));for(var s=i.length,o=0;o<s&&!t.closed;o++)t.next(i[o].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),e},e.prototype._getNow=function(){return(this.scheduler||o.queue).now()},e.prototype._trimBufferThenGetEvents=function(){for(var t=this._getNow(),e=this._bufferSize,i=this._windowTime,r=this._events,s=r.length,o=0;o<s&&!(t-r[o].time<i);)o++;return s>e&&(o=Math.max(o,s-e)),o>0&&r.splice(0,o),r},e}(s.Subject);e.ReplaySubject=c;var h=function(t,e){this.time=t,this.value=e}},IrFB:function(t,e,i){"use strict";var r=i("pHYF");e.from=r.FromObservable.create},JwtW:function(t,e,i){"use strict";var r=i("4c1C"),s=i("oaOn");r.Observable.combineLatest=s.combineLatest},MSNS:function(t,e,i){"use strict";var r=i("4c1C"),s=i("jQCj");r.Observable.prototype.startWith=s.startWith},MiOS:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"d",(function(){return o})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){return u})),i.d(e,"e",(function(){return a}));var r=i("ldgD");function s(t,e){return t.find((function(t){return t.value===e}))||t[0]}function o(t){return new Date(t.format("YYYY-MM-DD[T]HH:mm[:00Z]")).valueOf()}function n(t,e){
return(e.hasDatePicker?t.format("DD MMM YYYY"):"")+(e.hasTimePicker?", "+t.format("hh:mm A"):"")}function u(t,e){return e.filter((function(e){return null===t||void 0===e.supportedOrderTypes||e.supportedOrderTypes.includes(t)}))}function a(t){var e,i={type:t.value};return e=t,Boolean(e.hasTimePicker||e.hasDatePicker)&&(i.datetime=o(r().utc().add(1,"days"))),i}},NVK1:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("rfFC");e.map=function(t,e){return function(i){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return i.lift(new o(t,e))}};var o=function(){function t(t,e){this.project=t,this.thisArg=e}return t.prototype.call=function(t,e){return e.subscribe(new n(t,this.project,this.thisArg))},t}();e.MapOperator=o;var n=function(t){function e(e,i,r){t.call(this,e),this.project=i,this.count=0,this.thisArg=r||this}return r(e,t),e.prototype._next=function(t){var e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(i){return void this.destination.error(i)}this.destination.next(e)},e}(s.Subscriber)},NbG7:function(t,e,i){"use strict";i.d(e,"c",(function(){return s})),i.d(e,"b",(function(){return o})),i.d(e,"a",(function(){return n}));var r=i("q1tI"),s={showRelativePriceControl:!0,showCurrencyRiskInQty:!0,showPercentRiskInQty:!0,showBracketsInCurrency:!0,showBracketsInPercent:!0,showOrderPreview:!0,showCryptoBracketsInCurrency:!1,showCryptoBracketsInPercent:!1},o={showCryptoBracketsInCurrency:!1,showCryptoBracketsInPercent:!1},n=r.createContext({value:s,setValue:function(t){console.warn("unable to modify order ticket settings because context.setValue is not defined")}})},Ndu5:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("rfFC"),o=i("i2Fk");e.observeOn=function(t,e){return void 0===e&&(e=0),function(i){return i.lift(new n(t,e))}};var n=function(){function t(t,e){void 0===e&&(e=0),this.scheduler=t,this.delay=e}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.scheduler,this.delay))},t}();e.ObserveOnOperator=n;var u=function(t){function e(e,i,r){void 0===r&&(r=0),t.call(this,e),this.scheduler=i,this.delay=r}return r(e,t),e.dispatch=function(t){var e=t.notification,i=t.destination;e.observe(i),this.unsubscribe()},e.prototype.scheduleMessage=function(t){this.add(this.scheduler.schedule(e.dispatch,this.delay,new a(t,this.destination)))},e.prototype._next=function(t){this.scheduleMessage(o.Notification.createNext(t))},e.prototype._error=function(t){this.scheduleMessage(o.Notification.createError(t))},e.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete())},e}(s.Subscriber);e.ObserveOnSubscriber=u;var a=function(t,e){this.notification=t,this.destination=e}
;e.ObserveOnMessage=a},PIcZ:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(e,i){t.call(this),this.value=e,this.scheduler=i,this._isScalar=!0,i&&(this._isScalar=!1)}return r(e,t),e.create=function(t,i){return new e(t,i)},e.dispatch=function(t){var e=t.done,i=t.value,r=t.subscriber;e?r.complete():(r.next(i),r.closed||(t.done=!0,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.value,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{done:!1,value:i,subscriber:t});t.next(i),t.closed||t.complete()},e}(i("4c1C").Observable);e.ScalarObservable=s},Rcwy:function(t,e,i){"use strict";var r=i("XlJg");e.concatAll=function(){return r.mergeAll(1)}},Rkh2:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("tSeh"),o=function(t){function e(e,i){t.call(this),this.promise=e,this.scheduler=i}return r(e,t),e.create=function(t,i){return new e(t,i)},e.prototype._subscribe=function(t){var e=this,i=this.promise,r=this.scheduler;if(null==r)this._isScalar?t.closed||(t.next(this.value),t.complete()):i.then((function(i){e.value=i,e._isScalar=!0,t.closed||(t.next(i),t.complete())}),(function(e){t.closed||t.error(e)})).then(null,(function(t){s.root.setTimeout((function(){throw t}))}));else if(this._isScalar){if(!t.closed)return r.schedule(n,0,{value:this.value,subscriber:t})}else i.then((function(i){e.value=i,e._isScalar=!0,t.closed||t.add(r.schedule(n,0,{value:i,subscriber:t}))}),(function(e){t.closed||t.add(r.schedule(u,0,{err:e,subscriber:t}))})).then(null,(function(t){s.root.setTimeout((function(){throw t}))}))},e}(i("4c1C").Observable);function n(t){var e=t.value,i=t.subscriber;i.closed||(i.next(e),i.complete())}function u(t){var e=t.err,i=t.subscriber;i.closed||i.error(e)}e.PromiseObservable=o},SUh3:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(e){t.call(this),this.scheduler=e}return r(e,t),e.create=function(t){return new e(t)},e.dispatch=function(t){t.subscriber.complete()},e.prototype._subscribe=function(t){var i=this.scheduler;if(i)return i.schedule(e.dispatch,0,{subscriber:t});t.complete()},e}(i("4c1C").Observable);e.EmptyObservable=s},VVyh:function(t,e,i){"use strict";i.d(e,"d",(function(){return o})),i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return u})),i.d(e,"c",(function(){return a}));var r=i("mrSG"),s=i("Nkvk");function o(t,e,i){if(e.parse){var r=e.parse(t);if(r.res)return r.value}return void 0!==i?i:parseFloat(t)}function n(t,e,i,r,s){var o=Array.from({length:t},function(t,e,i,r){return function(s,o){return r.format(t+i*e*(o+1))}
}(e,i,r,s));return 1===r?o.reverse():o}function u(t,e,i,s){return Object(r.f)(n(s,t,e,1,i),[i.format(t)],n(s,t,e,-1,i))}function a(){return"phone"!==s.mediaState.device&&"phone-vertical"!==s.mediaState.device?6:4}},XVkz:function(t,e,i){"use strict";var r=i("0PrS");e.filter=function(t,e){return r.filter(t,e)(this)}},XlJg:function(t,e,i){"use strict";var r=i("ciX6"),s=i("22vd");e.mergeAll=function(t){return void 0===t&&(t=Number.POSITIVE_INFINITY),r.mergeMap(s.identity,null,t)}},ciX6:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("hgAg"),o=i("35Wn");e.mergeMap=function(t,e,i){return void 0===i&&(i=Number.POSITIVE_INFINITY),function(r){return"number"==typeof e&&(i=e,e=null),r.lift(new n(t,e,i))}};var n=function(){function t(t,e,i){void 0===i&&(i=Number.POSITIVE_INFINITY),this.project=t,this.resultSelector=e,this.concurrent=i}return t.prototype.call=function(t,e){return e.subscribe(new u(t,this.project,this.resultSelector,this.concurrent))},t}();e.MergeMapOperator=n;var u=function(t){function e(e,i,r,s){void 0===s&&(s=Number.POSITIVE_INFINITY),t.call(this,e),this.project=i,this.resultSelector=r,this.concurrent=s,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}return r(e,t),e.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},e.prototype._tryNext=function(t){var e,i=this.index++;try{e=this.project(t,i)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e,t,i)},e.prototype._innerSub=function(t,e,i){this.add(s.subscribeToResult(this,t,e,i))},e.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},e.prototype.notifyNext=function(t,e,i,r,s){this.resultSelector?this._notifyResultSelector(t,e,i,r):this.destination.next(e)},e.prototype._notifyResultSelector=function(t,e,i,r){var s;try{s=this.resultSelector(t,e,i,r)}catch(o){return void this.destination.error(o)}this.destination.next(s)},e.prototype.notifyComplete=function(t){var e=this.buffer;this.remove(t),this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},e}(o.OuterSubscriber);e.MergeMapSubscriber=u},"d/Vi":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("tSeh"),o=i("4c1C"),n=i("p8xl"),u=function(t){function e(e,i){if(t.call(this),this.scheduler=i,null==e)throw new Error("iterator cannot be null.");this.iterator=function(t){var e=t[n.iterator];if(!e&&"string"==typeof t)return new a(t);if(!e&&void 0!==t.length)return new l(t);if(!e)throw new TypeError("object is not iterable");return t[n.iterator]()}(e)}return r(e,t),e.create=function(t,i){return new e(t,i)},e.dispatch=function(t){
var e=t.index,i=t.hasError,r=t.iterator,s=t.subscriber;if(i)s.error(t.error);else{var o=r.next();o.done?s.complete():(s.next(o.value),t.index=e+1,s.closed?"function"==typeof r.return&&r.return():this.schedule(t))}},e.prototype._subscribe=function(t){var i=this.iterator,r=this.scheduler;if(r)return r.schedule(e.dispatch,0,{index:0,iterator:i,subscriber:t});for(;;){var s=i.next();if(s.done){t.complete();break}if(t.next(s.value),t.closed){"function"==typeof i.return&&i.return();break}}},e}(o.Observable);e.IteratorObservable=u;var a=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length),this.str=t,this.idx=e,this.len=i}return t.prototype[n.iterator]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.str.charAt(this.idx++)}:{done:!0,value:void 0}},t}(),l=function(){function t(t,e,i){void 0===e&&(e=0),void 0===i&&(i=function(t){var e=+t.length;if(isNaN(e))return 0;if(0===e||(i=e,"number"!=typeof i||!s.root.isFinite(i)))return e;var i;if((e=function(t){var e=+t;if(0===e)return e;if(isNaN(e))return e;return e<0?-1:1}(e)*Math.floor(Math.abs(e)))<=0)return 0;if(e>c)return c;return e}(t)),this.arr=t,this.idx=e,this.len=i}return t.prototype[n.iterator]=function(){return this},t.prototype.next=function(){return this.idx<this.len?{done:!1,value:this.arr[this.idx++]}:{done:!0,value:void 0}},t}();var c=Math.pow(2,53)-1},en3B:function(t,e,i){"use strict";i.d(e,"h",(function(){return s})),i.d(e,"i",(function(){return o})),i.d(e,"g",(function(){return n})),i.d(e,"a",(function(){return u})),i.d(e,"k",(function(){return a})),i.d(e,"b",(function(){return l})),i.d(e,"c",(function(){return c})),i.d(e,"l",(function(){return h})),i.d(e,"j",(function(){return d})),i.d(e,"d",(function(){return p})),i.d(e,"e",(function(){return b})),i.d(e,"f",(function(){return _})),i.d(e,"m",(function(){return v}));var r,s,o,n,u,a,l,c,h,d,p,b,f=i("q1tI");!function(t){t[t.Wait=0]="Wait",t[t.Active=1]="Active",t[t.Editing=2]="Editing",t[t.Preview=3]="Preview"}(s||(s={})),function(t){t[t.Creating=0]="Creating",t[t.Placed=1]="Placed"}(o||(o={})),function(t){t.Popup="popup",t.Panel="panel"}(n||(n={})),function(t){t[t.StopLoss=0]="StopLoss",t[t.TakeProfit=1]="TakeProfit",t[t.TrailingStop=2]="TrailingStop"}(u||(u={})),function(t){t[t.Stop=0]="Stop",t[t.Limit=1]="Limit"}(a||(a={})),function(t){t[t.TakeProfit=75]="TakeProfit",t[t.StopLoss=25]="StopLoss"}(l||(l={})),function(t){t.Price="Price",t.Pips="Pips",t.Money="Money",t.Percent="Percent"}(c||(c={})),function(t){t.Units="Units",t.RiskInCurrency="RiskInCurrency",t.RiskInPercent="RiskInPercent",t.BaseCurrency="BaseCurrency",t.QuoteCurrency="QuoteCurrency"}(h||(h={})),function(t){t.Absolute="Absolute",t.Relative="Relative"}(d||(d={})),function(t){t[t.Minus=189]="Minus",t[t.NumMinus=109]="NumMinus",t[t.FirefoxMinus=173]="FirefoxMinus"}(p||(p={})),function(t){t[t.Plus=187]="Plus",t[t.NumPlus=107]="NumPlus",t[t.FirefoxPlus=61]="FirefoxPlus"}(b||(b={}));var _=f.createContext({resizerWidth:null,mode:n.Panel,supportTrailingStop:!1}),v=((r={})[1]=window.t("Limit"),
r[2]=window.t("Market"),r[3]=window.t("Stop"),r[4]=window.t("Stop Limit"),r)},fLIW:function(t,e,i){"use strict";var r=i("DVyt");e.publishReplay=function(t,e,i,s){return r.publishReplay(t,e,i,s)(this)}},fjAU:function(t,e,i){"use strict";var r=i("4c1C"),s=i("XVkz");r.Observable.prototype.filter=s.filter},gjxa:function(t,e,i){"use strict";var r=i("5NPC");e.publish=function(t){return r.publish(t)(this)}},gxrE:function(t,e,i){"use strict";var r=i("4c1C"),s=i("lKtV");r.Observable.prototype.first=s.first},hDVK:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("rRE7"),o=i("luwt"),n=i("35Wn"),u=i("hgAg"),a={};e.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=null;return"function"==typeof t[t.length-1]&&(i=t.pop()),1===t.length&&o.isArray(t[0])&&(t=t[0].slice()),function(e){return e.lift.call(new s.ArrayObservable([e].concat(t)),new l(i))}};var l=function(){function t(t){this.project=t}return t.prototype.call=function(t,e){return e.subscribe(new c(t,this.project))},t}();e.CombineLatestOperator=l;var c=function(t){function e(e,i){t.call(this,e),this.project=i,this.active=0,this.values=[],this.observables=[]}return r(e,t),e.prototype._next=function(t){this.values.push(a),this.observables.push(t)},e.prototype._complete=function(){var t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(var i=0;i<e;i++){var r=t[i];this.add(u.subscribeToResult(this,r,r,i))}}},e.prototype.notifyComplete=function(t){0==(this.active-=1)&&this.destination.complete()},e.prototype.notifyNext=function(t,e,i,r,s){var o=this.values,n=o[i],u=this.toRespond?n===a?--this.toRespond:this.toRespond:0;o[i]=e,0===u&&(this.project?this._tryProject(o):this.destination.next(o.slice()))},e.prototype._tryProject=function(t){var e;try{e=this.project.apply(this,t)}catch(i){return void this.destination.error(i)}this.destination.next(e)},e}(n.OuterSubscriber);e.CombineLatestSubscriber=c},hgAg:function(t,e,i){"use strict";var r=i("tSeh"),s=i("vf56"),o=i("/Trf"),n=i("rkVw"),u=i("4c1C"),a=i("p8xl"),l=i("nFJ+"),c=i("78uX");e.subscribeToResult=function(t,e,i,h){var d=new l.InnerSubscriber(t,i,h);if(d.closed)return null;if(e instanceof u.Observable)return e._isScalar?(d.next(e.value),d.complete(),null):(d.syncErrorThrowable=!0,e.subscribe(d));if(s.isArrayLike(e)){for(var p=0,b=e.length;p<b&&!d.closed;p++)d.next(e[p]);d.closed||d.complete()}else{if(o.isPromise(e))return e.then((function(t){d.closed||(d.next(t),d.complete())}),(function(t){return d.error(t)})).then(null,(function(t){r.root.setTimeout((function(){throw t}))})),d;if(e&&"function"==typeof e[a.iterator])for(var f=e[a.iterator]();;){var _=f.next();if(_.done){d.complete();break}if(d.next(_.value),d.closed)break}else if(e&&"function"==typeof e[c.observable]){var v=e[c.observable]()
;if("function"==typeof v.subscribe)return v.subscribe(new l.InnerSubscriber(t,i,h));d.error(new TypeError("Provided object does not correctly implement Symbol.observable"))}else{var y="You provided "+(n.isObject(e)?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.";d.error(new TypeError(y))}}return null}},i2Fk:function(t,e,i){"use strict";var r=i("4c1C"),s=function(){function t(t,e,i){this.kind=t,this.value=e,this.error=i,this.hasValue="N"===t}return t.prototype.observe=function(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}},t.prototype.do=function(t,e,i){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return i&&i()}},t.prototype.accept=function(t,e,i){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,i)},t.prototype.toObservable=function(){switch(this.kind){case"N":return r.Observable.of(this.value);case"E":return r.Observable.throw(this.error);case"C":return r.Observable.empty()}throw new Error("unexpected notification kind value")},t.createNext=function(e){return void 0!==e?new t("N",e):t.undefinedValueNotification},t.createError=function(e){return new t("E",void 0,e)},t.createComplete=function(){return t.completeNotification},t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t}();e.Notification=s},iLVi:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("4c1C"),o=i("PIcZ"),n=i("SUh3"),u=function(t){function e(e,i){t.call(this),this.arrayLike=e,this.scheduler=i,i||1!==e.length||(this._isScalar=!0,this.value=e[0])}return r(e,t),e.create=function(t,i){var r=t.length;return 0===r?new n.EmptyObservable:1===r?new o.ScalarObservable(t[0],i):new e(t,i)},e.dispatch=function(t){var e=t.arrayLike,i=t.index,r=t.length,s=t.subscriber;s.closed||(i>=r?s.complete():(s.next(e[i]),t.index=i+1,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.arrayLike,r=this.scheduler,s=i.length;if(r)return r.schedule(e.dispatch,0,{arrayLike:i,index:0,length:s,subscriber:t});for(var o=0;o<s&&!t.closed;o++)t.next(i[o]);t.complete()},e}(s.Observable);e.ArrayLikeObservable=u},jQCj:function(t,e,i){"use strict";var r=i("+AwB");e.startWith=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];return r.startWith.apply(void 0,t)(this)}},lKtV:function(t,e,i){"use strict";var r=i("9A11");e.first=function(t,e,i){return r.first(t,e,i)(this)}},"m4/a":function(t,e,i){"use strict";var r=function(){function t(e,i){void 0===i&&(i=t.now),this.SchedulerAction=e,this.now=i}return t.prototype.schedule=function(t,e,i){return void 0===e&&(e=0),new this.SchedulerAction(this,t).schedule(i,e)},t.now=Date.now?Date.now:function(){return+new Date},t}();e.Scheduler=r},mPU7:function(t,e,i){"use strict"
;var r=i("4c1C"),s=i("fLIW");r.Observable.prototype.publishReplay=s.publishReplay},"nFJ+":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(e,i,r){t.call(this),this.parent=e,this.outerValue=i,this.outerIndex=r,this.index=0}return r(e,t),e.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},e.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},e.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},e}(i("rfFC").Subscriber);e.InnerSubscriber=s},oaOn:function(t,e,i){"use strict";var r=i("z6YP"),s=i("luwt"),o=i("rRE7"),n=i("hDVK");e.combineLatest=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var i=null,u=null;return r.isScheduler(t[t.length-1])&&(u=t.pop()),"function"==typeof t[t.length-1]&&(i=t.pop()),1===t.length&&s.isArray(t[0])&&(t=t[0]),new o.ArrayObservable(t,u).lift(new n.CombineLatestOperator(i))}},p8xl:function(t,e,i){"use strict";var r=i("tSeh");function s(t){var e=t.Symbol;if("function"==typeof e)return e.iterator||(e.iterator=e("iterator polyfill")),e.iterator;var i=t.Set;if(i&&"function"==typeof(new i)["@@iterator"])return"@@iterator";var r=t.Map;if(r)for(var s=Object.getOwnPropertyNames(r.prototype),o=0;o<s.length;++o){var n=s[o];if("entries"!==n&&"size"!==n&&r.prototype[n]===r.prototype.entries)return n}return"@@iterator"}e.symbolIteratorPonyfill=s,e.iterator=s(r.root),e.$$iterator=e.iterator},pHYF:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("luwt"),o=i("vf56"),n=i("/Trf"),u=i("Rkh2"),a=i("d/Vi"),l=i("rRE7"),c=i("iLVi"),h=i("p8xl"),d=i("4c1C"),p=i("Ndu5"),b=i("78uX"),f=function(t){function e(e,i){t.call(this,null),this.ish=e,this.scheduler=i}return r(e,t),e.create=function(t,i){if(null!=t){if("function"==typeof t[b.observable])return t instanceof d.Observable&&!i?t:new e(t,i);if(s.isArray(t))return new l.ArrayObservable(t,i);if(n.isPromise(t))return new u.PromiseObservable(t,i);if("function"==typeof t[h.iterator]||"string"==typeof t)return new a.IteratorObservable(t,i);if(o.isArrayLike(t))return new c.ArrayLikeObservable(t,i)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")},e.prototype._subscribe=function(t){var e=this.ish,i=this.scheduler;return null==i?e[b.observable]().subscribe(t):e[b.observable]().subscribe(new p.ObserveOnSubscriber(t,i,0))},e}(d.Observable);e.FromObservable=f},rRE7:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("4c1C"),o=i("PIcZ"),n=i("SUh3"),u=i("z6YP"),a=function(t){function e(e,i){
t.call(this),this.array=e,this.scheduler=i,i||1!==e.length||(this._isScalar=!0,this.value=e[0])}return r(e,t),e.create=function(t,i){return new e(t,i)},e.of=function(){for(var t=[],i=0;i<arguments.length;i++)t[i-0]=arguments[i];var r=t[t.length-1];u.isScheduler(r)?t.pop():r=null;var s=t.length;return s>1?new e(t,r):1===s?new o.ScalarObservable(t[0],r):new n.EmptyObservable(r)},e.dispatch=function(t){var e=t.array,i=t.index,r=t.count,s=t.subscriber;i>=r?s.complete():(s.next(e[i]),s.closed||(t.index=i+1,this.schedule(t)))},e.prototype._subscribe=function(t){var i=this.array,r=i.length,s=this.scheduler;if(s)return s.schedule(e.dispatch,0,{array:i,index:0,count:r,subscriber:t});for(var o=0;o<r&&!t.closed;o++)t.next(i[o]);t.complete()},e}(s.Observable);e.ArrayObservable=a},srUj:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("xqEh"),o=i("4c1C"),n=i("NTzu"),u=function(t){function e(e,i,r){t.call(this),this.addHandler=e,this.removeHandler=i,this.selector=r}return r(e,t),e.create=function(t,i,r){return new e(t,i,r)},e.prototype._subscribe=function(t){var e=this,i=this.removeHandler,r=this.selector?function(){for(var i=[],r=0;r<arguments.length;r++)i[r-0]=arguments[r];e._callSelector(t,i)}:function(e){t.next(e)},o=this._callAddHandler(r,t);s.isFunction(i)&&t.add(new n.Subscription((function(){i(r,o)})))},e.prototype._callSelector=function(t,e){try{var i=this.selector.apply(this,e);t.next(i)}catch(r){t.error(r)}},e.prototype._callAddHandler=function(t,e){try{return this.addHandler(t)||null}catch(i){e.error(i)}},e}(o.Observable);e.FromEventPatternObservable=u},"ty+v":function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(){var e=t.call(this,"no elements in sequence");this.name=e.name="EmptyError",this.stack=e.stack,this.message=e.message}return r(e,t),e}(Error);e.EmptyError=s},"u+1n":function(t,e,i){"use strict";var r=i("srUj");e.fromEventPattern=r.FromEventPatternObservable.create},vf56:function(t,e,i){"use strict";e.isArrayLike=function(t){return t&&"number"==typeof t.length}},wHNh:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=i("rfFC");e.refCount=function(){return function(t){return t.lift(new o(t))}};var o=function(){function t(t){this.connectable=t}return t.prototype.call=function(t,e){var i=this.connectable;i._refCount++;var r=new n(t,i),s=e.subscribe(r);return r.closed||(r.connection=i.connect()),s},t}(),n=function(t){function e(e,i){t.call(this,e),this.connectable=i}return r(e,t),e.prototype._unsubscribe=function(){var t=this.connectable;if(t){this.connectable=null;var e=t._refCount
;if(e<=0)this.connection=null;else if(t._refCount=e-1,e>1)this.connection=null;else{var i=this.connection,r=t._connection;this.connection=null,!r||i&&r!==i||r.unsubscribe()}}else this.connection=null},e}(s.Subscriber)},xA5P:function(t,e,i){"use strict";var r=this&&this.__extends||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);function r(){this.constructor=t}t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)},s=function(t){function e(){t.apply(this,arguments),this.actions=[],this.active=!1,this.scheduled=void 0}return r(e,t),e.prototype.flush=function(t){var e=this.actions;if(this.active)e.push(t);else{var i;this.active=!0;do{if(i=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,i){for(;t=e.shift();)t.unsubscribe();throw i}}},e}(i("m4/a").Scheduler);e.AsyncScheduler=s},xDhC:function(t,e,i){"use strict";var r=i("4c1C"),s=i("u+1n");r.Observable.fromEventPattern=s.fromEventPattern},xE8I:function(t,e,i){"use strict";var r=i("3oOo");e.multicast=function(t,e){return function(i){var o;if(o="function"==typeof t?t:function(){return t},"function"==typeof e)return i.lift(new s(o,e));var n=Object.create(i,r.connectableObservableDescriptor);return n.source=i,n.subjectFactory=o,n}};var s=function(){function t(t,e){this.subjectFactory=t,this.selector=e}return t.prototype.call=function(t,e){var i=this.selector,r=this.subjectFactory(),s=i(r).subscribe(t);return s.add(e.subscribe(r)),s},t}();e.MulticastOperator=s},z6YP:function(t,e,i){"use strict";e.isScheduler=function(t){return t&&"function"==typeof t.schedule}}}]);