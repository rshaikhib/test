(window.webpackJsonp=window.webpackJsonp||[]).push([["trading-custom-sources"],{"//HS":function(t,e,i){"use strict";i.d(e,"a",(function(){return o}));var r=i("jFln");function o(t,e,i,o,s,n,a){t.save(),t.strokeStyle=o;var c=t.lineWidth%2?.5:0;t.translate(e+c,i+c),s&&t.rotate(Math.PI),r.drawArrow(t,0,0,0,n,a),t.restore()}},"14ox":function(t,e,i){"use strict";i.d(e,"a",(function(){return p}));var r=i("Eyy1"),o=i("aO4+"),s=i("ikwP"),n=i("VdBB"),a=i("u+0B"),c=i("gAom"),u=i("jFln"),l=i("XlJ7"),h=i("//HS");function d(t,e,i,r,o,s,n,a,c,u){void 0===c&&(c=!1),void 0===u&&(u=!1),t.save(),t.fillStyle=n,t.fillRect(e,i,r,o),t.fillStyle=a,t.fillRect(e,i,r,s),t.fillRect(e,i+o-s,r,s),c||t.fillRect(e,i,s,o),u||t.fillRect(e+r-s,i,s,o),t.restore()}function _(t,e,i,r,o,s,n,a){t.save(),t.textAlign="center",t.textBaseline="middle",t.fillStyle=n,t.font=a,t.fillText(e,i+o/2,r+s/2),t.restore()}var p=function(){function t(){this._cache={top:0,bottom:0,left:0,right:0,bodyRight:0,quantityRight:0},this._data=null,this._textWidthCache=new a.TextWidthCache,this._font=null,this._height=null,this._prevPixelRatio=null}return t.prototype.setData=function(t){var e=null!==this._data&&this._data.fontSize||null;this._data=t,null!==this._data&&e!==this._data.fontSize&&this._resetHeightAndTextCache()},t.prototype.hitTest=function(t){if(null===this._data)return null;var e=t.x>=this._cache.left,i=t.x<=this._cache.right,s=e&&i,a=t.y>=this._cache.top&&t.y<=this._cache.bottom;if(!a||!s)return null;if(this._data.disabled)return new n.HitTestResult(n.HitTestResult.CUSTOM,{});var c=this._data.callbacks.onContextMenu,u=this._data.callbacks.onMove;if(e&&t.x<this._cache.bodyRight&&void 0!==u)return new n.HitTestResult(n.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:c,pressedMouseMoveHandler:function(t){u(new o.Point(t.localX,t.localY))},touchMoveHandler:function(t){u(new o.Point(t.localX,t.localY))},mouseUpHandler:this._data.callbacks.onFinishMove,touchEndHandler:this._data.callbacks.onFinishMove});if(t.x>=this._cache.bodyRight&&t.x<this._cache.quantityRight&&void 0!==this._data.callbacks.onModify)return new n.HitTestResult(n.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:c,clickHandler:this._data.callbacks.onModify,tapHandler:this._data.callbacks.onModify,tooltip:{text:this._data.qty.title,rect:{x:this._cache.bodyRight,y:this._cache.top,w:this._cache.quantityRight-this._cache.bodyRight,h:this._cache.bottom-this._cache.top}}});if(void 0!==this._cache.reverseButtonRight&&void 0!==this._data.callbacks.onReverse&&t.x>=this._cache.quantityRight&&t.x<this._cache.reverseButtonRight)return new n.HitTestResult(n.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:c,clickHandler:this._data.callbacks.onReverse,tapHandler:this._data.callbacks.onReverse,tooltip:{text:Object(r.ensureDefined)(this._data.reverseButton).title,rect:{x:this._cache.quantityRight,y:this._cache.top,w:this._cache.reverseButtonRight-this._cache.quantityRight,h:this._cache.bottom-this._cache.top}}})
;var l=void 0!==this._cache.reverseButtonRight?this._cache.reverseButtonRight:this._cache.quantityRight;return t.x>=l&&i&&void 0!==this._data.callbacks.onClose?new n.HitTestResult(n.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:c,clickHandler:this._data.callbacks.onClose,tapHandler:this._data.callbacks.onClose,tooltip:{text:this._data.closeButton.title,rect:{x:l,y:this._cache.top,w:this._cache.right-l,h:this._cache.bottom-this._cache.top}}}):a&&s?this._data.callbacks.onContextMenu?new n.HitTestResult(n.HitTestResult.CUSTOM,{hideCrosshairLinesOnHover:!0,contextMenuHandler:this._data.callbacks.onContextMenu}):new n.HitTestResult(n.HitTestResult.REGULAR):null},t.prototype.draw=function(t,e){if(null!==this._data){var i,r=e.pixelRatio;this._prevPixelRatio!==r&&(this._resetHeightAndTextCache(),this._prevPixelRatio=r),null===this._height&&(this._font=Object(l.makeFont)(this._data.fontSize,"Verdana","","bold"),this._height=(i=this._data.fontSize,Math.max(22,1+i+10)));var o=Math.ceil(this._height/2);if(!(this._data.y<-o||this._data.y>e.cssHeight+o)){var s=this._bodyWidth(t),n=this._quantityWidth(t),a=this._data.callbacks.onReverse?this._height:0,c=this._data.callbacks.onClose?this._height:0,u=s+n+a+c,h=e.cssWidth-u,d=Math.max(this._data.line.width/100*e.cssWidth,1);this._cache.top=this._data.y-o,this._cache.bottom=this._cache.top+this._height,this._cache.right=Math.round(e.cssWidth-Math.min(h,d)),this._cache.left=this._cache.right-u,this._cache.bodyRight=this._cache.left+s,this._cache.quantityRight=this._cache.bodyRight+n,a>0&&(this._cache.reverseButtonRight=this._cache.quantityRight+a);var _=Math.round(this._data.y*r),p=Math.round(this._cache.top*r),f=Math.round(this._cache.right*r),b=Math.round(this._cache.left*r),y=Math.round(this._height*r),v=Math.max(1,Math.floor(1*r));this._drawLines(t,r,b,f,_,Math.ceil(e.physicalWidth));var m=Math.round(s*r);0!==s&&(this._drawBody(t,b,p,m,y,v),this._data.callbacks.onMove&&this._drawMovePoints(t,r,b,p,y),this._drawBodyText(t,r,this._cache.left,this._cache.top,s,this._height));var x=Math.round(n*r),O=b+m;0!==n&&(this._drawQuantity(t,O,p,x,y,v),this._drawQuantityText(t,r,this._cache.bodyRight,this._cache.top,n,this._height));var w=Math.round(a*r),g=O+x;0!==a&&this._drawReverseButton(t,r,g,p,w,y,v);var P=g+w;if(0!==c){var S=void 0!==this._cache.reverseButtonRight?P:g,C=Math.round(c*r);this._drawCloseButton(t,r,S,p,C,y,v)}}}},t.prototype._drawLines=function(t,e,i,o,s,n){var a=Object(r.ensureNotNull)(this._data).line;t.save(),t.strokeStyle=a.color,t.lineWidth=Math.max(1,Math.floor(a.thickness*e)),Object(u.setLineStyle)(t,a.style),Object(c.drawHorizontalLine)(t,s,o,n),a.extend&&Object(c.drawHorizontalLine)(t,s,0,i),t.restore()},t.prototype._drawBody=function(t,e,i,o,s,n){var a=Object(r.ensureNotNull)(this._data).body;d(t,e,i,o,s,n,a.backgroundColor,a.borderColor,!1,!0)},t.prototype._drawBodyText=function(t,e,i,o,n,a){var c=this,u=Object(r.ensureNotNull)(this._data).body;Object(s.drawScaled)(t,e,(function(){
return _(t,u.text,i,o,n,a,u.textColor,Object(r.ensureNotNull)(c._font))}))},t.prototype._drawMovePoints=function(t,e,i,o,s){var n=Object(r.ensureNotNull)(this._data).body,a=Math.max(1,Math.floor(e));t.save(),t.strokeStyle=n.borderColor,t.fillStyle=n.borderColor,t.lineWidth=a;for(var u=Math.round(4*e),l=Math.round(5*e),h=i+u,d=h+a,_=Math.round(2*e),p=Math.floor((s-2*l)/_)+1,f=0;f<p;++f){var b=o+l+_*f;Object(c.drawHorizontalLine)(t,b,h,d)}t.restore()},t.prototype._drawQuantity=function(t,e,i,o,s,n){var a=Object(r.ensureNotNull)(this._data).qty;d(t,e,i,o,s,n,a.backgroundColor,a.borderColor)},t.prototype._drawQuantityText=function(t,e,i,o,n,a){var c=this,u=Object(r.ensureNotNull)(this._data).qty;Object(s.drawScaled)(t,e,(function(){return _(t,u.text,i,o,n,a,u.textColor,Object(r.ensureNotNull)(c._font))}))},t.prototype._drawReverseButton=function(t,e,i,o,s,n,a){var c=Object(r.ensureDefined)(Object(r.ensureNotNull)(this._data).reverseButton);t.save(),d(t,i,o,s,n,a,c.backgroundColor,c.borderColor,!0),t.save();var u=Math.round(2*e),l=Math.round(10*e),_=Math.round(i+(s-6*e)/2),p=Math.round(_+6*e),f=Math.round(o+6*e),b=f+l,y=c.iconColor;t.lineWidth=a,Object(h.a)(t,_,f,y,!1,l,u),Object(h.a)(t,p,b,y,!0,l,u),t.restore(),this._drawDisabledArea(t,i,o,s,n,a),t.restore()},t.prototype._drawCloseButton=function(t,e,i,s,n,a,c){var l=Object(r.ensureNotNull)(this._data).closeButton;t.save(),d(t,i,s,n,a,c,l.backgroundColor,l.borderColor,!0),t.save(),t.lineWidth=c,t.strokeStyle=l.iconColor;var h=i+n,_=s+a,p=Math.round((n-8*e)/2),f=Math.round((a-8*e)/2);Object(u.drawPoly)(t,[new o.Point(i+p,s+f),new o.Point(h-p,_-f)],!0),Object(u.drawPoly)(t,[new o.Point(h-p,s+f),new o.Point(i+p,_-f)],!0),t.restore(),this._drawDisabledArea(t,i,s,n,a,c),t.restore()},t.prototype._drawDisabledArea=function(t,e,i,o,s,n){Object(r.ensureNotNull)(this._data).disabled&&(t.fillStyle="rgba(140, 140, 140, 0.75)",t.fillRect(e,i+n,o-n,s-2*n))},t.prototype._bodyWidth=function(t){var e=Object(r.ensureNotNull)(this._data);t.save(),t.font=Object(r.ensureNotNull)(this._font);var i=Math.ceil(this._textWidthCache.measureText(t,e.body.text));t.restore();var o=e.callbacks.onMove?10:0;return Math.round(10+o+i)},t.prototype._quantityWidth=function(t){var e=Object(r.ensureNotNull)(this._data);t.save(),t.font=Object(r.ensureNotNull)(this._font);var i=Math.ceil(this._textWidthCache.measureText(t,e.qty.text));return t.restore(),Math.round(Math.max(Object(r.ensureNotNull)(this._height),10+i))},t.prototype._resetHeightAndTextCache=function(){this._font=null,this._height=null,this._textWidthCache.reset()},t}()},EgV8:function(t,e,i){"use strict";i.r(e);var r=i("mrSG"),o=i("oV8k"),s=i("Kxc7"),n=i("Eyy1"),a=i("Y7w9"),c=i("XPit"),u=i("k9/m"),l=i("VdBB"),h=i("//HS"),d=function(){function t(){this._data={points:[],arrowHeight:0}}return t.prototype.setData=function(t){this._data=t},t.prototype.hitTest=function(t){for(var e=0,i=this._data.points;e<i.length;e++){var r=i[e],o=Math.round(r.x),s=Math.round(r.y),n=void 0,a=void 0;if(r.arrowUp?(n=s,
a=s+this._data.arrowHeight):(n=s-this._data.arrowHeight,a=s),t.x>=o-2&&t.x<=o+2&&t.y>=n&&t.y<=a&&""!==r.tooltip)return new l.HitTestResult(l.HitTestResult.CUSTOM,{tooltip:{text:r.tooltip,rect:{x:o,y:n,w:2,h:a-n}}})}return null},t.prototype.draw=function(t,e){var i=e.pixelRatio;t.save(),t.lineWidth=Math.max(1,Math.floor(t.lineWidth*i));for(var r=Math.round(this._data.arrowHeight*i),o=Math.round(2*i),s=0,n=this._data.points;s<n.length;s++){var a=n[s],c=Math.round(a.x*i),u=Math.round(a.y*i);Object(h.a)(t,c,u,a.arrowColor,!a.arrowUp,r,o)}t.restore()},t}(),_=function(){function t(t,e){this._invalidated=!0,this._points=[],this._renderer=new d,this._chartModel=t,this._source=e}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer},t.prototype._updateImpl=function(){this._points=[],this._renderer.setData({points:[],arrowHeight:0});var t=this._chartModel.timeScale().visibleBarsStrictRange();if(null!==t){var e=this._source.points();if(0!==e.length){var i=Object(a.lowerbound)(e,t.firstBar(),(function(t,e){return t.index<e}),0),r=Object(a.upperbound)(e,t.lastBar(),(function(t,e){return e.index>t}),i);if(!(i>=r)){for(var o=this._chartModel.mainSeries().priceScale().isInverted(),s=new Map,c=i;c<r;c++){var u=e[c],l=s.get(u.index)||p(o);if(void 0===l.x){var h=this._getXCoordinate(u.index);if(null===h)continue;l.x=h}var d=u.isBuyDirection!==o,_=d?"arrowUp":"arrowDown",f=d?1:-1,b=l[_].y;if(void 0===b){var y=this._getYCoordinate(u.index,u.isBuyDirection);if(null===y)continue;l[_].y=y+11*f}else l[_].y=b+19*f;s.set(u.index,l),this._points.push({x:Object(n.ensureDefined)(l.x),y:Object(n.ensureDefined)(l[_].y),arrowUp:d,arrowColor:l[_].color,tooltip:u.tooltip})}this._renderer.setData({points:this._points,arrowHeight:8})}}}},t.prototype._getXCoordinate=function(t){var e=this._chartModel.mainSeries().bars().lastIndex();return null===e||t>e?null:this._chartModel.timeScale().indexToCoordinate(t)},t.prototype._getYCoordinate=function(t,e){var i=null,r=this._chartModel.mainSeries(),o=r.priceSource(),s=null!==o?o:e?"low":"high",n=Object(c.barFunction)(s),a=r.nearestData(t,u.PlotRowSearchMode.NearestLeft);if(void 0!==a){var l=n(a.value);if(!Number.isNaN(l)){var h=r.firstValue();null!==h&&(i=this._chartModel.mainSeries().priceScale().priceToCoordinate(l,h))}}return i},t}();function p(t){var e,i;return t?(e="#e75656",i="#4094e8"):(e="#4094e8",i="#e75656"),{x:void 0,arrowUp:{y:void 0,color:e},arrowDown:{y:void 0,color:i}}}i.d(e,"ExecutionsSource",(function(){return f}));var f=function(t){function e(e,i,r,o,s){var n=t.call(this,e,i)||this;return n._paneViews=[],n._executionsPointsManager=s,n._executionsPointsManager.existingPointsChanged().subscribe(n,n.updateAllViews),n._showExecutions=o,n._paneViews.push(new _(i,n)),n}return Object(r.c)(e,t),e.prototype.destroy=function(){this._executionsPointsManager.existingPointsChanged().unsubscribeAll(this),this._executionsPointsManager.destroy(),this._showExecutions.destroy()},
e.prototype.points=function(){return this._executionsPointsManager.existingPoints()},e.prototype.updateAllViews=function(){if(this._showExecutions.value())for(var t=0,e=this._paneViews;t<e.length;t++){e[t].update()}},e.prototype.paneViews=function(t){return t.containsMainSeries()?window.TradingView.printing&&!s.enabled("snapshot_trading_drawings")?[]:this._showExecutions.value()?this._paneViews:[]:[]},e}(o.CustomSourceBase)},J1Ip:function(t,e,i){"use strict";i.r(e);var r=i("Eyy1"),o=i("QfUd"),s=i("vTIA"),n=i("GOhO"),a=i("mrSG"),c=i("Cf1E"),u=i("txPx"),l=i("uDRY"),h=i("9XXR"),d=i("Ialn"),_=i("2uTr"),p=i("14ox"),f=i("fAa4");var b=Object(_.appendEllipsis)(window.t("Protect Position")),y=window.t("Reverse Position"),v=window.t("Close Position"),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderer=new p.a,e}return Object(a.c)(e,t),e.prototype._updateImpl=function(){this._renderer.setData(null);var t=this.priceToCoordinate(this._source.price());if(null!==t){var e,i,r=this._source.isBuyDirection()?"rgb(64,148, 232)":"rgb(231, 86, 86)";this._renderer.setData({y:t,disabled:this._source.isBlocked(),callbacks:this._callbacks(),line:{thickness:this._source.lineWidth(),width:this._source.lineLength(),style:this._source.lineStyle(),color:r,extend:this._source.isLineExtended()},body:{text:(i=this._source.pl(),null===i?"position":Object(d.startWithLTR)(Object(h.splitThousands)((Math.round(100*i)/100||0).toFixed(2)," "))),textColor:(e=this._source.profitState(),"neutral"===e?"rgb(100, 100, 100)":"negative"===e?"rgb(231, 86, 86)":"rgb(38, 140, 2)"),borderColor:r,backgroundColor:"rgba(255, 255, 255, 0.75)"},qty:{title:b,text:Object(f.b)(this._source.qty()),textColor:"rgba(255, 255, 255, 1)",borderColor:r,backgroundColor:r},reverseButton:{title:y,borderColor:r,backgroundColor:"rgba(255, 255, 255, 0.75)",iconColor:r},closeButton:{title:v,borderColor:r,backgroundColor:"rgba(255, 255, 255, 0.75)",iconColor:r},fontSize:9})}},e.prototype._callbacks=function(){var t={};return this._source.supportReverse()&&(t.onReverse=this._source.onReverse.bind(this._source)),this._source.supportClose()&&(t.onClose=this._source.onClose.bind(this._source)),this._source.supportModify()&&(t.onModify=this._source.onModify.bind(this._source)),this._source.hasContextMenu()&&(t.onContextMenu=this._source.onContextMenu.bind(this._source)),t},e}(f.a),x=Object(u.getLogger)("Trading.Positions"),O=function(t){function e(e,i,r,o,s,n){var a=t.call(this,e,i,r,o)||this;return a._data=null,a._callbacks=n,a._positionDataSpawn=s.spawn(),a._positionDataSpawn.subscribe(a._updateData.bind(a),{callWithLast:!0}),a._paneViews.push(new m(i,a)),a}return Object(a.c)(e,t),e.prototype.destroy=function(){this._positionDataSpawn.destroy(),t.prototype.destroy.call(this)},e.prototype.price=function(){return Object(r.ensureNotNull)(this._data).price},e.prototype.qty=function(){return Object(r.ensureNotNull)(this._data).qtyBySide},e.prototype.isBuyDirection=function(){return 1===Object(r.ensureNotNull)(this._data).side},
e.prototype.supportReverse=function(){return Object(r.ensureNotNull)(this._data).supportReverse},e.prototype.onReverse=function(){return Object(a.b)(this,void 0,void 0,(function(){return Object(a.d)(this,(function(t){switch(t.label){case 0:return[4,this._doActionWithBlock("reversePosition",!0)];case 1:return t.sent(),[2]}}))}))},e.prototype.supportClose=function(){return Object(r.ensureNotNull)(this._data).supportClose},e.prototype.onClose=function(){return Object(a.b)(this,void 0,void 0,(function(){return Object(a.d)(this,(function(t){switch(t.label){case 0:return[4,this._doActionWithBlock("closePosition",!0)];case 1:return t.sent(),[2]}}))}))},e.prototype.supportModify=function(){return Object(r.ensureNotNull)(this._data).supportBrackets},e.prototype.onModify=function(){return Object(a.b)(this,void 0,void 0,(function(){return Object(a.d)(this,(function(t){switch(t.label){case 0:return[4,this._doActionWithBlock("modifyPosition",!1)];case 1:return t.sent(),[2]}}))}))},e.prototype.hasContextMenu=function(){return this.supportModify()||this.supportClose()||this.supportClose()},e.prototype.onContextMenu=function(t){if(null!==this._data){var e={};this.supportClose()&&(e.closePosition=this._callbacks.closePosition),this.supportReverse()&&(e.reversePosition=this._callbacks.reversePosition),this.supportModify()&&(e.modifyPosition=this._callbacks.modifyPosition),Object(r.ensureDefined)(this._callbacks.showContextMenu)(this._data.id,e,t)}},e.prototype.pl=function(){return Object(r.ensureNotNull)(this._data).pl},e.prototype.profitState=function(){return Object(r.ensureNotNull)(this._data).profitState},e.prototype._doActionWithBlock=function(t,e){return Object(a.b)(this,void 0,void 0,(function(){var i;return Object(a.d)(this,(function(o){switch(o.label){case 0:if(void 0===this._callbacks[t]||null===this._data)return[2];e&&this._setIsBlocked(!0),o.label=1;case 1:return o.trys.push([1,3,4,5]),[4,Object(r.ensureDefined)(this._callbacks[t])("Chart Position",this._data.id)];case 2:return o.sent(),[3,5];case 3:return i=o.sent(),x.logWarn("Try to "+t+", but got error: "+Object(c.a)(i)),[3,5];case 4:return e&&this._setIsBlocked(!1),[7];case 5:return[2]}}))}))},e.prototype._updateData=function(t){this._data=t,t.symbol!==this._symbol&&(this._symbol=t.symbol,this._updateActualSymbolAndFormatter()),this.updateAllViews(),this._model.updateSource(this)},e}(l.a);function w(t,e,i,r){t.addCustomSource("position"+e,(function(t,e){var o=e.properties().childs().tradingProperties.childs(),s=Object(n.b)(e.isInReplay.bind(e),e.onInReplayStateChanged()),a=Object(n.a)((function(t,e){return e}),s,o.showPositions),c={width:o.lineWidth,length:o.lineLength,style:o.lineStyle,extend:o.extendLeft};return new O(t,e,a,c,i,r)}),s.a.Topmost)}var g=i("ogJP"),P=i("7KDR"),S=i("5VQP");function C(t,e,i){return Object(a.b)(this,void 0,void 0,(function(){var o;return Object(a.d)(this,(function(s){return o=function(t,e){var i=[];void 0!==e.modifyPosition&&i.push(new P.Action({label:M,statName:"Modify Position",onExecute:function(){
return Object(r.ensureDefined)(e.modifyPosition)("Chart Position Context Menu",t)}}));void 0!==e.closePosition&&i.push(new P.Action({label:j,statName:"Close Position",onExecute:function(){return Object(r.ensureDefined)(e.closePosition)("Chart Position Context Menu",t)}}));void 0!==e.reversePosition&&i.push(new P.Action({label:k,statName:"Reverse Position",onExecute:function(){return Object(r.ensureDefined)(e.reversePosition)("Chart Position Context Menu",t)}}));return i}(t,e),[2,S.ContextMenuManager.createMenu(o,{}).then((function(t){return t.show(i),t}))]}))}))}var M=Object(_.appendEllipsis)(window.t("Protect Position")),j=window.t("Close Position"),k=window.t("Reverse Position");i.d(e,"PositionsManager",(function(){return A}));var A=function(){function t(t,e,i){var r=this;this._positionsData=new Map,this._positionsService=t,this._chartWidgetCollection=e,this._brokerCommandsUIGetter=i.brokerCommandsUI,this._trackEvent=i.trackEvent,this._addPositionSources(this._positionsService.positions()),this._positionsService.positionUpdate().subscribe(this,(function(t){return r._addPositionSources([t])})),this._positionsService.positionsRemoved().subscribe(this,this._removePositionSources)}return t.prototype.destroy=function(){this._positionsService.positionUpdate().unsubscribeAll(this),this._positionsService.positionsRemoved().unsubscribeAll(this),this._positionsData.clear()},t.prototype._addPositionSources=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e],s=r.id,n=Object(g.clone)(r),a=this._positionsData.get(s);if(void 0===a){a=new o.a(n);var c={};c.reversePosition=this._reversePosition.bind(this),c.closePosition=this._closePosition.bind(this),c.modifyPosition=this._modifyPosition.bind(this),c.showContextMenu=this._showPositionContextMenu.bind(this),w(this._chartWidgetCollection,s,a,c),this._positionsData.set(s,a)}else a.setValue(n)}},t.prototype._removePositionSources=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e];o=this._chartWidgetCollection,s=r,o.removeCustomSource("position"+s),this._positionsData.delete(r)}var o,s},t.prototype._reversePosition=function(t,e){return this._trackEvent(t,"Reverse Position"),Object(r.ensureNotNull)(this._brokerCommandsUIGetter()).reversePosition(e)},t.prototype._closePosition=function(t,e){this._trackEvent(t,"Close Position");var i=Object(r.ensureNotNull)(this._brokerCommandsUIGetter());return this._positionsService.isDisplayModeTrades()?i.closeTrade(e):i.closePosition(e)},t.prototype._modifyPosition=function(t,e){this._trackEvent(t,"Edit Position");var i=Object(r.ensureNotNull)(this._brokerCommandsUIGetter());return this._positionsService.isDisplayModeTrades()?Object(r.ensureDefined)(i.editTradeBrackets).call(i,e):i.editPositionBrackets(e,{})},t.prototype._showPositionContextMenu=function(t,e,i){return C(t,e,i)},t}()},KSBC:function(t,e,i){"use strict";i.r(e),i.d(e,"ExecutionsPointsManager",(function(){return a}));var r=i("Y7w9"),o=i("aIyQ"),s=i.n(o);function n(t){return void 0!==t.index}var a=function(){function t(t,e,i){this._points=[],this._existingExecutionPointsCache=null,
this._offsetOfFirstExistingPoint=null,this._existingPointsChanged=new s.a,this._pointsets=[],this._pointsetManagerFactory=e,this._firstSeriesTimePointWV=i,this._firstSeriesTimePointWV.subscribe(this._updateExistingPoints.bind(this)),this._executionsService=t,this._addPoints(this._executionsService.executions()),this._executionsService.executionsAdded().subscribe(this,this._addPoints),this._executionsService.executionsCleared().subscribe(this,this._clearPoints)}return t.prototype.destroy=function(){this._clearPoints(),this._firstSeriesTimePointWV.destroy(),this._executionsService.executionsAdded().unsubscribeAll(this),this._executionsService.executionsCleared().unsubscribeAll(this),this._executionsService.destroy()},t.prototype.existingPoints=function(){return null===this._offsetOfFirstExistingPoint?[]:(null===this._existingExecutionPointsCache&&(this._existingExecutionPointsCache=this._points.slice(this._offsetOfFirstExistingPoint).filter(n)),this._existingExecutionPointsCache)},t.prototype.existingPointsChanged=function(){return this._existingPointsChanged},t.prototype._onExistingStartPointChanged=function(){this._existingExecutionPointsCache=null,this._existingPointsChanged.fire(this.existingPoints())},t.prototype._addPoints=function(t){if(0!==t.length){var e=function(t){return t.map((function(t){return{time_t:Math.round(t.time/1e3),index:void 0,isBuyDirection:1===t.side,tooltip:t.tooltip}}))}(t);e.sort((function(t,e){return t.time_t-e.time_t}));var i=0,o=this._points.length>0;o&&(i=Object(r.upperbound)(this._points,e[0].time_t,(function(t,e){return e.time_t>t}),0)),this._points=this._points.slice(0,i).concat(e).concat(this._points.slice(i));var s=this._firstSeriesTimePointWV.value();null!==this._offsetOfFirstExistingPoint&&null!==s&&e[0].time_t<s?this._offsetOfFirstExistingPoint=this._offsetOfFirstExistingPoint+e.length:((null===this._offsetOfFirstExistingPoint||e[0].time_t<this._points[this._offsetOfFirstExistingPoint].time_t)&&(this._offsetOfFirstExistingPoint=this._calcOffsetOfFirstExistingPoint()),null!==this._offsetOfFirstExistingPoint&&(o?i>=this._offsetOfFirstExistingPoint&&this._sendPointsToServer(i,i+e.length):this._sendPointsToServer(this._offsetOfFirstExistingPoint,this._points.length)))}},t.prototype._updateExistingPoints=function(){var t=this._calcOffsetOfFirstExistingPoint();null!==t&&(null===this._offsetOfFirstExistingPoint&&(this._offsetOfFirstExistingPoint=this._points.length),t<this._offsetOfFirstExistingPoint&&(this._sendPointsToServer(t,this._offsetOfFirstExistingPoint),this._offsetOfFirstExistingPoint=t))},t.prototype._clearPoints=function(){for(var t=0,e=this._pointsets;t<e.length;t++){var i=e[t];i.onUpdate().unsubscribeAll(this),i.destroy()}this._pointsets=[],this._points=[],this._offsetOfFirstExistingPoint=null,this._onExistingStartPointChanged()},t.prototype._sendPointsToServer=function(t,e){var i=this._points.slice(t,e).map((function(t){return{time_t:t.time_t,offset:0}}));if(0!==i.length){var r=this._pointsetManagerFactory(i)
;null!==r&&(r.onUpdate().subscribe(this,this._updatePointsFromServer),this._pointsets.push(r))}},t.prototype._updatePointsFromServer=function(t){if(null!==this._offsetOfFirstExistingPoint){for(var e=Object(r.lowerbound)(this._points,t[0].time_t,(function(t,e){return t.time_t<e}),this._offsetOfFirstExistingPoint),i=Math.max(this._offsetOfFirstExistingPoint,e),o=0,s=t;o<s.length;o++)for(var n=s[o],a=i;a<this._points.length&&(i=a,!(this._points[a].time_t>n.time_t));a++)this._points[a].time_t===n.time_t&&(this._points[a].index=n.index);this._onExistingStartPointChanged()}},t.prototype._calcOffsetOfFirstExistingPoint=function(){var t=this._firstSeriesTimePointWV.value();return null===t?null:Object(r.upperbound)(this._points,t,(function(t,e){return e.time_t>t}),0,this._offsetOfFirstExistingPoint||this._points.length)},t}()},QOhU:function(t,e,i){"use strict";i.r(e);var r=i("mrSG"),o=i("Eyy1"),s=i("8Wzo"),n=i("QfUd"),a=i("vTIA"),c=i("GOhO"),u=i("ivNn"),l=i("ogJP"),h=i("14ox"),d=i("fAa4"),_=i("2uTr"),p=Object(_.appendEllipsis)(window.t("Modify Order")),f=window.t("Cancel Order"),b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._renderer=new h.a,e}return Object(r.c)(e,t),e.prototype._updateImpl=function(){this._renderer.setData(null);var t=this.priceToCoordinate(this._source.price());if(null!==t){var e=this._source.isActive(),i=this._source.isBuyDirection()?e?"rgb(64, 148, 232)":"rgba(64, 148, 232, .5)":e?"rgb(231, 86, 86)":"rgba(231, 86, 86, .5)",r=this._source.type(),o=1===r?e?"rgb(38, 140, 2)":"rgba(38, 140, 2, .5)":3===r?e?"rgb(231, 86, 86)":"rgba(231, 86, 86, .5)":i;this._renderer.setData({y:t,disabled:this._source.isBlocked(),callbacks:this._callbacks(),line:{thickness:this._source.lineWidth(),width:this._source.lineLength(),style:this._source.lineStyle(),color:i,extend:this._source.isLineExtended()},body:{text:this._source.text().toUpperCase(),textColor:o,borderColor:i,backgroundColor:"rgba(255, 255, 255, 0.75)"},qty:{title:p,text:Object(d.b)(this._source.qtyText()),textColor:"rgba(255, 255, 255, 1)",borderColor:i,backgroundColor:i},closeButton:{title:f,borderColor:i,backgroundColor:"rgba(255, 255, 255, 0.75)",iconColor:i},fontSize:9})}},e.prototype._callbacks=function(){var t={};return this._source.supportModify()&&(t.onModify=this._source.onModify.bind(this._source)),this._source.supportCancel()&&(t.onClose=this._source.onCancel.bind(this._source)),this._source.supportMove()&&(t.onMove=this._source.onMove.bind(this._source),t.onFinishMove=this._source.onFinishMove.bind(this._source)),this._source.hasContextMenu()&&(t.onContextMenu=this._source.onContextMenu.bind(this._source)),t},e}(d.a),y=i("uDRY"),v=i("4qhP");var m=window.t("Trailing Stop"),x=window.t("Stop Loss"),O=window.t("Take Profit");var w=function(t){function e(e,i,r,o,s,n,a,c){var u=t.call(this,e,i,s,n)||this;return u._quantityFormatter=null,u._data=null,u._quantityFormatterGetter=r,u._parentOrderDataGetter=o,u._callbacks=c,u._orderData=a,u._orderData.subscribe(u._updateData.bind(u),{callWithLast:!0}),
u._paneViews.push(new b(i,u)),u}return Object(r.c)(e,t),e.prototype.destroy=function(){this._orderData.unsubscribe(),t.prototype.destroy.call(this)},e.prototype.price=function(){return Object(o.ensureNotNull)(this._data).price},e.prototype.qtyText=function(){var t=Object(o.ensureNotNull)(this._data);return Object(o.ensureNotNull)(this._quantityFormatter).format(t.considerFilledQty?t.qty-(t.filledQty||0):t.qty)},e.prototype.text=function(){var t,e,i=Object(o.ensureNotNull)(this._data),r=i.parentId;if(r){var n=this._parentOrderDataGetter(r);if(1!==i.parentType||null!==n&&function(t,e){if(t.side===e.side)return!1;var i=Object(o.ensureDefined)(t.limitPrice||t.stopPrice),r=Object(o.ensureDefined)(e.limitPrice||e.stopPrice);if(1===t.side){if(1===e.type&&r<i||3===e.type&&r>i)return!1}else if(1===e.type&&r>i||3===e.type&&r<i)return!1;return!0}(n,i)){var a=(t=i.type,e=i.stopType,3===t?e===s.a.TrailingStop?m:x:1===t?O:null);if(null!==a)return a}}return Object(v.y)(i.side)+" "+Object(v.w)(i.type)},e.prototype.type=function(){return Object(o.ensureNotNull)(this._data).type},e.prototype.isActive=function(){return Object(o.ensureNotNull)(this._data).isActive},e.prototype.isBuyDirection=function(){return 1===Object(o.ensureNotNull)(this._data).side},e.prototype.supportModify=function(){return Boolean(this._callbacks.modifyOrder)},e.prototype.onModify=function(){return Object(r.b)(this,void 0,void 0,(function(){var t;return Object(r.d)(this,(function(e){switch(e.label){case 0:return t=Object(o.ensureNotNull)(this._data),[4,Object(o.ensureDefined)(this._callbacks.modifyOrder)("Chart Order",t.id,t.symbol)];case 1:return e.sent(),[2]}}))}))},e.prototype.supportMove=function(){return Boolean(this._callbacks.moveOrder)},e.prototype.onMove=function(t){return Object(r.b)(this,void 0,void 0,(function(){var e,i,s,n,a;return Object(r.d)(this,(function(r){return e=this._mainSeries.priceScale(),null===(i=this._mainSeries.firstValue())||(s=1/this._mainSeries.base(),n=Object(l.clone)(Object(o.ensureNotNull)(this._data)),a=e.coordinateToPrice(t.y,i),n.price=Object(u.fixComputationError)(s*Math.round(a/s)),this._orderData.setValue(n)),[2]}))}))},e.prototype.onFinishMove=function(){return Object(r.b)(this,void 0,void 0,(function(){var t;return Object(r.d)(this,(function(e){return t=Object(o.ensureNotNull)(this._data),Object(o.ensureDefined)(this._callbacks.moveOrder)("Chart Order",t.id,t.symbol),[2]}))}))},e.prototype.supportCancel=function(){return Boolean(this._callbacks.cancelOrder)},e.prototype.onCancel=function(){return Object(r.b)(this,void 0,void 0,(function(){var t;return Object(r.d)(this,(function(e){switch(e.label){case 0:return(t=Object(o.ensureNotNull)(this._data)).isBlocked?[2]:[4,Object(o.ensureDefined)(this._callbacks.cancelOrder)("Chart Order",t.id)];case 1:return e.sent(),[2]}}))}))},e.prototype.hasContextMenu=function(){return null!==this._data&&this._data.hasContextMenu},e.prototype.onContextMenu=function(t){var e=this._data;null!==e&&this._callbacks.showContextMenu&&this._callbacks.showContextMenu(e.id,e.symbol,this._callbacks,t)
},e.prototype._updateActualSymbolAndFormatter=function(){return Object(r.b)(this,void 0,void 0,(function(){var e;return Object(r.d)(this,(function(i){switch(i.label){case 0:return null===this._symbol?[2]:(t.prototype._updateActualSymbolAndFormatter.call(this),null===this._mainSeries.symbolInfo()?[3,2]:(e=this,[4,this._quantityFormatterGetter(this._symbol)]));case 1:e._quantityFormatter=i.sent(),i.label=2;case 2:return this.updateAllViews(),[2]}}))}))},e.prototype._updateData=function(t){this._data=t,this._setIsBlocked(this._data.isBlocked),t.symbol!==this._symbol&&(this._symbol=t.symbol,this._updateActualSymbolAndFormatter()),this.updateAllViews(),this._model.updateSource(this)},e}(y.a);function g(t,e,i,r,o,s){t.addCustomSource("order"+r,(function(t,r){var n=r.properties().childs().tradingProperties.childs(),a=Object(c.b)(r.isInReplay.bind(r),r.onInReplayStateChanged()),u=Object(c.a)((function(t,e){return e}),a,n.showOrders),l={width:n.lineWidth,length:n.lineLength,style:n.lineStyle,extend:n.extendLeft};return new w(t,r,e,i,u,l,o,s)}),a.a.Topmost)}function P(t,e){t.removeCustomSource("order"+e)}var S=i("7KDR"),C=i("5VQP");function M(t,e,i,o){return Object(r.b)(this,void 0,void 0,(function(){var s;return Object(r.d)(this,(function(r){return s=function(t,e,i){var r=[],o=i.modifyOrder;void 0!==o&&r.push(new S.Action({label:j,statName:"Edit Order",onExecute:function(){return o("Chart Order Context Menu",t,e)}}));var s=i.cancelOrder;void 0!==s&&r.push(new S.Action({label:k,statName:"Cancel Order",onExecute:function(){return s("Chart Order Context Menu",t)}}));return r}(t,e,i),[2,C.ContextMenuManager.createMenu(s,{}).then((function(t){return t.show(o),t}))]}))}))}var j=Object(_.appendEllipsis)(window.t("Modify Order")),k=window.t("Cancel Order");var A=i("Cf1E"),T=i("txPx");i.d(e,"OrdersManager",(function(){return N}));var E=Object(T.getLogger)("Trading.Order"),N=function(){function t(t,e,i,r){var o=this;this._ordersData=new Map,this._stopLimitOrdersData=new Map,this._ordersInModify=new Map,this._quantityFormattersMap=new Map,this._ordersService=t,this._positionService=e,this._chartWidgetCollection=i,this._activeBrokerGetter=r.activeBroker,this._onConnectionStatusChange=r.onConnectionStatusChange,this._brokerCommandsUIGetter=r.brokerCommandsUI,this._trackEvent=r.trackEvent,this._addOrderSources(this._ordersService.activeOrders()),this._ordersService.activeOrdersUpdated().subscribe(this,(function(t){return o._addOrderSources([t])})),this._ordersService.activeOrdersRemoved().subscribe(this,this._removeOrderSources),this._onConnectionStatusChange.subscribe(this,(function(){return o._quantityFormattersMap.clear()}))}return t.prototype.destroy=function(){this._ordersService.activeOrdersUpdated().unsubscribeAll(this),this._ordersService.activeOrdersRemoved().unsubscribeAll(this),this._ordersData.clear(),this._stopLimitOrdersData.clear(),this._ordersInModify.clear(),this._onConnectionStatusChange.unsubscribeAll(this),this._quantityFormattersMap.clear()},t.prototype._quantityFormatter=function(t){
return Object(r.b)(this,void 0,void 0,(function(){var e;return Object(r.d)(this,(function(i){switch(i.label){case 0:return void 0!==(e=this._quantityFormattersMap.get(t))?[3,2]:[4,Object(o.ensureNotNull)(this._activeBrokerGetter()).quantityFormatter(t)];case 1:e=i.sent(),this._quantityFormattersMap.set(t,e),i.label=2;case 2:return[2,e]}}))}))},t.prototype._parentOrder=function(t){var e=this._ordersData.get(t);return void 0===e?null:e.value()},t.prototype._addOrderSources=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e],o=r.id;if(this._ordersInModify.has(o))this._ordersInModify.set(o,r);else{var s=Object(l.merge)(Object(l.clone)(r),{isBlocked:!1,hasContextMenu:!0}),a=this._ordersData.get(o);if(void 0===a){if(a=new n.a(s),g(this._chartWidgetCollection,this._quantityFormatter.bind(this),this._parentOrder.bind(this),o,a,this._createCallbacksForOrder(s,!0)),this._ordersData.set(o,a),4===r.type){var c={price:r.limitPrice,considerFilledQty:!1,isActive:!0,hasContextMenu:!1},u=new n.a(Object(l.merge)(Object(l.clone)(r),c));g(this._chartWidgetCollection,this._quantityFormatter.bind(this),this._parentOrder.bind(this),"StopLimit"+o,u,this._createCallbacksForOrder(s,!1)),this._stopLimitOrdersData.set(o,u)}}else{var h=this._stopLimitOrdersData.get(o);void 0!==h&&(4!==r.type?(s=Object(l.merge)(h.value(),{price:r.price}),this._removeNestedStopLimitOrderSource(o)):h.setValue(Object(l.merge)(Object(l.clone)(r),{price:r.limitPrice}))),a.setValue(s)}}}},t.prototype._removeOrderSources=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e];P(this._chartWidgetCollection,r),this._ordersData.delete(r),this._removeNestedStopLimitOrderSource(r)}},t.prototype._removeNestedStopLimitOrderSource=function(t){this._stopLimitOrdersData.has(t)&&(P(this._chartWidgetCollection,"StopLimit"+t),this._stopLimitOrdersData.delete(t))},t.prototype._getNestedOrdersIds=function(t){return Object(r.b)(this,void 0,void 0,(function(){var e,i,o,s;return Object(r.d)(this,(function(r){switch(r.label){case 0:return e=[],[4,this._ordersService.orders()];case 1:return i=r.sent(),void 0!==(o=i.find((function(e){return e.id===t})))&&(o.parentId?(e=i.filter((function(t){return t.parentId===o.parentId})),(s=i.find((function(t){return t.id===o.parentId})))&&e.push(s)):e=i.filter((function(t){return t.parentId===o.id})).concat(o)),[2,e.map((function(t){return t.id}))]}}))}))},t.prototype._blockNestedOrders=function(t,e){return Object(r.b)(this,void 0,void 0,(function(){var i,o,s,n,a,c,u,h;return Object(r.d)(this,(function(r){switch(r.label){case 0:return[4,this._getNestedOrdersIds(t)];case 1:for(i=r.sent(),o=0,s=i;o<s.length;o++)n=s[o],(a=this._ordersData.get(n))&&((c=Object(l.clone)(a.value())).isBlocked=e,a.setValue(c),(u=this._stopLimitOrdersData.get(n))&&((h=Object(l.clone)(u.value())).isBlocked=e,u.setValue(h)));return[2]}}))}))},t.prototype._createCallbacksForOrder=function(t,e){var i={};return t.supportModify&&(i.modifyOrder=this._modifyOrder.bind(this,e),i.moveOrder=this._moveOrder.bind(this,e)),e&&(i.cancelOrder=this._cancelOrder.bind(this),
i.showContextMenu=this._showContextMenu.bind(this)),i},t.prototype._processingModifyOrder=function(t,e,i,n){return void 0===t&&(t={}),Object(r.b)(this,void 0,void 0,(function(){var a,c,u,l,h,d,_,p,f,b,y;return Object(r.d)(this,(function(r){switch(r.label){case 0:return(a=e.parentId)&&e.stopType===s.a.TrailingStop?(c=this._ordersData.get(a),u=c&&c.value()||this._positionService.find(a),[4,(l=Object(o.ensureNotNull)(this._activeBrokerGetter())).symbolInfo(n)]):[3,3];case 1:return h=r.sent(),[4,l.quotesSnapshot(n)];case 2:d=r.sent(),null!==u&&(_=void 0,_=1!==e.parentType?1===u.side?d.bid:d.ask:3===u.type?u.stopPrice:u.limitPrice,e.trailingStopPips=(Object(o.ensureDefined)(e.stopPrice||e.limitPrice)-_)/h.pipSize*(1===u.side?-1:1)),r.label=3;case 3:this._ordersInModify.set(i.id,i),this._blockNestedOrders(e.id,!0),4===i.type&&(t.useLimitPrice||(p=2),t.useStopPrice||(p=1)),f=!1,r.label=4;case 4:return r.trys.push([4,6,7,8]),[4,Object(o.ensureNotNull)(this._brokerCommandsUIGetter()).modifyOrder(e,t.silent,p)];case 5:return f=r.sent(),[3,8];case 6:return b=r.sent(),E.logError("Try to modify order with error "+Object(A.a)(b)),[3,8];case 7:return this._ordersData.has(e.id)?(this._blockNestedOrders(e.id,!1),y=Object(o.ensureDefined)(this._ordersInModify.get(e.id)),this._ordersInModify.delete(e.id),this._addOrderSources([y])):this._ordersInModify.delete(e.id),[7];case 8:return[2,f]}}))}))},t.prototype._modifyOrder=function(t,e,i,r){this._trackEvent(e,"Edit Order");var s=Object(o.ensureDefined)(this._ordersData.get(i)).value(),n={};t||(n.useLimitPrice=!0);var a=Object(o.ensureNotNull)(this._ordersService.find(i));return this._processingModifyOrder(n,s,a,r)},t.prototype._cancelOrder=function(t,e){return this._trackEvent(t,"Cancel Order"),Object(o.ensureNotNull)(this._brokerCommandsUIGetter()).cancelOrder(e)},t.prototype._moveOrder=function(t,e,i,r){this._trackEvent(e,"Move Order");var s=Object(o.ensureDefined)(t?this._ordersData.get(i):this._stopLimitOrdersData.get(i)).value(),n=Object(l.clone)(s),a={silent:!0};if(t){var c=n.price;n.stopPrice?n.stopPrice=c:n.limitPrice&&(n.limitPrice=c),a.useStopPrice=Boolean(n.stopPrice)}else n.limitPrice=s.price,a.useLimitPrice=!0;var u=Object(o.ensureNotNull)(this._ordersService.find(i));return this._processingModifyOrder(a,n,u,r)},t.prototype._showContextMenu=function(t,e,i,r){return M(t,e,i,r)},t}()},bydf:function(t,e,i){"use strict";i.r(e);var r=i("mrSG"),o=i("Eyy1"),s=i("ogJP"),n=i("KtbP"),a=i("oV8k"),c=function(t){function e(e,i,r){var o=t.call(this)||this;return o._model=e,o._source=i,o._priceType=r,o}return Object(r.c)(e,t),e.prototype._value=function(){var t=this._model.mainSeries(),e=t.priceScale(),i=t.firstValue();if(null===i)return{noData:!0};var r=this._source.getPrice(this._priceType);if(null===r)return{noData:!0};var o=e.priceToCoordinate(r,i);return{noData:!1,floatCoordinate:o,coordinate:o,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",text:"",index:0}},e.prototype._priceLineColor=function(t){var e=this._source.properties().childs()
;return 0===this._priceType?e.bidLineColor.value():e.askLineColor.value()},e.prototype._lineWidth=function(){return this._source.properties().childs().lineWidth.value()},e.prototype._lineStyle=function(){return this._source.properties().childs().lineStyle.value()},e.prototype._isVisible=function(){return this._source.properties().childs().visible.value()},e}(i("TmNs").PriceLineAxisView),u=i("YFKU"),l=function(t){function e(e,i,r){var o=t.call(this)||this;return o._model=e,o._source=i,o._priceType=r,o}return Object(r.c)(e,t),e.prototype._updateRendererData=function(t,e,i){if(t.visible=!1,e.visible=!1,this._model.properties().scalesProperties.showBidAskLabels.value()){var r=this._model.mainSeries(),o=r.priceScale(),s=r.firstValue();if(null!==s){var n=this._source.getPrice(this._priceType);if(null!==n){t.visible=!0,e.visible=!0,t.text=o.formatPriceAbsolute(n),e.text=0===this._priceType?Object(u.t)("Bid"):Object(u.t)("Ask"),i.coordinate=o.priceToCoordinate(n,s);var a=this._source.properties().childs();i.background=0===this._priceType?a.bidLineColor.value():a.askLineColor.value()}}}},e}(i("KcY8").a),h=i("2ijp"),d=i("VdBB"),_=function(t){function e(e,i,r,o){var s=t.call(this)||this;s._model=e,s._source=i,s._priceType=r;var n={doubleClickHandler:o,doubleTapHandler:o};return s._lineRenderer.setHitTest(new d.HitTestResult(d.HitTestResult.CUSTOM,n)),s}return Object(r.c)(e,t),e.prototype._updateImpl=function(){var t=this._lineRendererData;t.visible=!1;var e=this._source.properties().childs();if(e.visible.value()){var i=this._model.mainSeries(),r=i.priceScale(),o=i.firstValue();if(null!==o){var s=this._source.getPrice(this._priceType);null!==s&&(t.visible=!0,t.y=r.priceToCoordinate(s,o),t.linestyle=e.lineStyle.value(),t.linewidth=e.lineWidth.value(),t.color=0===this._priceType?e.bidLineColor.value():e.askLineColor.value())}}},e}(h.a);i.d(e,"BidAsk",(function(){return p}));var p=function(t){function e(e,i,r,o){var s=t.call(this,e,i)||this;s._ask=null,s._bid=null,s._symbol=null,s._realtimeProvider=r,s._bidLinesPaneView=new _(i,s,0,o),s._askLinesPaneView=new _(i,s,1,o),s._bidPriceAxisView=new l(i,s,0),s._askPriceAxisView=new l(i,s,1),s._regularPriceAxisViews=[s._bidPriceAxisView,s._askPriceAxisView],s._bidLabelPaneView=new n.PanePriceAxisView(s._bidPriceAxisView,i.mainSeries(),i),s._askLabelPaneView=new n.PanePriceAxisView(s._askPriceAxisView,i.mainSeries(),i),s._bidPriceLineAxisView=new c(i,s,0),s._askPriceLineAxisView=new c(i,s,1),s._externalPriceAxisViews=[s._bidPriceLineAxisView,s._askPriceLineAxisView],s._updateRealtimeDataHandler=s._updateRealtimeData.bind(s);var a=i.mainSeries().dataEvents();return a.symbolResolved().subscribe(s,s._createTradedSymbol),a.symbolError().subscribe(s,s._createTradedSymbol),s._createTradedSymbol(),s}return Object(r.c)(e,t),e.prototype.destroy=function(){var t=this._model.mainSeries().dataEvents();t.symbolResolved().unsubscribeAll(this),t.symbolError().unsubscribeAll(this),this._clearTradedSymbol()},e.prototype.paneViews=function(t){
return this._isMainSourcePane(t)?[this._bidLinesPaneView,this._askLinesPaneView]:[]},e.prototype.labelPaneViews=function(t){return this._isMainSourcePane(t)?[this._bidLabelPaneView,this._askLabelPaneView]:[]},e.prototype.priceAxisViews=function(t,e){return this._isMainSourcePane(t)?t.findTargetPriceAxisViews(this,e,this._regularPriceAxisViews,this._externalPriceAxisViews):[]},e.prototype.priceScale=function(){return this._model.mainSeries().priceScale()},e.prototype.updateAllViews=function(){this._bidLinesPaneView.update(),this._askLinesPaneView.update(),this._bidPriceAxisView.update(),this._askPriceAxisView.update(),this._bidPriceLineAxisView.update(),this._askPriceLineAxisView.update(),this._bidLabelPaneView.update(),this._askLabelPaneView.update()},e.prototype.getPrice=function(t){return 1===t?this._ask:this._bid},e.prototype.properties=function(){return this._model.mainSeries().properties().bidAsk},e.prototype._createTradedSymbol=function(){var t=function(t){if(t.isConvertedToOtherCurrency())return null;var e=t.symbolInfo();return null===e?t.proSymbol():e.pro_name||e.full_name||e.name||null}(this._model.mainSeries());t!==this._symbol&&(this._clearTradedSymbol(),null!==t&&this._initTradedSymbol(t))},e.prototype._initTradedSymbol=function(t){this._symbol=t,this._realtimeProvider.subscribeRealtime(this._symbol,this._updateRealtimeDataHandler)},e.prototype._clearTradedSymbol=function(){this._ask=null,this._bid=null,null!==this._symbol&&(this._realtimeProvider.unsubscribeRealtime(Object(o.ensureNotNull)(this._symbol),this._updateRealtimeDataHandler),this._symbol=null)},e.prototype._updateRealtimeData=function(t,e,i){var r=e.ask,o=e.bid;r===o?(this._ask=null,this._bid=null):(Object(s.isNumber)(r)&&(this._ask=r),Object(s.isNumber)(o)&&(this._bid=o)),(this._model.mainSeries().properties().bidAsk.visible.value()||this._model.properties().scalesProperties.showBidAskLabels.value())&&(this.updateAllViews(),this._model.updateSource(this))},e.prototype._isMainSourcePane=function(t){return this._model.paneForSource(this._model.mainSeries())===t},e}(a.CustomSourceBase)},"fA+p":function(t,e,i){"use strict";i.r(e),i.d(e,"ExecutionsService",(function(){return h}));var r=i("mrSG"),o=i("Eyy1"),s=i("ogJP"),n=i("kcTO"),a=i("2TBc"),c=i("aIyQ"),u=i.n(c),l=i("4qhP"),h=function(t){function e(e,i,r){var o=t.call(this,e)||this;return o._allExecutionsID=new Set,o._executions=[],o._executionsAdded=new u.a,o._executionsCleared=new u.a,o._formatter=new n.PriceFormatter,o._symbol="",o._dataEvents=i,o._getSymbolName=r,o._initialized=!0,o._tryToStart(),o}return Object(r.c)(e,t),e.prototype.destroy=function(){this.stopService()},e.prototype.formatter=function(){return this._formatter},e.prototype.executions=function(){return this._executions},e.prototype.executionsAdded=function(){return this._executionsAdded},e.prototype.executionsCleared=function(){return this._executionsCleared},e.prototype.startService=function(){this._canBeStarted=!0,this._tryToStart()},e.prototype.stopService=function(){this._canBeStarted=!1,this._isStarted&&this._stop()},
e.prototype._tryToStart=function(){Object(o.assert)(!this._isStarted,"Execution's service has already started"),this._canBeStarted&&this._initialized&&this._start()},e.prototype._start=function(){Object(o.assert)(!this._isStarted,"Execution's service has already started"),this._isStarted=!0,this._dataEvents.symbolResolved().subscribe(this,this._createExecutions),this._dataEvents.symbolError().subscribe(this,this._createExecutions),this._createExecutions()},e.prototype._stop=function(){this._isStarted=!1,this._clearExecutions(),Object(o.ensure)(this.activeBroker()).executionUpdate.unsubscribeAll(this),this._dataEvents.symbolResolved().unsubscribeAll(this),this._dataEvents.symbolError().unsubscribeAll(this)},e.prototype._createExecutions=function(){this._clearExecutions(),this._symbol=this._getSymbolName(),this._symbol&&this._requestFormatterAndExecutions()},e.prototype._clearExecutions=function(){this._allExecutionsID=new Set,this._executions=[],this._executionsCleared.fire()},e.prototype._requestFormatterAndExecutions=function(){return Object(r.b)(this,void 0,void 0,(function(){var t,e,i=this;return Object(r.d)(this,(function(r){switch(r.label){case 0:return(t=this.activeBroker())&&this._symbol?[4,t.isTradable(this._symbol)]:[2];case 1:return r.sent().tradable?(e=this._symbol,Promise.all([t.formatter(this._symbol,!1),t.executions(this._symbol)]).then((function(r){var o=r[0],n=r[1];i._symbol===e&&(i._formatter=o,i._executions=n.map((function(t){return i._createExecutionData(t)})).filter(s.notNull),i._executionsAdded.fire(i._executions),t.executionUpdate.unsubscribeAll(i),t.executionUpdate.subscribe(i,i._addExecution))})),[2]):[2]}}))}))},e.prototype._addExecution=function(t){var e=this._createExecutionData(t);null!==e&&this._executionsAdded.fire([e])},e.prototype._createExecutionData=function(t){return t.symbol!==this._symbol||this._allExecutionsID.has(t.id)?null:(this._allExecutionsID.add(t.id),Object(r.a)(Object(r.a)({},t),{tooltip:Object(l.f)(t,this._formatter)}))},e}(a.a)},fAa4:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"a",(function(){return n}));var r=i("9XXR"),o=i("Ialn");function s(t){return null===t?"0":Object(o.forceLTRStr)(Object(r.splitThousands)(t," "))}var n=function(){function t(t,e){this._invalidated=!0,this._renderer=null,this._chartModel=t,this._source=e}return t.prototype.update=function(){this._invalidated=!0},t.prototype.renderer=function(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer},t.prototype.priceToCoordinate=function(t){if(null===t)return null;var e=this._chartModel.mainSeries(),i=e.firstValue();return null===i?null:e.priceScale().priceToCoordinate(t,i)},t}()},uDRY:function(t,e,i){"use strict";var r=i("mrSG"),o=i("kcTO"),s=i("oV8k"),n=i("Kxc7"),a=i("KcY8"),c=i("Tmoa"),u=function(t){function e(e,i){var r=t.call(this)||this;return r._model=e,r._source=i,r}return Object(r.c)(e,t),e.prototype._updateRendererData=function(t,e,i){if(t.visible=!1,this._source.showProperty().value()){
var r=this._model.mainSeries(),o=r.priceScale(),s=r.firstValue();if(null!==s){var n=this._source.price();if(null!==n){var a=this._source.isBuyDirection()?"rgb(64,148, 232)":"rgb(231, 86, 86)";i.background=a,i.borderColor=a,i.color=Object(c.colorFromBackground)(a),i.coordinate=o.priceToCoordinate(n,s),t.text=this._formatPrice(n),t.visible=!0}}}},e.prototype._formatPrice=function(t){return this._source.formatter().format(t)},e}(a.a),l=function(t){function e(e,i){var r=t.call(this)||this;return r._chartModel=e,r._source=i,r}return Object(r.c)(e,t),e.prototype._value=function(){var t=this._chartModel.mainSeries(),e=t.firstValue(),i=this._source.price();if(null===i||null===e)return{noData:!0};var r=t.priceScale().priceToCoordinate(i,e);return{noData:!1,floatCoordinate:r,coordinate:r,color:"",formattedPricePercentage:"",formattedPriceAbsolute:"",text:"",index:0}},e.prototype._priceLineColor=function(t){return this._source.isBuyDirection()?"rgb(64, 148, 232)":"rgb(231, 86, 86)"},e.prototype._lineWidth=function(){return this._source.lineWidth()},e.prototype._lineStyle=function(){return this._source.lineStyle()},e.prototype._isVisible=function(){return this._source.showProperty().value()},e}(i("TmNs").PriceLineAxisView);i.d(e,"a",(function(){return h}));var h=function(t){function e(e,i,r,s){var n=t.call(this,e,i)||this;n._symbol=null,n._isActualSymbol=!1,n._formatter=new o.PriceFormatter,n._paneViews=[],n._priceAxisViews=[],n._priceLineAxisViews=[],n._isBlocked=!1,n._mainSeries=i.mainSeries(),n._showProperty=r,n._lineProperties=s,n._priceAxisViews.push(new u(i,n)),n._priceLineAxisViews.push(new l(i,n));var a=n._mainSeries.dataEvents();return a.symbolResolved().subscribe(n,n._updateActualSymbolAndFormatter),a.symbolError().subscribe(n,n._updateActualSymbolAndFormatter),n._updateActualSymbolAndFormatter(),n}return Object(r.c)(e,t),e.prototype.destroy=function(){this._showProperty.destroy();var t=this._mainSeries.dataEvents();t.symbolResolved().unsubscribeAll(this),t.symbolError().unsubscribeAll(this)},e.prototype.formatter=function(){return this._formatter},e.prototype.showProperty=function(){return this._showProperty},e.prototype.lineWidth=function(){return this._lineProperties.width.value()},e.prototype.lineLength=function(){return this._lineProperties.length.value()},e.prototype.lineStyle=function(){return this._lineProperties.style.value()},e.prototype.isLineExtended=function(){return this._lineProperties.extend.value()},e.prototype.isBlocked=function(){return this._isBlocked},e.prototype.priceScale=function(){return this._mainSeries.priceScale()},e.prototype.updateAllViews=function(){if(this._showProperty.value()){for(var t=0,e=this._paneViews;t<e.length;t++){e[t].update()}for(var i=0,r=this._priceAxisViews;i<r.length;i++){r[i].update()}for(var o=0,s=this._priceLineAxisViews;o<s.length;o++){s[o].update()}}},e.prototype.updateViewsForPane=function(t){this._isSourceShouldBeShown(t)&&this.updateAllViews()},e.prototype.paneViews=function(t){return this._isSourceShouldBeShown(t)?this._paneViews:[]},
e.prototype.priceAxisViews=function(t,e){return this._isSourceShouldBeShown(t)?t.findTargetPriceAxisViews(this,e,this._priceAxisViews,this._priceLineAxisViews):[]},e.prototype.isSelectionEnabled=function(){return!0},e.prototype._setIsBlocked=function(t){this._isBlocked=t,this.updateAllViews(),this._model.updateSource(this)},e.prototype._updateActualSymbolAndFormatter=function(){if(null!==this._symbol){var t=this._mainSeries.symbolInfo();null===t?(this._isActualSymbol=!1,this._formatter=new o.PriceFormatter(100,1,!1)):(this._isActualSymbol=!this._mainSeries.isConvertedToOtherCurrency()&&this._mainSeries.symbolSameAsCurrent(this._symbol),this._formatter=new o.PriceFormatter(t.pricescale,t.fractional?t.minmov:1,t.fractional,t.minmove2)),this.updateAllViews(),this._model.updateSource(this)}},e.prototype._isSourceShouldBeShown=function(t){return!!this._isActualSymbol&&(!!t.containsMainSeries()&&(!(window.TradingView.printing&&!n.enabled("snapshot_trading_drawings"))&&this._showProperty.value()))},e}(s.CustomSourceBase)}}]);